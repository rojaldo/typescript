<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.26">
<title>Curso de Mocha - Temario</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock pre>code{display:block}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
</head>
<body class="book">
<div id="header">
<h1>Curso de Mocha - Temario</h1>
<div id="toc" class="toc">
<div id="toctitle">Contenido</div>
<ul class="sectlevel1">
<li><a href="#_módulo_1_fundamentos_del_testing">Módulo 1: Fundamentos del Testing</a>
<ul class="sectlevel2">
<li><a href="#_1_1_introducción_al_testing">1.1 Introducción al Testing</a></li>
<li><a href="#_1_2_conceptos_clave">1.2 Conceptos Clave</a></li>
</ul>
</li>
<li><a href="#_módulo_2_configuración_e_instalación">Módulo 2: Configuración e Instalación</a>
<ul class="sectlevel2">
<li><a href="#_2_1_instalación_de_mocha">2.1 Instalación de Mocha</a></li>
<li><a href="#_2_2_configuración_inicial">2.2 Configuración Inicial</a></li>
<li><a href="#_2_3_configuración_para_typescript">2.3 Configuración para TypeScript</a></li>
</ul>
</li>
<li><a href="#_módulo_3_sintaxis_y_api_de_mocha">Módulo 3: Sintaxis y API de Mocha</a>
<ul class="sectlevel2">
<li><a href="#_3_1_hooks_y_bloques_de_prueba">3.1 Hooks y Bloques de Prueba</a></li>
<li><a href="#_3_2_hooks_del_ciclo_de_vida">3.2 Hooks del Ciclo de Vida</a></li>
<li><a href="#_3_3_control_de_ejecución">3.3 Control de Ejecución</a></li>
</ul>
</li>
<li><a href="#_módulo_4_assertions_y_librerías_de_assert">Módulo 4: Assertions y Librerías de Assert</a>
<ul class="sectlevel2">
<li><a href="#_4_1_métodos_de_assert_nativos">4.1 Métodos de Assert Nativos</a></li>
<li><a href="#_4_2_chai_librería_de_assertions">4.2 Chai - Librería de Assertions</a></li>
<li><a href="#_4_3_assertions_avanzadas">4.3 Assertions Avanzadas</a></li>
</ul>
</li>
<li><a href="#_módulo_5_testing_de_funciones_y_módulos">Módulo 5: Testing de Funciones y Módulos</a>
<ul class="sectlevel2">
<li><a href="#_5_1_tests_básicos_unitarios">5.1 Tests Básicos Unitarios</a></li>
<li><a href="#_5_2_testing_de_módulos">5.2 Testing de Módulos</a></li>
<li><a href="#_5_3_testing_de_objetos_y_clases">5.3 Testing de Objetos y Clases</a></li>
</ul>
</li>
<li><a href="#_módulo_6_mocks_stubs_y_spies">Módulo 6: Mocks, Stubs y Spies</a>
<ul class="sectlevel2">
<li><a href="#_6_1_sinon_js_librería_de_mocking">6.1 Sinon.js - Librería de Mocking</a></li>
<li><a href="#_6_2_spies_espías">6.2 Spies (Espías)</a></li>
<li><a href="#_6_3_stubs_reemplazos">6.3 Stubs (Reemplazos)</a></li>
<li><a href="#_6_4_mocks_burlas">6.4 Mocks (Burlas)</a></li>
</ul>
</li>
<li><a href="#_módulo_7_testing_de_código_asíncrono">Módulo 7: Testing de Código Asíncrono</a>
<ul class="sectlevel2">
<li><a href="#_7_1_callbacks">7.1 Callbacks</a></li>
<li><a href="#_7_2_promises">7.2 Promises</a></li>
<li><a href="#_7_3_asyncawait">7.3 Async/Await</a></li>
<li><a href="#_7_4_polling_y_retry">7.4 Polling y Retry</a></li>
</ul>
</li>
<li><a href="#_módulo_8_fixtures_y_setup">Módulo 8: Fixtures y Setup</a>
<ul class="sectlevel2">
<li><a href="#_8_1_preparación_de_datos">8.1 Preparación de Datos</a></li>
<li><a href="#_8_2_database_mocking">8.2 Database Mocking</a></li>
<li><a href="#_8_3_api_mocking">8.3 API Mocking</a></li>
</ul>
</li>
<li><a href="#_módulo_9_reporters_y_salida">Módulo 9: Reporters y Salida</a>
<ul class="sectlevel2">
<li><a href="#_9_1_reporters_nativos">9.1 Reporters Nativos</a></li>
<li><a href="#_9_2_reporters_personalizados">9.2 Reporters Personalizados</a></li>
<li><a href="#_9_3_configuración_de_salida">9.3 Configuración de Salida</a></li>
</ul>
</li>
<li><a href="#_módulo_10_code_coverage">Módulo 10: Code Coverage</a>
<ul class="sectlevel2">
<li><a href="#_10_1_nyc_istanbul_coverage_tool">10.1 Nyc - Istanbul Coverage Tool</a></li>
<li><a href="#_10_2_análisis_de_coverage">10.2 Análisis de Coverage</a></li>
<li><a href="#_10_3_mejora_de_coverage">10.3 Mejora de Coverage</a></li>
</ul>
</li>
<li><a href="#_módulo_11_testing_de_apis_rest">Módulo 11: Testing de APIs REST</a>
<ul class="sectlevel2">
<li><a href="#_11_1_supertest_http_assertions">11.1 Supertest - HTTP Assertions</a></li>
<li><a href="#_11_2_testing_de_endpoints">11.2 Testing de Endpoints</a></li>
<li><a href="#_11_3_testing_de_flujos_complejos">11.3 Testing de Flujos Complejos</a></li>
</ul>
</li>
<li><a href="#_módulo_12_buenas_prácticas">Módulo 12: Buenas Prácticas</a>
<ul class="sectlevel2">
<li><a href="#_12_1_estructura_de_tests">12.1 Estructura de Tests</a></li>
<li><a href="#_12_2_escritura_de_tests_efectivos">12.2 Escritura de Tests Efectivos</a></li>
<li><a href="#_12_3_mantenimiento_de_tests">12.3 Mantenimiento de Tests</a></li>
</ul>
</li>
<li><a href="#_módulo_13_debugging_y_troubleshooting_de_tests">Módulo 13: Debugging y Troubleshooting de Tests</a>
<ul class="sectlevel2">
<li><a href="#_13_1_técnicas_de_debug">13.1 Técnicas de Debug</a></li>
<li><a href="#_13_2_análisis_de_errores_comunes">13.2 Análisis de Errores Comunes</a></li>
<li><a href="#_13_3_estrategias_de_troubleshooting">13.3 Estrategias de Troubleshooting</a></li>
</ul>
</li>
<li><a href="#_módulo_14_integración_con_herramientas">Módulo 14: Integración con Herramientas</a>
<ul class="sectlevel2">
<li><a href="#_14_1_cicd_pipelines">14.1 CI/CD Pipelines</a></li>
<li><a href="#_14_2_pre_commit_hooks">14.2 Pre-commit Hooks</a></li>
<li><a href="#_14_3_npm_scripts_útiles">14.3 NPM Scripts Útiles</a></li>
</ul>
</li>
<li><a href="#_recursos_adicionales">Recursos Adicionales</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_módulo_1_fundamentos_del_testing"><a class="link" href="#_módulo_1_fundamentos_del_testing">Módulo 1: Fundamentos del Testing</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_1_introducción_al_testing"><a class="link" href="#_1_1_introducción_al_testing">1.1 Introducción al Testing</a></h3>
<div class="sect3">
<h4 id="_qué_es_el_testing_automático"><a class="link" href="#_qué_es_el_testing_automático">¿Qué es el Testing Automático?</a></h4>
<div class="paragraph">
<p>El testing automático es el proceso de escribir código que verifica automáticamente que otro código funciona como se espera. En lugar de probar manualmente cada funcionalidad de una aplicación, los tests automáticos ejecutan verificaciones repetidamente de forma rápida y confiable.</p>
</div>
<div class="ulist">
<div class="title">Sin Testing Automático:</div>
<ul>
<li>
<p>Pruebas manuales repetitivas y propensas a errores</p>
</li>
<li>
<p>Difícil detectar cambios inesperados en el código</p>
</li>
<li>
<p>Mayor tiempo de desarrollo y depuración</p>
</li>
<li>
<p>Confianza reducida en los cambios</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Con Testing Automático:</div>
<ul>
<li>
<p>Verificación rápida y consistente</p>
</li>
<li>
<p>Detección inmediata de regresiones</p>
</li>
<li>
<p>Desarrollo más ágil y confiable</p>
</li>
<li>
<p>Documentación viva del código</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_beneficios_del_testing"><a class="link" href="#_beneficios_del_testing">Beneficios del Testing</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Beneficio</th>
<th class="tableblock halign-left valign-top">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Confianza</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Seguridad de que el código funciona como se espera</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Regresiones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Detección inmediata de cambios no deseados</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Documentación</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los tests actúan como ejemplos de uso</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Diseño</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mejora el diseño del código (más modular y testeable)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Velocidad</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Feedback inmediato sin necesidad de pruebas manuales</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Refactoring</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Libertad para mejorar código sin miedo a romper cosas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mantenibilidad</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Código más limpio y fácil de entender</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Calidad</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reducción de bugs en producción</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_tipos_de_testing"><a class="link" href="#_tipos_de_testing">Tipos de Testing</a></h4>
<div class="sect4">
<h5 id="_testing_unitario"><a class="link" href="#_testing_unitario">Testing Unitario</a></h5>
<div class="paragraph">
<p>Prueba componentes individuales de manera aislada. Verifica que una función o método realice su tarea específica correctamente.</p>
</div>
<div class="ulist">
<div class="title">Características:</div>
<ul>
<li>
<p>Prueba unidades pequeñas de código (funciones, métodos)</p>
</li>
<li>
<p>Aisladas de dependencias externas</p>
</li>
<li>
<p>Rápidas de ejecutar</p>
</li>
<li>
<p>Muchas y frecuentes</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// Función a probar
function suma(a: number, b: number): number {
  return a + b;
}

// Test unitario
describe('Función suma', () =&gt; {
  it('debe sumar dos números correctamente', () =&gt; {
    const resultado = suma(2, 3);
    if (resultado !== 5) {
      throw new Error(`Esperado 5, pero obtuvo ${resultado}`);
    }
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_testing_de_integración"><a class="link" href="#_testing_de_integración">Testing de Integración</a></h5>
<div class="paragraph">
<p>Verifica que múltiples componentes trabajen juntos correctamente. Prueba la interacción entre módulos.</p>
</div>
<div class="ulist">
<div class="title">Características:</div>
<ul>
<li>
<p>Prueba múltiples componentes juntos</p>
</li>
<li>
<p>Verifica comunicación entre módulos</p>
</li>
<li>
<p>Más lentás que tests unitarios</p>
</li>
<li>
<p>Menos cantidad que tests unitarios</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// Componentes a integrar
class CalculadoraAvanzada {
  constructor(private calculadoraBasica: Calculadora) {}

  promedio(numeros: number[]): number {
    const suma = numeros.reduce((a, b) =&gt;
      this.calculadoraBasica.suma(a, b), 0);
    return suma / numeros.length;
  }
}

// Test de integración
describe('CalculadoraAvanzada', () =&gt; {
  it('debe calcular promedio usando suma', () =&gt; {
    const calc = new CalculadoraAvanzada(new Calculadora());
    const resultado = calc.promedio([2, 4, 6]);
    if (resultado !== 4) {
      throw new Error(`Esperado 4, obtuve ${resultado}`);
    }
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_testing_end_to_end_e2e"><a class="link" href="#_testing_end_to_end_e2e">Testing End-to-End (E2E)</a></h5>
<div class="paragraph">
<p>Prueba la aplicación completa desde la perspectiva del usuario. Simula interacciones reales.</p>
</div>
<div class="ulist">
<div class="title">Características:</div>
<ul>
<li>
<p>Prueba flujos completos del usuario</p>
</li>
<li>
<p>Interactúa con la UI y APIs</p>
</li>
<li>
<p>Las más lentas</p>
</li>
<li>
<p>Las menos frecuentes</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Ejemplo (Conceptual):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// Test E2E simulado
describe('Flujo de compra', () =&gt; {
  it('usuario puede comprar un producto', async () =&gt; {
    // Usuario abre la app
    await navegarA('/productos');

    // Busca un producto
    await escribir('[data-test=busqueda]', 'laptop');
    await hacer('click', '[data-test=buscar-btn]');

    // Agrega al carrito
    await hacer('click', '[data-test=agregar-carrito]');

    // Completa compra
    await navegarA('/carrito');
    await hacer('click', '[data-test=comprar-btn]');

    // Verifica confirmación
    const mensaje = await obtenerTexto('[data-test=confirmacion]');
    if (!mensaje.includes('Compra exitosa')) {
      throw new Error('Compra no completada');
    }
  });
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_test_driven_development_tdd"><a class="link" href="#_test_driven_development_tdd">Test-Driven Development (TDD)</a></h4>
<div class="paragraph">
<p>TDD es una metodología donde escribes los tests ANTES de implementar el código. Sigue un ciclo específico:</p>
</div>
<div class="olist arabic">
<div class="title">Ciclo TDD (Red-Green-Refactor):</div>
<ol class="arabic">
<li>
<p><strong>Red</strong> (Rojo): Escribe un test que falla</p>
</li>
<li>
<p><strong>Green</strong> (Verde): Escribe el código mínimo para pasar el test</p>
</li>
<li>
<p><strong>Refactor</strong>: Mejora el código manteniendo los tests pasando</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Ventajas de TDD:</div>
<ul>
<li>
<p>Código más modular y testeable por defecto</p>
</li>
<li>
<p>Documentación clara de requisitos</p>
</li>
<li>
<p>Menos bugs en producción</p>
</li>
<li>
<p>Mayor confianza en cambios</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Ejemplo TDD:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// PASO 1: RED - Escribir test que falla
describe('Calculadora', () =&gt; {
  it('debe calcular el factorial de 5', () =&gt; {
    const fab = new Calculadora();
    const resultado = fab.factorial(5);
    if (resultado !== 120) {
      throw new Error(`Esperado 120, obtuve ${resultado}`);
    }
  });
});
// El test FALLA porque factorial() no existe

// PASO 2: GREEN - Código mínimo para pasar
class Calculadora {
  factorial(n: number): number {
    f (n === 0 || n === 1) return 1;
    return n * this.factorial(n - 1);
  }
}
// El test PASA

// PASO 3: REFACTOR - Mejorar manteniendo tests verdes
class Calculadora {
  factorial(n: number): number {
    if (n &lt; 0) {
      throw new Error('Factorial no definido para números negativos');
    }
    f (n === 0 || n === 1) return 1;

    let resultado = 1;
    for (let i = 2; i &lt;= n; i++) {
      resultado *= i;
    }
    return resultado;
  }
}
// El test sigue pasando, pero el código es mejor</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pirámide_de_tests"><a class="link" href="#_pirámide_de_tests">Pirámide de Tests</a></h4>
<div class="paragraph">
<p>La pirámide de tests muestra la distribución ideal de tests en un proyecto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">          ┌──────────────┐
          │  E2E Tests   │  Pocos, lentos, caros
          │   (10%)      │
          ├──────────────┤
          │ Integration  │  Medianos, velocidad media
          │   Tests      │
          │   (30%)      │
          ├──────────────┤
          │  Unit Tests  │  Muchos, rápidos, baratos
          │   (60%)      │
          └──────────────┘</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Regla de la Pirámide:</div>
<ul>
<li>
<p><strong>60% Unit Tests</strong>: Pruebas rápidas de componentes individuales</p>
</li>
<li>
<p><strong>30% Integration Tests</strong>: Pruebas de interacción entre módulos</p>
</li>
<li>
<p><strong>10% E2E Tests</strong>: Pruebas de flujos completos del usuario</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Por qué esta estructura:</div>
<ul>
<li>
<p>Unit tests son baratos y rápidos</p>
</li>
<li>
<p>Proporcionan feedback inmediato</p>
</li>
<li>
<p>Cubren la mayoría de casos</p>
</li>
<li>
<p>E2E son costosos, se usan solo para flujos críticos</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_conceptos_clave"><a class="link" href="#_1_2_conceptos_clave">1.2 Conceptos Clave</a></h3>
<div class="sect3">
<h4 id="_casos_de_prueba_test_cases"><a class="link" href="#_casos_de_prueba_test_cases">Casos de Prueba (Test Cases)</a></h4>
<div class="paragraph">
<p>Un caso de prueba es una especificación de un comportamiento que tu código debe tener. Cada test verifica una acción específica.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Estructura de un buen caso de prueba:</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Componente</th>
<th class="tableblock halign-left valign-top">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Setup/Arrange</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Preparar los datos necesarios</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Action/Act</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ejecutar el código a probar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Assertion/Assert</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verificar el resultado esperado</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Ejemplo completo (AAA Pattern):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">desc=ribe('Carrito de compras', () =&gt; {
  it('debe calcular el total correctamente con impuesto', () =&gt; {
    // ARRANGE - Preparar datos
    const carrito = new CarritoCompras(0.16); // 16% impuesto
    const producto1 = { nombre: 'Laptop', precio: 1000 };
    const producto2 = { nombre: 'Mouse', precio: 50 };

    // ACT - Ejecutar la acción
    carrito.agregar(producto1);
    carrito.agregar(producto2);
    const total = carrito.calcularTotal();

    // ASSERT - Verificar el resultado
    const esperado = (1000 + 50) * 1.16; // 1218
    if (total !== esperado) {
      throw new Error(
        `Esperado ${esperado}, obtuve ${total}`
      );
    }
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_assertions_aserciones"><a class="link" href="#_assertions_aserciones">Assertions / Aserciones</a></h4>
<div class="paragraph">
<p>Una aserción es una verificación booleana que debe ser verdadera. Si es falsa, el test falla.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Tipos comunes de aserciones:</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tipo</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Igualdad</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.equal(actual, esperado)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verificar valores iguales</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Tipo</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.strictEqual(5, '5')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verificar tipo y valor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Verdadero</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.ok(booleano)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verificar que es truthy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Falsedad</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.strictEqual(valor, false)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verificar que es falsy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Inclusión</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert(array.includes(item))</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verificar si contiene</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Excepción</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.throws) &#8658; fn(</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verificar que lanza error</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Eje=mplo de aserciones:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// Usando Node.js assert
import assert from 'assert';

describe('Aserciones', () =&gt; {
  it('debe verificar igualdad', () =&gt; {
    const resultado = 2 + 2;
    assert.equal(resultado, 4); // ✓ Pasa
  });

  it('debe verificar tipo y valor', () =&gt; {
    assert.strictEqual(5, 5); // ✓ Pasa
    // assert.strictEqual(5, '5'); // ✗ Fallaría
  });

  it('debe verificar que algo es verdadero', () =&gt; {
    assert.ok(true); // ✓ Pasa
    assert.ok('texto'); // ✓ Pasa (truthy)
  });

  it('debe verificar excepciones', () =&gt; {
    assert.throws(
      () =&gt; { throw new Error('Boom!'); },
      Error
    ); // ✓ Pasa
  });

  it('debe verificar inclusión en array', () =&gt; {
    const colores = ['rojo', 'azul', 'verde'];
    assert.ok(colores.includes('azul')); // ✓ Pasa
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fixtures"><a class="link" href="#_fixtures">Fixtures</a></h4>
<div class="paragraph">
<p>Las fixtures son datos o estados preparados que usa tu test. Son útiles para evitar repetir setup en cada test.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Tipos de fixtures:</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tipo</th>
<th class="tableblock halign-left valign-top">Uso</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Fixture estática</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datos fijos en archivos (JSON, etc.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Fixture dinámica</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datos generados en setup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Factory functions</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Funciones que crean objetos de prueba</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Fixtures con hooks</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Preparación con before/beforeEach</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Ejemplo sin fixtures (Código repetido):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Usuario', () =&gt; {
  it('debe calcular edad correctamente', () =&gt; {
    // Setup repetido
    const usuario = {
      nombre: 'Juan',
      apellido: 'Pérez',
      nacimiento: new Date(1990, 0, 1)
    };
    const edad = calcularEdad(usuario);
    assert.equal(edad &gt;= 30, true);
  });

  it('debe validar email del usuario', () =&gt; {
    // Setup repetido (similar)
    const usuario = {
      nombre: 'Juan',
      apellido: 'Pérez',
      email: 'juan@example.com'
    };
    assert.ok(validarEmail(usuario.email));
  });
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo CON fixtures (DRY - Don&#8217;t Repeat Yourself):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Usuario', () =&gt; {
  let usuario; // Fixture variable

  beforeEach(() =&gt; {
    // Setup común antes de cada test
    usuario = {
      nombre: 'Juan',
      apellido: 'Pérez',
      nacimiento: new Date(1990, 0, 1),
      email: 'juan@example.com'
    };
  });

  it('debe calcular edad correctamente', () =&gt; {
    const edad = calcularEdad(usuario);
    assert.equal(edad &gt;= 30, true);
  });

  it('debe validar email del usuario', () =&gt; {
    assert.ok(validarEmail(usuario.email));
  });
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Fixture factory function:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// Factory para crear usuarios
function crearUsuarioTest(overrides = {}) {
  return {
    nombre: 'Juan',
    apellido: 'Pérez',
    nacimiento: new Date(1990, 0, 1),
    email: 'juan@example.com',
    rol: 'usuario',
    ...overrides // Permite sobrescribir valores
  };
}

describe('Usuario', () =&gt; {
  it('debe funcionar con usuario normal', () =&gt; {
    const usuario = crearUsuarioTest();
    assert.equal(usuario.rol, 'usuario');
  });

  it('debe funcionar con usuario admin', () =&gt; {
    const admin = crearUsuarioTest({ rol: 'admin' });
    assert.equal(admin.rol, 'admin');
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mocks_y_stubs"><a class="link" href="#_mocks_y_stubs">Mocks y Stubs</a></h4>
<div class="paragraph">
<p>Estos son dobles de test que reemplazan dependencias reales.</p>
</div>
<div class="sect4">
<h5 id="_stubs_reemplazos"><a class="link" href="#_stubs_reemplazos">Stubs (Reemplazos)</a></h5>
<div class="paragraph">
<p>Un stub es un objeto que reemplaza una dependencia real y devuelve también datos predefinidos.</p>
</div>
<div class="ulist">
<div class="title">Usado para:</div>
<ul>
<li>
<p>Reemplazar llamadas a APIs externas</p>
</li>
<li>
<p>Evitar bases de datos reales</p>
</li>
<li>
<p>Controlar valores de retorno</p>
</li>
<li>
<p>Simular errores</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// Servicio real que queremos stubear
class ServicioClima {
  obtenerTemperatura(ciudad: string): Promise&lt;number&gt; {
    // Llamada real a API externa
    return fetch(`https://api.clima.com/${ciudad}`)
      .then(r =&gt; r.json());
  }
}

// En el test creamos un stub
describe('Aplicación de Clima', () =&gt; {
  it('debe mostrar temperatura', async () =&gt; {
    // Stub del servicio
    const servicioStub = {
      obtenerTemperatura: async () =&gt; 25 // Valor fijo
    };

    const app = new AplicacionClima(servicioStub);
    const resultado = await app.mostrarClima('Madrid');

    assert.equal(resultado, '25°C');
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_mocks_burlas"><a class="link" href="#_mocks_burlas">Mocks (Burlas)</a></h5>
<div class="paragraph">
<p>Un mock es similar a un stub, pero además verifica que fue llamado de forma específica.</p>
</div>
<div class="ulist">
<div class="title">Usado para:</div>
<ul>
<li>
<p>Verificar que se llamó un método</p>
</li>
<li>
<p>Verificar con qué argumentos se llamó</p>
</li>
<li>
<p>Verificar número de llamadas</p>
</li>
<li>
<p>Comportamiento esperado</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// Servicio de log que queremos verificar
class RegistroLog {
  registrar(mensaje: string): void {
    console.log(`[LOG] ${mensaje}`);
  }
}

describe('Mock de Log', () =&gt; {
  it('debe registrar evento de login', () =&gt; {
    // Mock del servicio
    let logCalls = [];
    const mockLog = {
      registrar: (mensaje: string) =&gt; {
        logCalls.push(mensaje);
      }
    };

    // Usar el servicio
    const authService = new AuthService(mockLog);
    authService.login('usuario@example.com', 'password');

    // Verificar que se llamó correctamente
    assert.equal(logCalls.length, 1);
    assert.ok(logCalls[0].includes('login'));
    assert.ok(logCalls[0].includes('usuario@example.com'));
  });
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_code_coverage_cobertura_de_código"><a class="link" href="#_code_coverage_cobertura_de_código">Code Coverage (Cobertura de Código)</a></h4>
<div class="paragraph">
<p>El code coverage mide qué porcentaje de tu código está siendo ejecutado por los tests.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tipo</th>
<th class="tableblock halign-left valign-top">Descripción</th>
<th class="tableblock halign-left valign-top">Meta</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Statement</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Líneas de código ejecutadas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80%+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Branch</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Caminos condicionales cubiertos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">75%+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Function</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Funciones llamadas en tests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80%+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Line</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Líneas específicas ejecutadas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80%+</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Ejemplo - Función sin cobertura completa:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">function validarEdad(edad: number): string {
  if (edad &lt; 18) {
    return 'Menor de edad'; // NO PROBADO
  }
  if (edad &gt; 65) {
    return 'Jubilado'; // NO PROBADO
  }
  return 'Adulto'; // PROBADO
}

// Test que solo prueba un caso
describe('validarEdad', () =&gt; {
  it('debe retornar adulto para edad 30', () =&gt; {
    assert.equal(validarEdad(30), 'Adulto');
  });
});
// Coverage: 33% (solo 1 de 3 branches)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo - Cobertura completa:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('validarEdad', () =&gt; {
  it('debe retornar menor para edad &lt; 18', () =&gt; {
    assert.equal(validarEdad(10), 'Menor de edad');
  });

  it('debe retornar adulto para 18-65', () =&gt; {
    assert.equal(validarEdad(30), 'Adulto');
  });

  it('debe retornar jubilado para edad &gt; 65', () =&gt; {
    assert.equal(validarEdad(70), 'Jubilado');
  });
});
// Coverage: 100% (todos los branches cubiertos)</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Meta de cobertura recomendada:</div>
<ul>
<li>
<p><strong>Código crítico</strong> (lógica de negocio): 85-100%</p>
</li>
<li>
<p><strong>Código importante</strong> (APIs): 75-85%</p>
</li>
<li>
<p><strong>Código de utilidad</strong>: 60-75%</p>
</li>
<li>
<p><strong>Nunca</strong> busques 100% ciegamente - calidad sobre cantidad</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_módulo_2_configuración_e_instalación"><a class="link" href="#_módulo_2_configuración_e_instalación">Módulo 2: Configuración e Instalación</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mocha es un framework de testing flexible que necesita instalación y configuración. Este módulo te guiará por todo el proceso de instalación y configuración inicial.</p>
</div>
<div class="sect2">
<h3 id="_2_1_instalación_de_mocha"><a class="link" href="#_2_1_instalación_de_mocha">2.1 Instalación de Mocha</a></h3>
<div class="sect3">
<h4 id="_qué_es_mocha"><a class="link" href="#_qué_es_mocha">¿Qué es Mocha?</a></h4>
<div class="paragraph">
<p>Mocha es un framework de testing moderno y flexible para JavaScript/TypeScript que ejecuta tests de forma secuencial y proporciona reporte detallados de resultados. Es agnóstico respecto a librerías de assertions (puedes usar assert nativo, Chai, etc.).</p>
</div>
<div class="ulist">
<div class="title">Características principales:</div>
<ul>
<li>
<p>Tests síncronos y asíncrono</p>
</li>
<li>
<p>Estructura clara con describe/it</p>
</li>
<li>
<p>Reportes detallados</p>
</li>
<li>
<p>Suite of tests opcional</p>
</li>
<li>
<p>Soporte para múltiples estilos de reporting</p>
</li>
<li>
<p>Plugins y extensiones</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_versiones_requeridas"><a class="link" href="#_versiones_requeridas">Versiones Requeridas</a></h4>
<div class="paragraph">
<p>Antes de instalar Mocha, verifica tus versiones:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Herramienta</th>
<th class="tableblock halign-left valign-top">Versión Mínima</th>
<th class="tableblock halign-left valign-top">Recomendada</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node.js</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18.x o superior</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">npm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9.x o superior</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yarn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.x o superior</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Verificar tu versión de Node.js:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">node= --version
# v18.12.0

npm --version
# 9.2.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si necesitas actualizar Node.js, descárgalo de <a href="https://nodejs.org/" class="bare">https://nodejs.org/</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_instalación_mediante_npm"><a class="link" href="#_instalación_mediante_npm">Instalación Mediante npm</a></h4>
<div class="paragraph">
<p>La instalación local es la más recomendada. Esto asegura que todos en el equipo usen la misma versión.</p>
</div>
<div class="listingblock">
<div class="title">Paso 1: Crear un proyecto (si no lo tienes)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir mi-proyecto-tests
cd mi-proyecto-tests
npm init -y</code></pre>
</div>
</div>
<div class="paragraph">
<p>El archivo <code>package.json</code> sería así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "mi-proyecto-tests",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Paso 2: Instalar Mocha como dependencia de desarrollo</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install --save-dev mocha</code></pre>
</div>
</div>
<div class="paragraph">
<p>Este comando:
- Descarga Mocha desde npm registry
- Se guarda en <code>node_modules/</code>
- Se añade a <code>devDependencies</code> en <code>package.json</code></p>
</div>
<div class="paragraph">
<p>Verificar instalación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npx mocha --version
# 10.2.0</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_instalación_mediante_yarn"><a class="link" href="#_instalación_mediante_yarn">Instalación Mediante Yarn</a></h4>
<div class="paragraph">
<p>Si prefieres usar Yarn:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yarn add --dev mocha</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verificar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yarn mocha --version</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_instalación_local_vs_global"><a class="link" href="#_instalación_local_vs_global">Instalación Local vs Global</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Aspecto</th>
<th class="tableblock halign-left valign-top">Local (Recomendado)</th>
<th class="tableblock halign-left valign-top">Global</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comando</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>npx mocha</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mocha</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">npm install</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>npm install --save-dev mocha</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>npm install -g mocha</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ubicación</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>node_modules/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/usr/local/lib/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equipo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consistente en todo el equipo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Puede variar por PC</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fácil de actualizar en proyecto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Más difícil de controlar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reproducibilidad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alta (mismo en CI/CD)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baja (pueden diferir versiones)</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Mej=or práctica: Instala siempre localmente</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># ✓ Recomendado
npm install --save-dev mocha

# ✗ Evita instalación global para proyectos
npm install -g mocha</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_crear_tu_primer_test"><a class="link" href="#_crear_tu_primer_test">Crear tu Primer Test</a></h4>
<div class="listingblock">
<div class="title">Paso 1: Crear directorio de tests</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir test</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Paso 2: Crear archivo test</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">touch test/suma.test.ts</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Paso 3: Escribir un test simple</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// test/suma.test.ts
function suma(a: number, b: number): number {
  return a + b;
}

describe('Función suma', () =&gt; {
  it('debe sumar 2 + 3 = 5', () =&gt; {
    const resultado = suma(2, 3);
    if (resultado !== 5) {
      throw new Error(`Esperado 5, obtuvo ${resultado}`);
    }
  });
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Paso 4: Actualizar package.json</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "scripts": {
    "test": "mocha 'test/**/*.test.ts'"
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Paso 5: Ejecutar test</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm test</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_2_2_configuración_inicial"><a class="link" href="#_2_2_configuración_inicial">2.2 Configuración Inicial</a></h3>
<div class="sect3">
<h4 id="_package_json_y_scripts_de_test"><a class="link" href="#_package_json_y_scripts_de_test">Package.json y Scripts de Test</a></h4>
<div class="paragraph">
<p>El archivo <code>package.json</code> es el punto central de configuración de tu proyecto Node.js.</p>
</div>
<div class="listingblock">
<div class="title">Estructura básica con tests:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "mi-proyecto",
  "version": "1.0.0",
  "description": "Proyecto con tests en Mocha",
  "main": "index.js",
  "scripts": {
    "test": "mocha 'test/**/*.test.ts'",
    "test:watch": "mocha 'test/**/*.test.ts' --watch",
    "test:coverage": "nyc mocha 'test/**/*.test.ts'",
    "test:debug": "mocha --inspect-brk 'test/**/*.test.ts'"
  },
  "devDependencies": {
    "mocha": "^10.2.0"
  },
  "keywords": ["testing"],
  "author": "Tu Nombre",
  "license": "MIT"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Scripts comunes:</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Script</th>
<th class="tableblock halign-left valign-top">Comando</th>
<th class="tableblock halign-left valign-top">Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>npm test</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ejecutar tests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test:watch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>npm run test:watch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ejecutar en modo observación</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test:coverage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>npm run test:coverage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generar reporte de cobertura</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test:debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>npm run test:debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debuggear tests</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Ejecutar scripts:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm test                    # Ejecuta tests
npm run test:watch         # Ejecuta y observa cambios
npm run test:coverage      # Genera coverage
npm run test:debug         # Modo debug en puerto 9229</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_archivo_mocha_opts_mocharc_json"><a class="link" href="#_archivo_mocha_opts_mocharc_json">Archivo mocha.opts / .mocharc.json</a></h4>
<div class="paragraph">
<p>Para configuraciones más complejas, puedes crear un archivo de configuración dedicado. Mocha puede leer configuración de varios formatos.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Opciones disponibles:</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Formato</th>
<th class="tableblock halign-left valign-top">Archivo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.mocharc.json</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">YAML</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.mocharc.yaml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JavaScript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.mocharc.js</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Heredado</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test/mocha.opts</code></p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Ejemplo .mocharc.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "require": "ts-node/register",
  "extensions": ["ts"],
  "spec": "test/**/*.test.ts",
  "timeout": 5000,
  "slow": 300,
  "reporter": "spec",
  "ui": "bdd"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Explicación de opciones:</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Opción</th>
<th class="tableblock halign-left valign-top">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>require</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Módulos a cargar antes de ejecutar tests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extensions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extensiones de archivo a buscar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spec</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Patrón de búsqueda de archivos test</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tiempo máximo por test en ms (5000 = 5s)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slow</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tiempo para marcar test como lento en ms (300ms)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reporter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Formato de reporte (spec, json, tap, etc.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ui</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Estilo de interfaz (bdd, tdd, qunit)</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Ejemplo .mocharc.js:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">module.exports = {
  require: 'ts-node/register',
  extensions: ['ts'],
  spec: 'test/**/*.test.ts',
  timeout: 5000,
  slow: 300,
  reporter: 'spec',
  ui: 'bdd',
  // Configuración dinámica
  globals: ['__DEV__'],
  // Ignorar archivos
  ignore: ['**/node_modules/**']
};</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuración_de_rutas"><a class="link" href="#_configuración_de_rutas">Configuración de Rutas</a></h4>
<div class="paragraph">
<p>Para trabajar con TypeScript y módulos, necesitas configurar las rutas correctamente.</p>
</div>
<div class="listingblock">
<div class="title">Estructura del proyecto recomendada:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">mi-proyecto/
├── src/
│   ├── index.ts
│   ├── utils.ts
│   └── math.ts
├── test/
│   ├── unit/
│   │   ├── math.test.ts
│   │   └── utils.test.ts
│   └── integration/
│       └── index.test.ts
├── .mocharc.json
├── tsconfig.json
└── package.json</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Patrón de búsqueda en .mocharc.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "spec": [
    "test/unit/**/*.test.ts",
    "test/integration/**/*.test.ts"
  ],
  "exclude": [
    "test/fixtures/**"
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejecutar solo tests unitarios:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mocha 'test/unit/**/*.test.ts'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejecutar tests que contienen "math":</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mocha --grep "math" 'test/**/*.test.ts'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_variables_de_entorno"><a class="link" href="#_variables_de_entorno">Variables de Entorno</a></h4>
<div class="paragraph">
<p>Las variables de entorno te permiten cambiar comportamientos según el contexto.</p>
</div>
<div class="listingblock">
<div class="title">Usando variables de entorno en tests:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// test/config.test.ts
describe('Configuración por entorno', () =&gt; {
  it('debe usar base URL correcta', () =&gt; {
    const base = process.env.API_URL || 'http://localhost:3000';
    console.log(`API URL: ${base}`);

    f (process.env.NODE_ENV === 'test') {
      // Lógica específica para tests
    }
  });
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Archivo .env para desarrollo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># .env
API_URL=http://localhost:3000
DATABASE_URL=mongodb://localhost:27017
NODE_ENV=development</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Instalar dotenv para cargar variables:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install --save-dev dotenv</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Usar en test setup:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// test/setup.ts
import dotenv from 'dotenv';

dotenv.config();

console.log(`Ejecutando tests en ${process.env.NODE_ENV}`);
console.log(`Base URL: ${process.env.API_URL}`);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Configurar en .mocharc.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "require": [
    "dotenv/config",
    "test/setup.ts"
  ],
  "spec": "test/**/*.test.ts"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejecutar con variables custom:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">API_URL=http://staging.api.com npm test
NODE_ENV=test npm run test:coverage</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_2_3_configuración_para_typescript"><a class="link" href="#_2_3_configuración_para_typescript">2.3 Configuración para TypeScript</a></h3>
<div class="paragraph">
<p>Mocha puede ejecutar TypeScript nativamente con ts-node, sin necesidad de compilar previamente.</p>
</div>
<div class="sect3">
<h4 id="_instalación_de_ts_node"><a class="link" href="#_instalación_de_ts_node">Instalación de ts-node</a></h4>
<div class="paragraph">
<p>ts-node es un ejecutor de TypeScript que compila sobre la marcha.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install --save-dev ts-node typescript</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verificar instalación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npx ts-node --version</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compilador_typescript_en_mocha"><a class="link" href="#_compilador_typescript_en_mocha">Compilador TypeScript en Mocha</a></h4>
<div class="listingblock">
<div class="title">Opción 1: Usar require en .mocharc.json</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "require": "ts-node/register",
  "extensions": ["ts"],
  "spec": "test/**/*.test.ts"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Opción 2: Usar loader moderno (Node.js 18+)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "loader": "ts-node/esm",
  "extensions": ["ts"],
  "spec": "test/**/*.test.ts",
  "node-option": "loader=ts-node/esm"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Opción 3: Usar require en consola</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npx mocha --require ts-node/register 'test/**/*.test.ts'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuración_de_tsconfig_json"><a class="link" href="#_configuración_de_tsconfig_json">Configuración de tsconfig.json</a></h4>
<div class="paragraph">
<p>Tu archivo <code>tsconfig.json</code> controla cómo se compila TypeScript.</p>
</div>
<div class="listingblock">
<div class="title">Configuración mínima para tests:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true
  },
  "include": ["src/**/*", "test/**/*"],
  "exclude": ["node_modules", "dist"]
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Explicación de opciones:</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Opción</th>
<th class="tableblock halign-left valign-top">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Versión de JavaScript objetivo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>module</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sistema de módulos (commonjs para Node.js)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strict</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modo estricto para mayor seguridad</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sourceMap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mapeos para debugging</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>skipLibCheck</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No verificar archivos .d.ts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>esModuleInterop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compatibilidad con módulos ES6</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_sourcemaps_para_debugging"><a class="link" href="#_sourcemaps_para_debugging">Sourcemaps para Debugging</a></h5>
<div class="paragraph">
<p>Los sourcemaps permiten debuggear el TypeScript original, no el JavaScript compilado.</p>
</div>
<div class="listingblock">
<div class="title">Habilitar sourcemaps en tsconfig.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "compilerOptions": {
    "sourceMap": true,
    "inlineSourceMap": false,
    "inlineSources": false
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Configurar en .mocharc.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "require": "ts-node/register",
  "extensions": ["ts"],
  "spec": "test/**/*.test.ts",
  "node-option": [
    "loader=ts-node/esm",
    "enable-source-maps"
  ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_completo_proyecto_typescript_mocha"><a class="link" href="#_ejemplo_completo_proyecto_typescript_mocha">Ejemplo Completo: Proyecto TypeScript + Mocha</a></h4>
<div class="listingblock">
<div class="title">1. Estructura del proyecto:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir proyecto-ts-mocha
cd proyecto-ts-mocha
npm init -y</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">2. Instalar dependencias:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install --save-dev mocha ts-node typescript chai @types/node @types/chai</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">3. Crear archivos:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Crear directorios
mkdir -p src test

# Crear archivos
touch src/calculator.ts
touch test/calculator.test.ts
touch tsconfig.json
touch .mocharc.json</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">4. Implementación (src/calculator.ts):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class Calculadora {
  sumar(a: number, b: number): number {
    return a + b;
  }

  restar(a: number, b: number): number {
    return a - b;
  }

  multiplicar(a: number, b: number): number {
    return a * b;
  }

  dividir(a: number, b: number): number {
    f (b === 0) {
      throw new Error('No se puede dividir por cero');
    }
    return a / b;
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">5. Test (test/calculator.test.ts):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import { Calculadora } from '../src/calculator';

describe('Clase Calculadora', () =&gt; {
  let calc: Calculadora;

  beforeEach(() =&gt; {
    calc = new Calculadora();
  });

  describe('método sumar', () =&gt; {
    it('debe sumar dos números positivos', () =&gt; {
      expect(calc.sumar(2, 3)).to.equal(5);
    });

    it('debe sumar números negativos', () =&gt; {
      expect(calc.sumar(-2, -3)).to.equal(-5);
    });
  });

  describe('método dividir', () =&gt; {
    it('debe dividir números correctamente', () =&gt; {
      expect(calc.dividir(10, 2)).to.equal(5);
    });

    it('debe lanzar error al dividir por cero', () =&gt; {
      expect(() =&gt; calc.dividir(10, 0))
        .to.throw('No se puede dividir por cero');
    });
  });
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">6. tsconfig.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "sourceMap": true,
    "declaration": true
  },
  "include": ["src/**/*", "test/**/*"],
  "exclude": ["node_modules"]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">7. .mocharc.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "require": "ts-node/register",
  "extensions": ["ts"],
  "spec": "test/**/*.test.ts",
  "timeout": 5000,
  "slow": 300,
  "reporter": "spec"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">8. Actualizar package.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "scripts": {
    "test": "mocha",
    "test:watch": "mocha --watch --watch-extensions ts"
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">9. Ejecutar tests:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm test

# Salida esperada:
#   Clase Calculadora
#     método sumar
#       ✓ debe sumar dos números positivos
#       ✓ debe sumar números negativos
#     método dividir
#       ✓ debe dividir números correctamente
#       ✓ debe lanzar error al dividir por cero
#
#   4 passing (5ms)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshooting_común"><a class="link" href="#_troubleshooting_común">Troubleshooting Común</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Problema</th>
<th class="tableblock halign-left valign-top">Causa</th>
<th class="tableblock halign-left valign-top">Solución</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Cannot find module 'ts-node'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ts-node no está instalado</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>npm install --save-dev ts-node</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Cannot find module 'typescript'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TypeScript no instalado</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>npm install --save-dev typescript</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Timeout error</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test toma más de 5s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aumentar timeout en .mocharc.json</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sourcemap error</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SourceMap no generado</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Habilitar <code>sourceMap: true</code> en tsconfig.json</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Module not found</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ruta incorrecta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verificar paths en tsconfig.json</p></td>
</tr>
</tbody>
</table>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_módulo_3_sintaxis_y_api_de_mocha"><a class="link" href="#_módulo_3_sintaxis_y_api_de_mocha">Módulo 3: Sintaxis y API de Mocha</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Este módulo cubre la sintaxis fundamental de Mocha y cómo usar sus APIs para escribir tests efectivos. Mocha proporciona una interfaz simple pero poderosa para organizar y ejecutar tus tests.</p>
</div>
<div class="sect2">
<h3 id="_3_1_hooks_y_bloques_de_prueba"><a class="link" href="#_3_1_hooks_y_bloques_de_prueba">3.1 Hooks y Bloques de Prueba</a></h3>
<div class="sect3">
<h4 id="_describe_agrupación_de_tests"><a class="link" href="#_describe_agrupación_de_tests">describe() - Agrupación de Tests</a></h4>
<div class="paragraph">
<p><code>describe()</code> es una función que agrupa tests relacionados en un bloque lógico. Te permite organizarlos jerárquicamente y crear contextos específicos.</p>
</div>
<div class="listingblock">
<div class="title">Sintaxis básica:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Descripción del grupo', () =&gt; {
  // Tests aquí
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo simple:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Función sumar', () =&gt; {
  it('debe sumar dos números positivos', () =&gt; {
    // Test aquí
  });

  it('debe sumar números negativos', () =&gt; {
    // Test aquí
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_it_test_definición_de_casos_de_prueba"><a class="link" href="#_it_test_definición_de_casos_de_prueba">it() / test() - Definición de Casos de Prueba</a></h4>
<div class="paragraph">
<p><code>it()</code> (alias <code>test()</code>) define un caso de prueba individual. Cada <code>it()</code> representa una expectativa específica del código.</p>
</div>
<div class="listingblock">
<div class="title">Sintaxis:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">it('descripción del comportamiento esperado', () =&gt; {
  // Código de prueba
});

// O equivalentemente:
test('descripción del comportamiento esperado', () =&gt; {
  // Código de prueba
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Estructura recomendada (AAA Pattern):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Clase Usuario', () =&gt; {
  it('debe crear un usuario con nombre y email válidos', () =&gt; {
    // ARRANGE - Preparar datos
    const datos = { nombre: 'Juan', email: 'juan@example.com' };

    // ACT - Ejecutar la acción
    const usuario = new Usuario(datos);

    // ASSERT - Verificar resultados
    if (usuario.nombre !== 'Juan') {
      throw new Error('El nombre no se asignó correctamente');
    }
    if (usuario.email !== 'juan@example.com') {
      throw new Error('El email no se asignó correctamente');
    }
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_anidamiento_de_bloques_describe"><a class="link" href="#_anidamiento_de_bloques_describe">Anidamiento de Bloques describe()</a></h4>
<div class="paragraph">
<p>Puedes anidar <code>describe()</code> para crear una estructura jerárquica que refleje la organización de tu código.</p>
</div>
<div class="listingblock">
<div class="title">Estructura anidada:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Aplicación de Banco', () =&gt; {
  describe('Clase Cuenta', () =&gt; {
    describe('método depositar', () =&gt; {
      it('debe aumentar el balance', () =&gt; {
        const cuenta = new Cuenta(1000);
        cuenta.depositar(500);
        if (cuenta.balance !== 1500) {
          throw new Error('Balance incorrecto');
        }
      });
    });

    describe('método retirar', () =&gt; {
      it('debe disminuir el balance', () =&gt; {
        const cuenta = new Cuenta(1000);
        cuenta.retirar(300);
        if (cuenta.balance !== 700) {
          throw new Error('Balance incorrecto');
        }
      });

      it('debe lanzar error si el saldo es insuficiente', () =&gt; {
        const cuenta = new Cuenta(100);
        try {
          cuenta.retirar(500);
          throw new Error('Debería haber lanzado un error');
        } catch (e) {
          if (!e.message.includes('Saldo insuficiente')) {
            throw e;
          }
        }
      });
    });
  });
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Salida esperada:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Aplicación de Banco
  Clase Cuenta
    método depositar
      ✓ debe aumentar el balance
    método retirar
      ✓ debe disminuir el balance
      ✓ debe lanzar error si el saldo es insuficiente

3 passing</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_callbacks_vs_promises_vs_asyncawait"><a class="link" href="#_callbacks_vs_promises_vs_asyncawait">Callbacks vs Promises vs Async/Await</a></h4>
<div class="paragraph">
<p>Mocha soporta tres formas de manejar código asíncrono:</p>
</div>
<div class="listingblock">
<div class="title">1. Callbacks con done:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Callbacks', () =&gt; {
  it('debe esperar a que se complete una callback', (done) =&gt; {
    setTimeout(() =&gt; {
      // Verificar resultado
      if (true) {
        done(); // Indica que el test terminó
      } else {
        done(new Error('Test falló'));
      }
    }, 100);
  });
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">2. Promises:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Promises', () =&gt; {
  it('debe esperar a que se resuelva una promesa', () =&gt; {
    return new Promise((resolve, reject) =&gt; {
      setTimeout(() =&gt; {
        resolve('Éxito');
      }, 100);
    }).then(resultado =&gt; {
      if (resultado !== 'Éxito') {
        throw new Error('Resultado incorrecto');
      }
    });
  });
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">3. Async/Await (Recomendado):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Async/Await', () =&gt; {
  it('debe esperar con async/await', async () =&gt; {
    const resultado = await new Promise((resolve) =&gt; {
      setTimeout(() =&gt; resolve('Éxito'), 100);
    });

    if (resultado !== 'Éxito') {
      throw new Error('Resultado incorrecto');
    }
  });
});</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Comparación de estilos:</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Estilo</th>
<th class="tableblock halign-left valign-top">Uso</th>
<th class="tableblock halign-left valign-top">Ventajas</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Callback</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Código muy viejo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compatible con cualquier navegador</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Promise</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Código moderno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mejor que callbacks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Async/Await</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recomendado</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Más legible, más fácil de entender</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Ejemplo práctico con API:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">desc=ribe('Llamadas a API', () =&gt; {
  it('debe obtener usuario desde API con async/await', async () =&gt; {
    // ARRANGE
    const userId = 1;

    // ACT
    const response = await fetch(`https://api.example.com/users/${userId}`);
    const usuario = await response.json();

    // ASSERT
    if (!usuario.id) {
      throw new Error('Usuario no tiene ID');
    }
    if (usuario.id !== userId) {
      throw new Error('ID no coincide');
    }
  });
});</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_3_2_hooks_del_ciclo_de_vida"><a class="link" href="#_3_2_hooks_del_ciclo_de_vida">3.2 Hooks del Ciclo de Vida</a></h3>
<div class="paragraph">
<p>Los hooks son funciones especiales que se ejecutan en momentos específicos del ciclo de vida de los tests. Son útiles para setup y teardown.</p>
</div>
<div class="sect3">
<h4 id="_before_antes_de_todos_los_tests"><a class="link" href="#_before_antes_de_todos_los_tests">before() - Antes de Todos los Tests</a></h4>
<div class="paragraph">
<p><code>before()</code> ejecuta una sola vez antes de que se ejecuten todos los tests en un bloque <code>describe()</code>.</p>
</div>
<div class="listingblock">
<div class="title">Caso de uso: Configuración global</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Base de Datos', () =&gt; {
  let baseDatos;

  before(async () =&gt; {
    // Se ejecuta UNA SOLA VEZ, antes de todos los tests
    console.log('Conectando a base de datos...');
    baseDatos = new BaseDatos();
    await baseDatos.conectar('mongodb://localhost:27017');
  });

  it('debe insertar un documento', async () =&gt; {
    const resultado = await baseDatos.insertar({ nombre: 'Juan' });
    if (!resultado.id) {
      throw new Error('No se creó el documento');
    }
  });

  it('debe obtener un documento', async () =&gt; {
    const usuario = await baseDatos.obtenerPor({ nombre: 'Juan' });
    if (!usuario) {
      throw new Error('Usuario no encontrado');
    }
  });
});

// Salida:
// Conectando a base de datos...
// ✓ debe insertar un documento
// ✓ debe obtener un documento</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_after_después_de_todos_los_tests"><a class="link" href="#_after_después_de_todos_los_tests">after() - Después de Todos los Tests</a></h4>
<div class="paragraph">
<p><code>after()</code> ejecuta una sola vez después de que terminen todos los tests en un bloque <code>describe()</code>.</p>
</div>
<div class="listingblock">
<div class="title">Caso de uso: Limpieza global</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Base de Datos', () =&gt; {
  let baseDatos;

  before(async () =&gt; {
    baseDatos = new BaseDatos();
    await baseDatos.conectar('mongodb://localhost:27017');
  });

  it('debe insertar documento', async () =&gt; {
    // Test...
  });

  after(async () =&gt; {
    // Se ejecuta UNA SOLA VEZ, después de todos los tests
    console.log('Cerrando conexión a base de datos...');
    await baseDatos.desconectar();
  });
});

// Salida:
// ✓ debe insertar documento
// Cerrando conexión a base de datos...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_beforeeach_antes_de_cada_test"><a class="link" href="#_beforeeach_antes_de_cada_test">beforeEach() - Antes de Cada Test</a></h4>
<div class="paragraph">
<p><code>beforeEach()</code> ejecuta antes de cada test individual en un bloque <code>describe()</code>.</p>
</div>
<div class="listingblock">
<div class="title">Caso de uso: Setup/Reset de estado</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Carrito de Compras', () =&gt; {
  let carrito;

  beforeEach(() =&gt; {
    // Se ejecuta ANTES DE CADA TEST
    console.log('Creando carrito vacío...');
    carrito = new Carrito();
  });

  it('debe estar vacío al iniciarse', () =&gt; {
    if (carrito.items.length !== 0) {
      throw new Error('Carrito no vacío');
    }
  });

  it('debe agregar productos', () =&gt; {
    carrito.agregar({ nombre: 'Laptop', precio: 1000 });
    if (carrito.items.length !== 1) {
      throw new Error('Producto no agregado');
    }
  });

  it('debe calcular total correctamente', () =&gt; {
    carrito.agregar({ nombre: 'Mouse', precio: 50 });
    carrito.agregar({ nombre: 'Teclado', precio: 100 });
    const total = carrito.calcularTotal();
    if (total !== 150) {
      throw new Error('Total incorrecto');
    }
  });
});

// Salida:
// Creando carrito vacío...
// ✓ debe estar vacío al iniciarse
// Creando carrito vacío...
// ✓ debe agregar productos
// Creando carrito vacío...
// ✓ debe calcular total correctamente</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_aftereach_después_de_cada_test"><a class="link" href="#_aftereach_después_de_cada_test">afterEach() - Después de Cada Test</a></h4>
<div class="paragraph">
<p><code>afterEach()</code> ejecuta después de cada test individual.</p>
</div>
<div class="listingblock">
<div class="title">Caso de uso: Limpieza de estado</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Sistema de Archivos', () =&gt; {
  let sistema;

  beforeEach(() =&gt; {
    sistema = new SistemaArchivos();
  });

  afterEach(async () =&gt; {
    // Se ejecuta DESPUÉS DE CADA TEST
    console.log('Limpiando archivos de test...');
    await sistema.limpiar();
  });

  it('debe crear archivo', () =&gt; {
    sistema.crearArchivo('test.txt', 'contenido');
    if (!sistema.existeArchivo('test.txt')) {
      throw new Error('Archivo no creado');
    }
  });

  it('debe escribir contenido', () =&gt; {
    sistema.crearArchivo('data.json', '{"id": 1}');
    const contenido = sistema.leerArchivo('data.json');
    if (contenido !== '{"id": 1}') {
      throw new Error('Contenido incorrecto');
    }
  });
});

// Salida:
// ✓ debe crear archivo
// Limpiando archivos de test...
// ✓ debe escribir contenido
// Limpiando archivos de test...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_timeout_en_hooks"><a class="link" href="#_timeout_en_hooks">Timeout en Hooks</a></h4>
<div class="paragraph">
<p>Los hooks tienen un timeout por defecto de 2000ms. Puedes personalizarlo:</p>
</div>
<div class="listingblock">
<div class="title">Aumentar timeout de un hook:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Operaciones Lentas', () =&gt; {
  before(function(done) {
    this.timeout(5000); // Esperar 5 segundos

    // Operación que toma tiempo
    setTimeout(() =&gt; {
      done();
    }, 4500);
  });

  it('debe completar operación', () =&gt; {
    // Test...
  });
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Deshabilitar timeout en un hook:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">before(function(done) {
  this.timeout(0); // Sin timeout

  // Operación de duración indefinida
  largaOperacion().then(() =&gt; done());
});</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Tabla de timeouts:</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Contexto</th>
<th class="tableblock halign-left valign-top">Timeout por defecto</th>
<th class="tableblock halign-left valign-top">Se puede cambiar</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sí</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hook</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sí</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Async hook</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sí</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_orden_de_ejecución"><a class="link" href="#_orden_de_ejecución">Orden de Ejecución</a></h4>
<div class="paragraph">
<p>Es importante entender el orden exacto:
=</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">describe('Suite de Tests', () =&gt; {
  before(() =&gt; console.log('1. before - una sola vez'));

  beforeEach(() =&gt; console.log('2. beforeEach'));

  it('primer test', () =&gt; console.log('3. test 1'));

  beforeEach(() =&gt; console.log('2. beforeEach'));

  it('segundo test', () =&gt; console.log('3. test 2'));

  afterEach(() =&gt; console.log('4. afterEach'));

  after(() =&gt; console.log('5. after - una sola vez'));
});

// Salida:
// 1. before - una sola vez
// 2. beforeEach
// 3. test 1
// 4. afterEach
// 2. beforeEach
// 3. test 2
// 4. afterEach
// 5. after - una sola vez</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_3_3_control_de_ejecución"><a class="link" href="#_3_3_control_de_ejecución">3.3 Control de Ejecución</a></h3>
<div class="sect3">
<h4 id="_skip_saltar_tests"><a class="link" href="#_skip_saltar_tests">skip() - Saltar Tests</a></h4>
<div class="paragraph">
<p>Usa <code>skip()</code> para omitir un test sin eliminarlo.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe.skip('Suite completa omitida', () =&gt; {
  // Ninguno de estos tests se ejecuta
  it('no se ejecuta', () =&gt; {});
});

it.skip('test individual omitido', () =&gt; {
  // Este test no se ejecuta
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Caso de uso: Tests pending (Por implementar)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Funcionalidad en Desarrollo', () =&gt; {
  it.skip('debe soportar búsqueda avanzada', () =&gt; {
    // Aún no implementado
  });

  it.skip('debe exportar a PDF', () =&gt; {
    // Aún no implementado
  });

  it('debe listar usuarios', () =&gt; {
    const usuarios = usuariosService.listar();
    if (!Array.isArray(usuarios)) {
      throw new Error('No es array');
    }
  });
});

// Salida:
// ✓ debe listar usuarios
// - debe soportar búsqueda avanzada (pendiente)
// - debe exportar a PDF (pendiente)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Saltar condicionalmente:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Integración con Stripe', () =&gt; {
  const tieneStripeKey = !!process.env.STRIPE_API_KEY;

  it(tieneStripeKey ? 'debe procesar pago' : 'SKIP: debe procesar pago',
    () =&gt; {
      // Test solo se ejecuta si STRIPE_API_KEY está configurada
      const pago = procesarPago({ monto: 100 });
      if (!pago.id) {
        throw new Error('Pago no procesado');
      }
    }
  );
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_only_ejecutar_solo_tests_específicos"><a class="link" href="#_only_ejecutar_solo_tests_específicos">only() - Ejecutar Solo Tests Específicos</a></h4>
<div class="paragraph">
<p>Usa <code>only()</code> para ejecutar solo un test o suite específica. Útil durante debugging.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe.only('Solo esta suite se ejecuta', () =&gt; {
  it('se ejecuta', () =&gt; {
    // Este test se ejecuta
  });
});

describe('Esta suite NO se ejecuta', () =&gt; {
  it('no se ejecuta', () =&gt; {
    // Este test se omite
  });
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Debugging con only:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Servicio de Usuarios', () =&gt; {
  it('debe crear usuario', () =&gt; {
    // ...
  });

  it.only('debe validar email (debugging)', () =&gt; {
    // Solo este test se ejecuta
    const isValid = validarEmail('usuario@example.com');
    if (!isValid) {
      throw new Error('Email no válido');
    }
  });

  it('debe hash contraseña', () =&gt; {
    // Este test se omite
  });
});

// Salida:
// ✓ debe validar email (debugging)
// 2 skipped (solo se ejecutó 1)</code></pre>
</div>
</div>
<div class="paragraph">
<p>⚠️ <strong>Advertencia:</strong> Recuerda remover <code>.only()</code> antes de hacer commit, para evitar que otros tests no se ejecuten en CI/CD.</p>
</div>
</div>
<div class="sect3">
<h4 id="_this_retries_reintentos"><a class="link" href="#_this_retries_reintentos">this.retries() - Reintentos</a></h4>
<div class="paragraph">
<p>Reintentar un test un número específico de veces si falla.</p>
</div>
<div class="listingblock">
<div class="title">Syntax:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">it('debe reconectar y reintentarlo', function() {
  this.retries(3); // Reintentar hasta 3 veces

  // Si falla, Mocha lo intenta de nuevo
  const conexion = establecerConexion();
  if (!conexion) {
    throw new Error('Conexión fallida');
  }
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Caso de uso: Tests de red flaky</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Integración con API Externa', () =&gt; {
  it('debe obtener datos con reintentos', function() {
    this.retries(2); // Intentar hasta 3 veces (1 + 2 reintentos)

    const datos = fetch('https://api-inestable.com/datos')
      .then(r =&gt; r.json());

    if (!datos.id) {
      throw new Error('Datos incompletos');
    }
  });
});

// Si falla el primer intento, lo reintenta
// Salida posible:
// ✓ debe obtener datos con reintentos (intento 3)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Timeout con reintentos:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">it('descarga archivo grande', function() {
  this.timeout(10000); // 10 segundos por intento
  this.retries(2);     // Reintentar si toma más de 10s

  // Descargar archivo...
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_this_timeout_personalizar_timeout"><a class="link" href="#_this_timeout_personalizar_timeout">this.timeout() - Personalizar Timeout</a></h4>
<div class="paragraph">
<p>Cambiar el timeout de un test específico:</p>
</div>
<div class="listingblock">
<div class="title">Timeout aumentado:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">it('debe procesar gran volumen de datos', function() {
  this.timeout(30000); // 30 segundos

  const resultado = procesarGranVolumen([...mucho_datos]);
  if (!resultado) {
    throw new Error('Procesamiento falló');
  }
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Deshabilitar timeout:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">it('operación de duración indefinida', function() {
  this.timeout(0); // Sin límite de tiempo

  while (true) {
    // Operación que podría ser infinita
  }
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Timeout muy corto:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">it('debe responder rápidamente', function() {
  this.timeout(100); // Solo 100ms

  const inicio = Date.now();
  const resultado = operacionRapida();
  const duracion = Date.now() - inicio;

  if (duracion &gt; 50) {
    throw new Error('Operación muy lenta');
  }
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_combinando_opciones"><a class="link" href="#_combinando_opciones">Combinando Opciones</a></h4>
<div class="paragraph">
<p>Puedes combinar varias opciones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Sincronización de Datos', () =&gt; {
  it('debe sincronizar en paralelo', function() {
    this.timeout(15000);    // Timeout más largi
    this.retries(2);        // Reintentar si falla
    this.slow(5000);        // Marcar como lento si &gt; 5s

    return Promise.all([
      sincronizar('usuarios'),
      sincronizar('productos'),
      sincronizar('pedidos')
    ]);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tabla_de_control_de_ejecución"><a class="link" href="#_tabla_de_control_de_ejecución">Tabla de Control de Ejecución</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 37.5%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Función</th>
<th class="tableblock halign-left valign-top">Propósito</th>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top">Resultado</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>it.skip()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Omitir test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test individual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marcado como pendiente</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>describe.skip()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Omitir suite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suite completa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Todos omitidos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>it.only()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ejecutar solo este</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test individual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Solo este se ejecuta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>describe.only()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ejecutar solo suite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Solo esta se ejecuta</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>this.retries(n)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reintentar n veces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test individual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Se reintenta si falla</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>this.timeout(ms)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Establecer timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test/Hook</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error si excede tiempo</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_ejemplo_completo_control_de_ejecución"><a class="link" href="#_ejemplo_completo_control_de_ejecución">Ejemplo Completo: Control de Ejecución</a></h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Gestión de Usuarios', () =&gt; {

  it('debe crear usuario', function() {
    this.timeout(5000);
    const usuario = new Usuario({ nombre: 'Ana', email: 'ana@test.com' });
    if (!usuario.id) throw new Error('No tiene ID');
  });

  it.skip('debe enviar email de bienvenida', () =&gt; {
    // Por implementar
  });

  it('debe buscar usuario por email', function() {
    this.retries(2);
    const usuario = buscarPor({ email: 'juan@test.com' });
    if (!usuario) throw new Error('Usuario no encontrado');
  });

  describe('Validaciones', () =&gt; {
    it('debe validar email', () =&gt; {
      if (!validarEmail('invalido')) {
        throw new Error('Debería rechazar email inválido');
      }
    });

    it.only('debe validar contraseña fuerte', () =&gt; {
      const esValida = validarPassword('Abc123!@#');
      if (!esValida) throw new Error('Contraseña no validada');
    });

    it('debe hashear contraseña', () =&gt; {
      // Este no se ejecuta porque hay .only()
    });
  });
});

// Salida esperada:
// Gestión de Usuarios
//   ✓ debe crear usuario
//   - debe enviar email de bienvenida (pendiente)
//   ✓ debe buscar usuario por email
//   Validaciones
//     ✓ debe validar contraseña fuerte
//     1 skipped (solo se ejecutó 1 de 2 tests en Validaciones)</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_módulo_4_assertions_y_librerías_de_assert"><a class="link" href="#_módulo_4_assertions_y_librerías_de_assert">Módulo 4: Assertions y Librerías de Assert</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Las aserciones sont el corazón de cualquier test. Son verificaciones que confirman que el código se comporta como se espera. Este módulo explora cómo usar aserciones nativas de Node.js y la poderosa librería Chai.</p>
</div>
<div class="sect2">
<h3 id="_4_1_métodos_de_assert_nativos"><a class="link" href="#_4_1_métodos_de_assert_nativos">4.1 Métodos de Assert Nativos</a></h3>
<div class="paragraph">
<p>Node.js proporciona el módulo <code>assert</code> nativo que no requiere instalación. Es simple pero efectivo.</p>
</div>
<div class="sect3">
<h4 id="_introducción_a_assert"><a class="link" href="#_introducción_a_assert">Introducción a Assert</a></h4>
<div class="paragraph">
<p>El módulo <code>assert</code> de Node.js proporciona afirmaciones para testing. Es la forma más básica y no requiere dependencias adicionales.</p>
</div>
<div class="listingblock">
<div class="title">Instalar assert (incluido en Node.js):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// Ya viene con Node.js, solo importar
import assert from 'assert';</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_assert_equal_igualdad_flexible"><a class="link" href="#_assert_equal_igualdad_flexible">assert.equal() - Igualdad Flexible</a></h4>
<div class="paragraph">
<p>Verifica que dos valores sean iguales usando <code>==</code> (coerción de tipos).</p>
</div>
<div class="listingblock">
<div class="title">Sintaxis:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">assert.equal(actual, esperado, [mensaje]);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import assert from 'assert';

describe('assert.equal()', () =&gt; {
  it('debe verificar igualdad con coerción', () =&gt; {
    assert.equal(5, 5);              // ✓ Pasa
    assert.equal('5', 5);            // ✓ Pasa (coerción: 5 == '5')
    assert.equal(true, 1);           // ✓ Pasa (coerción: true == 1)
  });

  it('debe fallar con valores diferentes', () =&gt; {
    try {
      assert.equal(5, 6);
    } catch (err) {
      console.log(err.message); // '5 == 6'
    }
  });

  it('debe permitir mensaje personalizado', () =&gt; {
    try {
      assert.equal(resultado, esperado, 'El resultado no coincide');
    } catch (err) {
      console.log(err.message); // 'El resultado no coincide'
    }
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_assert_strictequal_igualdad_estricta"><a class="link" href="#_assert_strictequal_igualdad_estricta">assert.strictEqual() - Igualdad Estricta</a></h4>
<div class="paragraph">
<p>erifica que dos valores sean iguales usando <code>===</code> (sin coerción).</p>
</div>
<div class="listingblock">
<div class="title">Sintaxis:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">assert.strictEqual(actual, esperado, [mensaje]);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import assert from 'assert';

describe('assert.strictEqual()', () =&gt; {
  it('debe verificar igualdad estricta (tipo y valor)', () =&gt; {
    assert.strictEqual(5, 5);         // ✓ Pasa
  });

  it('debe fallar si tipos diferentes', () =&gt; {
    try {
      assert.strictEqual(5, '5');     // ✗ Falla (5 !== '5')
    } catch (err) {
      / Error: 5 === '5'
    }
  });

  it('ejemplo práctico: validar tipos', () =&gt; {
    const usuario = { id: 1, nombre: 'Juan' };

    assert.strictEqual(typeof usuario.id, 'number');
    assert.strictEqual(typeof usuario.nombre, 'string');
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_assert_ok_verificación_booleana"><a class="link" href="#_assert_ok_verificación_booleana">assert.ok() - Verificación Booleana</a></h4>
<div class="paragraph">
<p>Verifica que un valor sea truthy (verdadero en contexto booleano).</p>
</div>
<div class="listingblock">
<div class="title">Sintaxis:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">assert.ok(valor, [mensaje]);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import assert from 'assert';

describe('assert.ok()', () =&gt; {
  it('debe verificar valores truthy', () =&gt; {
    assert.ok(true);                 // ✓ Pasa
    assert.ok('texto');              // ✓ Pasa (string no vacío es truthy)
    assert.ok([1, 2, 3]);            // ✓ Pasa (array es truthy)
    assert.ok({ id: 1 });            // ✓ Pasa (objeto es truthy)
  });

  it('debe fallar con valores falsy', () =&gt; {
    try {
      assert.ok(false);              // ✗ Falla
      assert.ok('');                 // ✗ Falla (string vacío)
      assert.ok(null);               // ✗ Falla
      assert.ok(undefined);          // ✗ Falla
    } catch (err) {
      // Error
    }
  });

  it('ejemplo práctico: validación', () =&gt; {
    const usuario = { nombre: 'Ana' };

    assert.ok(usuario.nombre);       // Verifica que nombre existe y no es falsy
    assert.ok(usuario.nombre.length &gt; 0);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_assert_throws_verificación_de_excepciones"><a class="link" href="#_assert_throws_verificación_de_excepciones">assert.throws() - Verificación de Excepciones</a></h4>
<div class="paragraph">
<p>Verifica que una función lance una excepción.</p>
</div>
<div class="listingblock">
<div class="title">Sintaxis:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">assert.throws(funcion, [tipo_error], [mensaje]);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import assert from 'assert';

function dividir(a: number, b: number): number {
  f (b === 0) {
    throw new Error('No se puede dividir por cero');
  }
  return a / b;
}

describe('assert.throws()', () =&gt; {
  it('debe verificar que se lanza una excepción', () =&gt; {
    assert.throws(() =&gt; dividir(10, 0));
  });

  it('debe verificar el tipo de error', () =&gt; {
    assert.throws(
      () =&gt; dividir(10, 0),
      Error                          // Verificar que es Error
    );
  });

  it('debe verificar el mensaje de error', () =&gt; {
    assert.throws(
      () =&gt; dividir(10, 0),
      /No se puede dividir por cero/  // Regex del mensaje
    );
  });

  it('debe fallar si no se lanza excepción', () =&gt; {
    try {
      assert.throws(() =&gt; dividir(10, 2));  // ✗ No lanza error
    } catch (err) {
      console.log('Test falló: no se lanzó excepción');
    }
  });

  it('ejemplo práctico: validación de entrada', () =&gt; {
    function crearUsuario(email: string) {
      if (!email.includes('@')) {
        throw new Error('Email inválido');
      }
      return { email };
    }

    assert.throws(
      () =&gt; crearUsuario('usuariosinvalido'),
      /Email inválido/
    );
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_assert_rejects_verificación_de_promises_rechazadas"><a class="link" href="#_assert_rejects_verificación_de_promises_rechazadas">assert.rejects() - Verificación de Promises Rechazadas</a></h4>
<div class="paragraph">
<p>Verifica que una promesa se rechace (funciona con async/await).</p>
</div>
<div class="listingblock">
<div class="title">Sintaxis:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">await assert.rejects(promesa, [tipo_error], [mensaje]);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import assert from 'assert';

async function obtenerUsuario(id: number) {
  if (id &lt;= 0) {
    throw new Error('ID debe ser positivo');
  }
  return { id, nombre: 'Juan' };
}

describe('assert.rejects()', () =&gt; {
  it('debe verificar rechazo de promesa', async () =&gt; {
    await assert.rejects(async () =&gt; {
      await obtenerUsuario(-1);
    });
  });

  it('debe verificar tipo de error', async () =&gt; {
    await assert.rejects(
      async () =&gt; await obtenerUsuario(0),
      Error
    );
  });

  it('debe verificar mensaje de error', async () =&gt; {
    await assert.rejects(
      async () =&gt; await obtenerUsuario(-5),
      /ID debe ser positivo/
    );
  });

  it('debe permitir acceso al error', async () =&gt; {
    try {
      await assert.rejects(
        async () =&gt; await obtenerUsuario(-1)
      );
    } catch (err) {
      assert.ok(err.message.includes('ID debe ser positivo'));
    }
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tabla_de_assert_nativos"><a class="link" href="#_tabla_de_assert_nativos">Tabla de Assert Nativos</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 37.5%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Función</th>
<th class="tableblock halign-left valign-top">Propósito</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
<th class="tableblock halign-left valign-top">Usa</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.equal()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Igualdad flexible</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.equal(5, '5')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">== (coerción)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.strictEqual()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Igualdad estricta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.strictEqual(5, 5)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">=== (sin coerción)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.notEqual()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desigualdad flexible</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.notEqual(5, 6)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">!=</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.notStrictEqual()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Desigualdad estricta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.notStrictEqual(5, '5')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">!==</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.ok()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verificar truthy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.ok(true)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Booleano</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.throws()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error síncrono</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.throws) &#8658; fn(</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Excepciones</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a=ssert.rejects()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error asíncrono</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>await assert.rejects(promise)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Promises</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.deepEqual()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Objetos iguales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.deepEqual({a:1}, {a:1})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profundo</p></td>
</tr>
</tbody>
</table>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_4_2_chai_librería_de_assertions"><a class="link" href="#_4_2_chai_librería_de_assertions">4.2 Chai - Librería de Assertions</a></h3>
<div class="paragraph">
<p>Chai es una librería de assertions muy popular que proporciona una sintaxis más legible y poderosa que assert nativo. Soporta múltiples estilos.</p>
</div>
<div class="sect3">
<h4 id="_instalación_de_chai"><a class="link" href="#_instalación_de_chai">Instalación de Chai</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install --save-dev chai</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para TypeScript:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install --save-dev chai @types/chai</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_estilos_de_chai_bdd_vs_tdd"><a class="link" href="#_estilos_de_chai_bdd_vs_tdd">Estilos de Chai: BDD vs TDD</a></h4>
<div class="paragraph">
<p>Chai soporta dos estilos: BDD (expect/should) y TDD (assert).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Estilo</th>
<th class="tableblock halign-left valign-top">Sintaxis</th>
<th class="tableblock halign-left valign-top">Popularidad</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BDD</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expect()</code> o <code>should</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muy popular, legible</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>TDD</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tradicional, menos común</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_bdd_style_expect"><a class="link" href="#_bdd_style_expect">BDD Style: expect()</a></h4>
<div class="paragraph">
<p>El estilo <code>expect()</code> es el más popular. Usa una sintaxis chainable y legible.</p>
</div>
<div class="listingblock">
<div class="title">Ins=talación y importación:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sintaxis básica:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">expect(valor).to.equal(esperado);
expect(valor).to.not.equal(esperado);
expect(valor).to.be.true;
expect(valor).to.be.false;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplos de aserciones básicas:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

describe('Chai - BDD Style expect()', () =&gt; {
  it('debe verificar igualdad', () =&gt; {
    expect(5).to.equal(5);
    expect('texto').to.equal('texto');
    expect(true).to.be.true;
  });

  it('debe verificar desigualdad', () =&gt; {
    expect(5).to.not.equal(6);
    expect(false).to.be.false;
  });

  it('debe verificar tipos', () =&gt; {
    expect(5).to.be.a('number');
    expect('hola').to.be.a('string');
    expect([1, 2]).to.be.an('array');
    expect({}).to.be.an('object');
  });

  it('debe verificar inclusión', () =&gt; {
    expect([1, 2, 3]).to.include(2);
    expect('hello').to.include('ell');
    expect({ a: 1, b: 2 }).to.include.key('a');
  });

  it('debe verificar longitud', () =&gt; {
    expect([1, 2, 3]).to.have.lengthOf(3);
    expect('hello').to.have.lengthOf(5);
  });

  it('debe verificar excepciones', () =&gt; {
    expect(() =&gt; {
      throw new Error('¡Boom!');
    }).to.throw();

    expect(() =&gt; {
      throw new Error('¡Boom!');
    }).to.throw('¡Boom!');
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_assertions_chainable_fluent"><a class="link" href="#_assertions_chainable_fluent">Assertions Chainable (Fluent)</a></h4>
<div class="paragraph">
<p>Una de las ventajas de Chai es la sintaxis chainable que hace los tests muy legibles.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

describe('Assertions Chainable', () =&gt; {
  it('debe permitir chaining', () =&gt; {
    const usuario = {
      nombre: 'Juan',
      email: 'juan@example.com',
      edad: 30,
      roles: ['admin', 'usuario']
    };

    expect(usuario)
      .to.be.an('object')
      .that.includes.all.keys('nombre', 'email', 'edad')
      .and.include.key('roles');

    expect(usuario.nombre)
      .to.be.a('string')
      .that.is.not.empty
      .and.includes('Juan');

    expect(usuario.roles)
      .to.be.an('array')
      .that.is.not.empty
      .and.includes('admin');
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bdd_style_should"><a class="link" href="#_bdd_style_should">BDD Style: should</a></h4>
<div class="paragraph">
<p>El estilo <code>should</code> añade propiedades a los objetos. Es menos común que <code>expect()</code>.</p>
</div>
<div class="listingblock">
<div class="title">Sintaxis:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import 'chai/register-should';

const valor = 5;
valor.should.equal(5);
valor.should.not.equal(6);
valor.should.be.a('number');</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import 'chai/register-should';

describe('Chai - BDD Style should', () =&gt; {
  it('debe usar should', () =&gt; {
    const resultado = 2 + 3;

    resultado.should.equal(5);
    resultado.should.be.a('number');
    resultado.should.be.above(4);
    resultado.should.be.below(6);
  });

  it('debe funcionar con arrays', () =&gt; {
    const items = [1, 2, 3];

    items.should.be.an('array');
    items.should.have.lengthOf(3);
    items.should.include(2);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tdd_style_assert"><a class="link" href="#_tdd_style_assert">TDD Style: assert</a></h4>
<div class="paragraph">
<p>Chai también proporciona un estilo <code>assert</code> tradicional, similar a Node.js assert pero más potente.</p>
</div>
<div class="listingblock">
<div class="title">Sintaxis:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { assert } from 'chai';

assert.equal(valor, esperado);
assert.strictEqual(valor, esperado);
assert.typeOf(valor, 'string');</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { assert } from 'chai';

describe('Chai - TDD Style assert', () =&gt; {
  it('debe usar assert', () =&gt; {
    const resultado = 2 + 3;

    assert.equal(resultado, 5);
    assert.strictEqual(resultado, 5);
    assert.typeOf(resultado, 'number');
    assert.isAbove(resultado, 4);
    assert.isBelow(resultado, 6);
  });

  it('debe funcionar con arrays', () =&gt; {
    const items = [1, 2, 3];

    assert.isArray(items);
    assert.lengthOf(items, 3);
    assert.include(items, 2);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_comparencia_chai_vs_assert_nativo"><a class="link" href="#_comparencia_chai_vs_assert_nativo">Comparencia Chai vs Assert Nativo</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Característica</th>
<th class="tableblock halign-left valign-top">Assert Nativo</th>
<th class="tableblock halign-left valign-top">Chai</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mensajes de error</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Básicos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muy descriptivos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Chainable</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sí</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Múltiples estilos</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sí (expect, should, assert)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Funciones avanzadas</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Limitadas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Muchas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Tamaño</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1KB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">~20KB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Curva de aprendizaje</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baja</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Media</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_principales_aserciones_de_chai"><a class="link" href="#_principales_aserciones_de_chai">Principales Aserciones de Chai</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Aserción</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Igualdad</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expect(5).to.equal(5)</code> / <code>expect(5).to.eql(5)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Identidad</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expect(obj).to.equal(obj)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Tipo</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expect(5).to.be.a('number')</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Verdadero/Falso</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expect(true).to.be.true</code> / <code>.to.be.false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Null/Undefined</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expect(val).to.be.null</code> / <code>.to.be.undefined</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Numérico</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expect(5).to.be.above(4)</code> / <code>.to.be.below(6)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Inclusión</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expect([1,2]).to.include(1)</code> / <code>.to.include.key('a')</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Longitud</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expect('hello').to.have.lengthOf(5)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>E=xcepciones</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expect) &#8658; fn(.to.throw(Error)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Propiedades</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expect({a:1}).to.have.property('a')</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Existencia</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expect(val).to.exist</code></p></td>
</tr>
</tbody>
</table>
<hr>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_3_assertions_avanzadas"><a class="link" href="#_4_3_assertions_avanzadas">4.3 Assertions Avanzadas</a></h3>
<div class="sect3">
<h4 id="_validación_de_excepciones_detallada"><a class="link" href="#_validación_de_excepciones_detallada">Validación de Excepciones Detallada</a></h4>
<div class="paragraph">
<p>Chai permite validar detalles específicos de excepciones.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo completo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

function validarContraseña(password: string) {
  if (!password) {
    throw new Error('Contraseña requerida');
  }
  if (password.length &lt; 8) {
    throw new Error('Contraseña muy corta (mínimo 8 caracteres)');
  }
  if (!/[A-Z]/.test(password)) {
    throw new Error('Debe contener mayúsculas');
  }
  if (!/[0-9]/.test(password)) {
    throw new Error('Debe contener números');
  }
  return true;
}

describe('Validación de Excepciones Detallada', () =&gt; {
  it('debe lanzar error si está vacía', () =&gt; {
    expect(() =&gt; validarContraseña(''))
      .to.throw('Contraseña requerida');
  });

  it('debe lanzar error si es muy corta', () =&gt; {
    expect(() =&gt; validarContraseña('Abc123'))
      .to.throw(/mínimo 8 caracteres/);
  });

  it('debe lanzar error si falta mayúscula', () =&gt; {
    expect(() =&gt; validarContraseña('abc12345'))
      .to.throw()
      .and.to.have.property('message')
      .that.includes('mayúsculas');
  });

  it('debe permitir contraseña válida', () =&gt; {
    expect(() =&gt; validarContraseña('Validar123'))
      .to.not.throw();
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_validación_de_promises_rechazadas"><a class="link" href="#_validación_de_promises_rechazadas">Validación de Promises Rechazadas</a></h4>
<div class="paragraph">
<p>Chai funciona perfectamente con promises y async/await.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

async function obtenerProducto(id: number) {
  if (id &lt;= 0) {
    throw new Error('ID debe ser positivo');
  }
  return { id, nombre: 'Laptop', precio: 1000 };
}

describe('Validación de Promises Rechazadas', () =&gt; {
  it('debe rechazar si ID es inválido', async () =&gt; {
    try {
      await obtenerProducto(-1);
      throw new Error('Debería haber rechazado');
    } catch (err) {
      expect(err.message).to.include('positivo');
    }
  });

  it('alternativa: usar expect con throw', async () =&gt; {
    let error;
    try {
      await obtenerProducto(0);
    } catch (err) {
      error = err;
    }

    expect(error).to.exist;
    expect(error.message).to.equal('ID debe ser positivo');
  });

  it('debe retornar producto válido', async () =&gt; {
    const producto = await obtenerProducto(1);

    expect(producto)
      .to.be.an('object')
      .that.includes.all.keys('id', 'nombre', 'precio');

    expect(producto.id).to.equal(1);
    expect(producto.nombre).to.be.a('string');
    expect(producto.precio).to.be.above(0);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_validación_de_tipos_complejos"><a class="link" href="#_validación_de_tipos_complejos">Validación de Tipos Complejos</a></h4>
<div class="paragraph">
<p>Validar estructuras de datos complejas.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

interface Usuario {
  id: number;
  nombre: string;
  email: string;
  roles: string[];
  activo: boolean;
}

describe('Validación de Tipos Complejos', () =&gt; {
  it('debe validar estructura de usuario', () =&gt; {
    const usuario: Usuario = {
      id: 1,
      nombre: 'Juan',
      email: 'juan@example.com',
      roles: ['admin', 'usuario'],
      activo: true
    };

    // Validar estructura
    expect(usuario).to.be.an('object');
    expect(usuario).to.have.all.keys('id', 'nombre', 'email', 'roles', 'activo');

    // Validar tipos de propiedades
    expect(usuario.id).to.be.a('number');
    expect(usuario.nombre).to.be.a('string');
    expect(usuario.email).to.be.a('string');
    expect(usuario.roles).to.be.an('array');
    expect(usuario.activo).to.be.a('boolean');

    // Validar valores
    expect(usuario.id).to.equal(1);
    expect(usuario.nombre).to.not.be.empty;
    expect(usuario.email).to.include('@');
    expect(usuario.roles).to.include('admin');
    expect(usuario.activo).to.be.true;
  });

  it('debe validar arrays de objetos', () =&gt; {
    const usuarios: Usuario[] = [
      { id: 1, nombre: 'Juan', email: 'juan@example.com', roles: ['admin'], activo: true },
      { id: 2, nombre: 'Ana', email: 'ana@example.com', roles: ['usuario'], activo: true }
    ];

    expect(usuarios).to.be.an('array').with.lengthOf(2);

    usuarios.forEach((usuario, index) =&gt; {
      expect(usuario).to.have.all.keys('id', 'nombre', 'email', 'roles', 'activo');
      expect(usuario.id).to.be.a('number').and.be.greaterThan(0);
      expect(usuario.nombre).to.be.a('string').and.not.be.empty;
    });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mensajes_de_error_personalizados"><a class="link" href="#_mensajes_de_error_personalizados">Mensajes de Error Personalizados</a></h4>
<div class="paragraph">
<p>Los mensajes personalizados ayudan a entender qué falló.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo con Chai:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

describe('Mensajes de Error Personalizados', () =&gt; {
  it('debe mostrar mensaje descriptivo', () =&gt; {
    const usuarioActual = 'Juan';
    const usuarioEsperado = 'Ana';

    expect(usuarioActual, `El usuario debería ser ${usuarioEsperado}`)
      .to.equal(usuarioEsperado);
  });

  it('mensaje en validación compleja', () =&gt; {
    const usuario = null;

    expect(usuario, 'El usuario no debe ser null después de crear')
      .to.exist;
  });

  it('mensaje con contexto de negocio', () =&gt; {
    const precioFinal = 150;
    const precioMaximo = 100;

    expect(precioFinal, `El precio final ($${precioFinal}) no debe exceder el máximo ($${precioMaximo})`)
      .to.be.below(precioMaximo);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_comparación_assert_vs_chai"><a class="link" href="#_comparación_assert_vs_chai">Comparación: Assert vs Chai</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import assert from 'assert';
import { expect } from 'chai';

describe('Comparación: assert vs chai', () =&gt; {
  const usuario = { id: 1, nombre: 'Juan' };

  it('verificar propiedad con assert nativo', () =&gt; {
    // Assert nativo
    assert.strictEqual(usuario.nombre, 'Juan');
    // Mensaje de error poco descriptivo:
    / AssertionError: 'Juan' === 'Ana'
  });

  it('verificar propiedad con chai', () =&gt; {
    // Chai
    expect(usuario.nombre, 'El nombre debe ser Juan')
      .to.equal('Juan');
    // Mensaje de error muy descriptivo
  });

  it('validar arrays con assert', () =&gt; {
    const items = [1, 2, 3];
    assert.ok(items.includes(2));
    // Error poco claro si falla
  });

  it('validar arrays con chai', () =&gt; {
    const items = [1, 2, 3];
    expect(items).to.include(2);
    // Error muy descriptivo
  });

  it('comparar objetos con assert', () =&gt; {
    const obj1 = { a: 1, b: 2 };
    const obj2 = { a: 1, b: 2 };
    assert.deepEqual(obj1, obj2);
  });

  it('comparar objetos con chai', () =&gt; {
    const obj1 = { a: 1, b: 2 };
    const obj2 = { a: 1, b: 2 };
    expect(obj1).to.deep.equal(obj2);
    // Más legible
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tabla_resumen_de_aserciones_avanzadas"><a class="link" href="#_tabla_resumen_de_aserciones_avanzadas">Tabla Resumen de Aserciones Avanzadas</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Característica</th>
<th class="tableblock halign-left valign-top">Assert Nativo</th>
<th class="tableblock halign-left valign-top">Chai</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Validar excepción</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.throws()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expect) &#8658; fn(.to.throw()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Validar promise rechazada</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.rejects()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Usar try/catch + expect</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mensaje personalizado</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Segundo parámetro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Segundo parámetro en expect</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Validar estructura</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.deepEqual()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expect(obj).to.deep.equal()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Validar inclusión</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.ok(arr.includes())</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expect(arr).to.include()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Validar tipo</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assert.ok(typeof x === 'number')</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expect(x).to.be.a('number')</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Legibilidad</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Media</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alta</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_ejemplo_práctico_completo"><a class="link" href="#_ejemplo_práctico_completo">Ejemplo Práctico Completo</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

interface Carrito {
  id: string;
  items: Array&lt;{ id: number; nombre: string; precio: number; cantidad: number }&gt;;
  calcularTotal(): number;
  agregarItem(item: any): void;
  eliminarItem(itemId: number): void;
}

class CarritoCompras implements Carrito {
  id = 'carrito-1';
  items: any[] = [];

  calcularTotal(): number {
    return this.items.reduce((total, item) =&gt;
      total + (item.precio * item.cantidad), 0
    );
  }

  agregarItem(item: any): void {
    onst existe = this.items.find(i =&gt; i.id === item.id);
    if (existe) {
      existe.cantidad += item.cantidad;
    } else {
      this.items.push(item);
    }
  }

  eliminarItem(itemId: number): void {
    this.items = this.items.filter(i =&gt; i.id !== itemId);
  }
}

describe('Carrito de Compras - Assertions Avanzadas', () =&gt; {
  let carrito: Carrito;

  beforeEach(() =&gt; {
    carrito = new CarritoCompras();
  });

  it('debe inicializarse vacío', () =&gt; {
    expect(carrito.items)
      .to.be.an('array')
      .that.is.empty;

    expect(carrito.calcularTotal())
      .to.equal(0);
  });

  it('debe agregar item y calcular total', () =&gt; {
    const laptop = { id: 1, nombre: 'Laptop', precio: 1000, cantidad: 1 };

    carrito.agregarItem(laptop);

    expect(carrito.items)
      .to.have.lengthOf(1)
      .and.to.include(laptop);

    expect(carrito.calcularTotal())
      .to.equal(1000);
  });

  it('debe agregar múltiples items', () =&gt; {
    carrito.agregarItem({ id: 1, nombre: 'Laptop', precio: 1000, cantidad: 1 });
    carrito.agregarItem({ id: 2, nombre: 'Mouse', precio: 50, cantidad: 2 });

    expect(carrito.items)
      .to.have.lengthOf(2);

    expect(carrito.calcularTotal())
      .to.equal(1100); // (1000 * 1) + (50 * 2)
  });

  it('debe aumentar cantidad si item ya existe', () =&gt; {
    carrito.agregarItem({ id: 1, nombre: 'Laptop', precio: 1000, cantidad: 1 });
    carrito.agregarItem({ id: 1, nombre: 'Laptop', precio: 1000, cantidad: 1 });

    expect(carrito.items)
      .to.have.lengthOf(1);

    expect(carrito.items[0].cantidad)
      .to.equal(2);

    expect(carrito.calcularTotal())
      .to.equal(2000);
  });

  it('debe eliminar item del carrito', () =&gt; {
    carrito.agregarItem({ id: 1, nombre: 'Laptop', precio: 1000, cantidad: 1 });
    carrito.agregarItem({ id: 2, nombre: 'Mouse', precio: 50, cantidad: 1 });

    carrito.eliminarItem(1);

    expect(carrito.items)
      .to.have.lengthOf(1)
      .and.to.satisfy(
        items: any[]) =&gt; !items.some(i =&gt; i.id === 1),
        'No debe contener el item con id 1'
      );

    expect(carrito.calcularTotal())
      .to.equal(50);
  });
});</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_módulo_5_testing_de_funciones_y_módulos"><a class="link" href="#_módulo_5_testing_de_funciones_y_módulos">Módulo 5: Testing de Funciones y Módulos</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Este módulo cubre cómo escribir tests para funciones individuales, módulos completos, clases y objetos. Es el corazón del testing unitario.</p>
</div>
<div class="sect2">
<h3 id="_5_1_tests_básicos_unitarios"><a class="link" href="#_5_1_tests_básicos_unitarios">5.1 Tests Básicos Unitarios</a></h3>
<div class="sect3">
<h4 id="_testing_de_funciones_puras"><a class="link" href="#_testing_de_funciones_puras">Testing de Funciones Puras</a></h4>
<div class="paragraph">
<p>Una función pura es aquella que siempre retorna el mismo resultado para los mismos parámetros, sin efectos secundarios.</p>
</div>
<div class="ulist">
<div class="title">Características de funciones puras:</div>
<ul>
<li>
<p>No modifican estado externo</p>
</li>
<li>
<p>No tienen dependencias externas</p>
</li>
<li>
<p>Para los mismos inputs, siempre el mismo output</p>
</li>
<li>
<p>Fáciles de testear</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Ejemplo de función pura:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// Función pura - fácil de testear
function sumar(a: number, b: number): number {
  return a + b;
}

function calcularDescuento(precio: number, porcentaje: number): number {
  const descuento = precio * (porcentaje / 100);
  return precio - descuento;
}

function validarEmail(email: string): boolean {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests para funciones puras:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

describe('Funciones Puras', () =&gt; {
  describe('sumar', () =&gt; {
    it('debe sumar dos números positivos', () =&gt; {
      expect(sumar(2, 3)).to.equal(5);
    });

    it('debe sumar números negativos', () =&gt; {
      expect(sumar(-5, 3)).to.equal(-2);
    });

    it('debe sumar ceros', () =&gt; {
      expect(sumar(0, 0)).to.equal(0);
    });

    it('debe ser conmutativa', () =&gt; {
      expect(sumar(5, 3)).to.equal(sumar(3, 5));
    });
  });

  describe('calcularDescuento', () =&gt; {
    it('debe calcular descuento del 10%', () =&gt; {
      expect(calcularDescuento(100, 10)).to.equal(90);
    });

    it('debe calcular descuento del 50%', () =&gt; {
      expect(calcularDescuento(200, 50)).to.equal(100);
    });

    it('debe retornar el mismo precio sin descuento', () =&gt; {
      expect(calcularDescuento(100, 0)).to.equal(100);
    });
  });

  describe('validarEmail', () =&gt; {
    it('debe aceptar emails válidos', () =&gt; {
      expect(validarEmail('usuario@example.com')).to.be.true;
      expect(validarEmail('juan.perez@empresa.co.uk')).to.be.true;
    });

    it('debe rechazar emails sin @', () =&gt; {
      expect(validarEmail('usuarioexample.com')).to.be.false;
    });

    it('debe rechazar emails sin dominio', () =&gt; {
      expect(validarEmail('usuario@')).to.be.false;
    });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_con_parámetros_variables"><a class="link" href="#_testing_con_parámetros_variables">Testing con Parámetros Variables</a></h4>
<div class="paragraph">
<p>Los tests deben verificar diferentes tipos de parámetros y casos borde.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tipo de Parámetro</th>
<th class="tableblock halign-left valign-top">Casos a Testear</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Números</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Positivos, negativos, cero, decimales, NaN, Infinity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Strings</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vacío, con espacios, especiales, muy largo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arrays</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vacío, un elemento, múltiples, con duplicados</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Objetos</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vacío, incompleto, extra keys, null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Booleanos</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true, false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>null/undefined</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ambos casos</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Eje=mplo: Testing exhaustivo</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

function dividir(a: number, b: number): number {
  f (b === 0) {
    throw new Error('No se puede dividir por cero');
  }
  return a / b;
}

function procesarArray(arr: any[]): number {
  if (!Array.isArray(arr)) {
    throw new Error('Param debe ser un array');
  }
  return arr.length;
}

describe('Testing con Parámetros Variables', () =&gt; {
  describe('dividir - números', () =&gt; {
    it('debe dividir enteros positivos', () =&gt; {
      expect(dividir(10, 2)).to.equal(5);
    });

    it('debe dividir decimales', () =&gt; {
      expect(dividir(7.5, 2.5)).to.equal(3);
    });

    it('debe manejar números negativos', () =&gt; {
      expect(dividir(-10, 2)).to.equal(-5);
      expect(dividir(10, -2)).to.equal(-5);
      expect(dividir(-10, -2)).to.equal(5);
    });

    it('debe lanzar error en división por cero', () =&gt; {
      expect(() =&gt; dividir(10, 0)).to.throw('No se puede dividir por cero');
    });
  });

  describe('procesarArray - arrays', () =&gt; {
    it('debe retornar longitud de array vacío', () =&gt; {
      expect(procesarArray([])).to.equal(0);
    });

    it('debe retornar longitud de array con elementos', () =&gt; {
      expect(procesarArray([1, 2, 3])).to.equal(3);
    });

    it('debe rechazar no-arrays', () =&gt; {
      expect(() =&gt; procesarArray(null as any)).to.throw();
      expect(() =&gt; procesarArray('string' as any)).to.throw();
      expect(() =&gt; procesarArray({} as any)).to.throw();
    });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_de_valores_de_retorno"><a class="link" href="#_testing_de_valores_de_retorno">Testing de Valores de Retorno</a></h4>
<div class="paragraph">
<p>Verifica que el valor retornado sea exacto y del tipo correcto.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

function obtenerUsuario(id: number): { id: number; nombre: string; activo: boolean } | null {
  f (id === 1) {
    return { id: 1, nombre: 'Juan', activo: true };
  }
  return null;
}

function procesarBatch(items: any[]): { exitosos: number; fallidos: number } {
  return {
    xitosos: items.filter(i =&gt; i.status === 'success').length,
    allidos: items.filter(i =&gt; i.status === 'error').length
  };
}

describe('Testing de Valores de Retorno', () =&gt; {
  it('debe retornar usuario con estructura correcta', () =&gt; {
    const usuario = obtenerUsuario(1);

    expect(usuario).to.not.be.null;
    expect(usuario).to.be.an('object');
    expect(usuario).to.have.all.keys('id', 'nombre', 'activo');
    expect(usuario?.id).to.be.a('number');
    expect(usuario?.nombre).to.be.a('string');
    expect(usuario?.activo).to.be.a('boolean');
  });

  it('debe retornar null para usuario no encontrado', () =&gt; {
    const usuario = obtenerUsuario(999);

    expect(usuario).to.be.null;
  });

  it('debe procesar batch correctamente', () =&gt; {
    const items = [
      { status: 'success' },
      { status: 'success' },
      { status: 'error' }
    ];

    const resultado = procesarBatch(items);

    expect(resultado).to.deep.equal({ exitosos: 2, fallidos: 1 });
    expect(resultado.exitosos).to.equal(2);
    expect(resultado.fallidos).to.equal(1);
    expect(resultado.exitosos + resultado.fallidos).to.equal(items.length);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_de_tipos_en_typescript"><a class="link" href="#_testing_de_tipos_en_typescript">Testing de Tipos en TypeScript</a></h4>
<div class="paragraph">
<p>TypeScript ayuda a validar tipos, pero la verificación en runtime también es importante.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

interface Producto {
  id: number;
  nombre: string;
  precio: number;
  stock: number;
}

function crearProducto(datos: any): Producto {
  if (!datos.id || !datos.nombre || !datos.precio) {
    throw new Error('Datos incompletos');
  }
  return {
    id: datos.id,
    nombre: datos.nombre,
    precio: datos.precio,
    stock: datos.stock || 0
  };
}

function generarSKU(producto: Producto): string {
  return `${producto.id}-${producto.nombre.toUpperCase().substring(0, 3)}`;
}

describe('Testing de Tipos en TypeScript', () =&gt; {
  it('debe crear producto con tipos correctos', () =&gt; {
    const producto = crearProducto({
      id: 1,
      nombre: 'Laptop',
      precio: 1000
    });

    expect(producto).to.be.instanceOf(Object);
    expect(producto.id).to.be.a('number');
    expect(producto.nombre).to.be.a('string');
    expect(producto.precio).to.be.a('number');
    expect(producto.stock).to.be.a('number');
  });

  it('debe lanzar error con datos incompletos', () =&gt; {
    expect(() =&gt; crearProducto({ nombre: 'Laptop' }))
      .to.throw('Datos incompletos');
  });

  it('debe generar SKU correctamente', () =&gt; {
    const producto: Producto = {
      id: 1,
      nombre: 'Laptop',
      precio: 1000,
      stock: 5
    };

    const sku = generarSKU(producto);

    expect(sku).to.be.a('string');
    expect(sku).to.include('1');
    expect(sku).to.include('LAP');
    expect(sku).to.equal('1-LAP');
  });
});</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_testing_de_módulos"><a class="link" href="#_5_2_testing_de_módulos">5.2 Testing de Módulos</a></h3>
<div class="sect3">
<h4 id="_testing_de_exportaciones"><a class="link" href="#_testing_de_exportaciones">Testing de Exportaciones</a></h4>
<div class="paragraph">
<p>Valida que un módulo exporte las funciones y variables correctas.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo: módulo math.ts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// src/math.ts
export function sumar(a: number, b: number): number {
  return a + b;
}

export function restar(a: number, b: number): number {
  return a - b;
}

export const PI = 3.14159;

export interface MathResult {
  resultado: number;
  timestamp: Date;
}

export function calcularAreaCirculo(radio: number): number {
  return PI * radio * radio;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Test de exportaciones:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import * as math from '../src/math';

describe('Testing de Exportaciones', () =&gt; {
  it('debe exportar función sumar', () =&gt; {
    expect(math.sumar).to.be.a('function');
    expect(math.sumar(2, 3)).to.equal(5);
  });

  it('debe exportar función restar', () =&gt; {
    expect(math.restar).to.be.a('function');
    expect(math.restar(5, 2)).to.equal(3);
  });

  it('debe exportar constante PI', () =&gt; {
    expect(math.PI).to.be.a('number');
    expect(math.PI).to.equal(3.14159);
  });

  it('debe exportar interfaz MathResult', () =&gt; {
    const resultado: math.MathResult = {
      resultado: 5,
      timestamp: new Date()
    };
    expect(resultado).to.have.all.keys('resultado', 'timestamp');
  });

  it('debe usar PI en calcularAreaCirculo', () =&gt; {
    const area = math.calcularAreaCirculo(2);
    const esperado = math.PI * 2 * 2;
    expect(area).to.equal(esperado);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_inyección_de_dependencias"><a class="link" href="#_inyección_de_dependencias">Inyección de Dependencias</a></h4>
<div class="paragraph">
<p>Facilita el testing al permitir pasar dependencias como parámetros.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo sin inyección (difícil de testear):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// Difícil de testear - depende de BaseDatos real
class RepositorioUsuarios {
  private db = new BaseDatos(); // Creado internamente

  obtener(id: number) {
    return this.db.query(`SELECT * FROM usuarios WHERE id = ${id}`);
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo con inyección (fácil de testear):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

// Interfaz para abstracción
interface BaseDatos {
  query(sql: string): any;
}

// Clase que recibe la dependencia
class RepositorioUsuarios {
  constructor(private db: BaseDatos) {}

  obtener(id: number) {
    return this.db.query(`SELECT * FROM usuarios WHERE id = ${id}`);
  }
}

describe('Inyección de Dependencias', () =&gt; {
  it('debe obtener usuario usando BD de test', () =&gt; {
    // Mock/Stub de la BD
    const dbMock: BaseDatos = {
      query: (sql: string) =&gt; ({
        id: 1,
        nombre: 'Juan',
        email: 'juan@example.com'
      })
    };

    const repo = new RepositorioUsuarios(dbMock);
    const usuario = repo.obtener(1);

    expect(usuario).to.exist;
    expect(usuario.nombre).to.equal('Juan');
  });

  it('debe manejar usuario no encontrado', () =&gt; {
    const dbMock: BaseDatos = {
      query: () =&gt; null
    };

    const repo = new RepositorioUsuarios(dbMock);
    const usuario = repo.obtener(999);

    expect(usuario).to.be.null;
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mocking_de_módulos"><a class="link" href="#_mocking_de_módulos">Mocking de Módulos</a></h4>
<div class="paragraph">
<p>A veces necesitas reemplazar un módulo completo por un mock.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo: módulo externo (email-service.ts)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// src/email-service.ts
export function enviarEmail(destinatario: string, asunto: string, cuerpo: string) {
  // Llama a API external...
  return { enviado: true, id: 'email-123' };
}

// src/notificador.ts
import * as emailService from './email-service';

export class Notificador {
  notifcar(usuario: { email: string; nombre: string }, mensaje: string) {
    const respuesta = emailService.enviarEmail(
      usuario.email,
      'Notificación',
      mensaje
    );
    return respuesta;
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Test con módulo mockeado:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import * as emailService from '../src/email-service';
import { Notificador } from '../src/notificador';

describe('Mocking de Módulos', () =&gt; {
  it('debe notificar sin llamar servicio real', () =&gt; {
    // Reemplazar el módulo
    const emailMock = {
      enviarEmail: (dest: string, asunto: string, cuerpo: string) =&gt; {
        return { enviado: true, id: 'mock-123' };
      }
    };

    // Usar el mock
    const notificador = new Notificador();
    // En TypeScript real, usarías herramientas como sinon o jest

    const resultado = emailMock.enviarEmail(
      'usuario@example.com',
      'Notificación',
      'Contenido del email'
    );

    expect(resultado).to.exist;
    expect(resultado.enviado).to.be.true;
    expect(resultado.id).to.equal('mock-123');
  });
});</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_5_3_testing_de_objetos_y_clases"><a class="link" href="#_5_3_testing_de_objetos_y_clases">5.3 Testing de Objetos y Clases</a></h3>
<div class="sect3">
<h4 id="_testing_de_métodos_de_clase"><a class="link" href="#_testing_de_métodos_de_clase">Testing de Métodos de Clase</a></h4>
<div class="paragraph">
<p>Las clases tienen múltiples métodos que deben testearse individualmente.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo: Clase Carrito</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class Carrito {
  private items: Array&lt;{ id: number; nombre: string; precio: number; cantidad: number }&gt; = [];
  private impuesto: number = 0.16; // 16%

  agregarItem(id: number, nombre: string, precio: number, cantidad: number = 1): void {
    onst existe = this.items.find(i =&gt; i.id === id);

    if (existe) {
      existe.cantidad += cantidad;
    } else {
      this.items.push({ id, nombre, precio, cantidad });
    }
  }

  eliminarItem(id: number): void {
    this.items = this.items.filter(i =&gt; i.id !== id);
  }

  obtenerTotal(): number {
    const subtotal = this.items.reduce((sum, item) =&gt;
      sum + (item.precio * item.cantidad), 0
    );
    return subtotal * (1 + this.impuesto);
  }

  obtenerSubtotal(): number {
    return this.items.reduce((sum, item) =&gt;
      sum + (item.precio * item.cantidad), 0
    );
  }

  obtenerImpuesto(): number {
    return this.obtenerSubtotal() * this.impuesto;
  }

  limpiar(): void {
    this.items = [];
  }

  obtenerItems() {
    return [...this.items]; // Retorna copia
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests para los métodos:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import { Carrito } from '../src/carrito';

describe('Clase Carrito - Métodos', () =&gt; {
  let carrito: Carrito;

  beforeEach(() =&gt; {
    carrito = new Carrito();
  });

  describe('agregarItem', () =&gt; {
    it('debe agregar un item al carrito', () =&gt; {
      carrito.agregarItem(1, 'Laptop', 1000);

      const items = carrito.obtenerItems();
      expect(items).to.have.lengthOf(1);
      expect(items[0].id).to.equal(1);
      expect(items[0].nombre).to.equal('Laptop');
      expect(items[0].cantidad).to.equal(1);
    });

    it('debe aumentar cantidad si item existe', () =&gt; {
      carrito.agregarItem(1, 'Laptop', 1000, 1);
      carrito.agregarItem(1, 'Laptop', 1000, 2);

      const items = carrito.obtenerItems();
      expect(items).to.have.lengthOf(1);
      expect(items[0].cantidad).to.equal(3);
    });
  });

  describe('eliminarItem', () =&gt; {
    it('debe eliminar item del carrito', () =&gt; {
      carrito.agregarItem(1, 'Laptop', 1000);
      carrito.agregarItem(2, 'Mouse', 50);

      carrito.eliminarItem(1);

      const items = carrito.obtenerItems();
      expect(items).to.have.lengthOf(1);
      expect(items[0].id).to.equal(2);
    });
  });

  describe('obtenerTotal', () =&gt; {
    it('debe calcular total con impuesto', () =&gt; {
      carrito.agregarItem(1, 'Laptop', 1000, 1);
      carrito.agregarItem(2, 'Mouse', 50, 2);

      const subtotal = 1000 + 100; // 1100
      const total = subtotal * 1.16; // 1276

      expect(carrito.obtenerTotal()).to.equal(total);
    });
  });

  describe('limpiar', () =&gt; {
    it('debe vaciar el carrito', () =&gt; {
      carrito.agregarItem(1, 'Laptop', 1000);
      carrito.limpiar();

      expect(carrito.obtenerItems()).to.be.empty;
    });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_de_constructores"><a class="link" href="#_testing_de_constructores">Testing de Constructores</a></h4>
<div class="paragraph">
<p>Valida que el constructor inicialice correctamente el objeto.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class Usuario {
  id: number;
  nombre: string;
  email: string;
  roles: string[];
  activo: boolean;
  fechaCreacion: Date;

  constructor(datos: {
    id: number;
    nombre: string;
    email: string;
    roles?: string[];
  }) {
    if (!datos.id || !datos.nombre || !datos.email) {
      throw new Error('Datos requeridos incompletos');
    }

    this.id = datos.id;
    this.nombre = datos.nombre;
    this.email = datos.email;
    this.roles = datos.roles || ['usuario'];
    this.activo = true;
    this.fechaCreacion = new Date();
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests del constructor:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import { Usuario } from '../src/usuario';

describe('Usuario - Constructor', () =&gt; {
  it('debe crear usuario con datos válidos', () =&gt; {
    const usuario = new Usuario({
      id: 1,
      nombre: 'Juan',
      email: 'juan@example.com'
    });

    expect(usuario.id).to.equal(1);
    expect(usuario.nombre).to.equal('Juan');
    expect(usuario.email).to.equal('juan@example.com');
    expect(usuario.activo).to.be.true;
  });

  it('debe asignar rol por defecto', () =&gt; {
    const usuario = new Usuario({
      id: 1,
      nombre: 'Juan',
      email: 'juan@example.com'
    });

    expect(usuario.roles).to.deep.equal(['usuario']);
  });

  it('debe asignar roles personalizados', () =&gt; {
    const usuario = new Usuario({
      id: 1,
      nombre: 'Juan',
      email: 'juan@example.com',
      roles: ['admin', 'moderador']
    });

    expect(usuario.roles).to.deep.equal(['admin', 'moderador']);
  });

  it('debe crear fechaCreacion automáticamente', () =&gt; {
    const antes = new Date();
    const usuario = new Usuario({
      id: 1,
      nombre: 'Juan',
      email: 'juan@example.com'
    });
    const despues = new Date();

    expect(usuario.fechaCreacion.getTime())
      .to.be.greaterThanOrEqual(antes.getTime())
      .and.lessThanOrEqual(despues.getTime());
  });

  it('debe lanzar error si faltan datos requeridos', () =&gt; {
    expect(() =&gt; new Usuario({
      id: 0,
      nombre: '',
      email: 'juan@example.com'
    })).to.throw('Datos requeridos incompletos');
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_de_herencia"><a class="link" href="#_testing_de_herencia">Testing de Herencia</a></h4>
<div class="paragraph">
<p>Valida que las clases hijas hereden correctamente de la clase padre.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo con herencia:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// Clase base
export class Persona {
  nombre: string;
  edad: number;

  constructor(nombre: string, edad: number) {
    this.nombre = nombre;
    this.edad = edad;
  }

  esMayorDeEdad(): boolean {
    return this.edad &gt;= 18;
  }
}

// Clase hija
export class Empleado extends Persona {
  salario: number;
  departamento: string;

  constructor(nombre: string, edad: number, salario: number, departamento: string) {
    super(nombre, edad);
    this.salario = salario;
    this.departamento = departamento;
  }

  obtenerBono(): number {
    return this.salario * 0.1; // 10% de bono
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests de herencia:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import { Persona } from '../src/persona';
import { Empleado } from '../src/empleado';

describe('Herencia - Persona y Empleado', () =&gt; {
  describe('Persona', () =&gt; {
    it('debe crear persona con datos válidos', () =&gt; {
      const persona = new Persona('Juan', 30);

      expect(persona.nombre).to.equal('Juan');
      expect(persona.edad).to.equal(30);
    });

    it('debe determinar si es mayor de edad', () =&gt; {
      const adulto = new Persona('Ana', 25);
      const menor = new Persona('Carlos', 15);

      expect(adulto.esMayorDeEdad()).to.be.true;
      expect(menor.esMayorDeEdad()).to.be.false;
    });
  });

  describe('Empleado - Herencia', () =&gt; {
    it('debe heredar propiedades de Persona', () =&gt; {
      const empleado = new Empleado('Juan', 30, 3000, 'IT');

      expect(empleado.nombre).to.equal('Juan');
      expect(empleado.edad).to.equal(30);
      expect(empleado).to.be.instanceOf(Persona);
    });

    it('debe tener propiedades propias de Empleado', () =&gt; {
      const empleado = new Empleado('Juan', 30, 3000, 'IT');

      expect(empleado.salario).to.equal(3000);
      expect(empleado.departamento).to.equal('IT');
    });

    it('debe heredar métodos de Persona', () =&gt; {
      const empleado = new Empleado('Juan', 30, 3000, 'IT');

      expect(empleado.esMayorDeEdad()).to.be.true;
    });

    it('debe tener sus propios métodos', () =&gt; {
      const empleado = new Empleado('Juan', 30, 3000, 'IT');

      expect(empleado.obtenerBono()).to.equal(300); // 3000 * 0.1
    });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_de_propiedades"><a class="link" href="#_testing_de_propiedades">Testing de Propiedades</a></h4>
<div class="paragraph">
<p>Valida que los getters, setters y propiedades funcionen correctamente.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class Cuenta {
  private saldo: number = 0;
  private movimientos: Array&lt;{ tipo: 'deposito' | 'retiro'; monto: number; fecha: Date }&gt; = [];

  constructor(saldoInicial: number = 0) {
    this.saldo = saldoInicial;
  }

  get obtenerSaldo(): number {
    return this.saldo;
  }

  depositar(monto: number): void {
    if (monto &lt;= 0) {
      throw new Error('El monto debe ser positivo');
    }
    this.saldo += monto;
    this.movimientos.push({ tipo: 'deposito', monto, fecha: new Date() });
  }

  retirar(monto: number): void {
    if (monto &gt; this.saldo) {
      throw new Error('Saldo insuficiente');
    }
    this.saldo -= monto;
    this.movimientos.push({ tipo: 'retiro', monto, fecha: new Date() });
  }

  obtenerMovimientos() {
    return [...this.movimientos];
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests de propiedades:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import { Cuenta } from '../src/cuenta';

describe('Cuenta - Propiedades', () =&gt; {
  it('debe inicializar con saldo inicial', () =&gt; {
    const cuenta = new Cuenta(1000);

    expect(cuenta.obtenerSaldo).to.equal(1000);
  });

  it('debe inicializar sin saldo inicial', () =&gt; {
    const cuenta = new Cuenta();

    expect(cuenta.obtenerSaldo).to.equal(0);
  });

  describe('Getter obtenerSaldo', () =&gt; {
    it('debe retornar saldo actual', () =&gt; {
      const cuenta = new Cuenta(500);

      expect(cuenta.obtenerSaldo).to.equal(500);
    });
  });

  describe('método depositar', () =&gt; {
    it('debe aumentar el saldo', () =&gt; {
      const cuenta = new Cuenta(1000);
      cuenta.depositar(500);

      expect(cuenta.obtenerSaldo).to.equal(1500);
    });

    it('debe registrar movimiento', () =&gt; {
      const cuenta = new Cuenta();
      cuenta.depositar(200);

      const movimientos = cuenta.obtenerMovimientos();
      expect(movimientos).to.have.lengthOf(1);
      expect(movimientos[0].tipo).to.equal('deposito');
      expect(movimientos[0].monto).to.equal(200);
    });

    it('debe lanzar error con monto negativo', () =&gt; {
      const cuenta = new Cuenta();

      expect(() =&gt; cuenta.depositar(-100)).to.throw('El monto debe ser positivo');
    });
  });

  describe('método retirar', () =&gt; {
    it('debe disminuir el saldo', () =&gt; {
      const cuenta = new Cuenta(1000);
      cuenta.retirar(300);

      expect(cuenta.obtenerSaldo).to.equal(700);
    });

    it('debe lanzar error si saldo insuficiente', () =&gt; {
      const cuenta = new Cuenta(100);

      expect(() =&gt; cuenta.retirar(200)).to.throw('Saldo insuficiente');
    });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_completo_integrado"><a class="link" href="#_ejemplo_completo_integrado">Ejemplo Completo Integrado</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// src/producto.ts
export class Producto {
  private id: number;
  private nombre: string;
  private precio: number;
  private stock: number;

  constructor(id: number, nombre: string, precio: number, stock: number = 0) {
    if (precio &lt; 0 || stock &lt; 0) {
      throw new Error('Precio y stock no pueden ser negativos');
    }
    this.id = id;
    this.nombre = nombre;
    this.precio = precio;
    this.stock = stock;
  }

  obtener() {
    return { id: this.id, nombre: this.nombre, precio: this.precio, stock: this.stock };
  }

  incrementarStock(cantidad: number): void {
    if (cantidad &lt;= 0) throw new Error('Cantidad debe ser positiva');
    this.stock += cantidad;
  }

  decrementarStock(cantidad: number): void {
    if (cantidad &gt; this.stock) throw new Error('Stock insuficiente');
    this.stock -= cantidad;
  }

  hayStock(cantidad: number = 1): boolean {
    return this.stock &gt;= cantidad;
  }

  aplicarDescuento(porcentaje: number): number {
    if (porcentaje &lt; 0 || porcentaje &gt; 100) {
      throw new Error('Descuento debe estar entre 0 y 100');
    }
    return this.precio * (1 - porcentaje / 100);
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests completos del Producto:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import { Producto } from '../src/producto';

describe('Producto - Tests Completos', () =&gt; {
  describe('Constructor', () =&gt; {
    it('debe crear producto con datos válidos', () =&gt; {
      const prod = new Producto(1, 'Laptop', 1000, 5);

      expect(prod.obtener()).to.deep.equal({
        id: 1,
        nombre: 'Laptop',
        precio: 1000,
        stock: 5
      });
    });

    it('debe validar precios negativos', () =&gt; {
      expect(() =&gt; new Producto(1, 'Laptop', -100, 5))
        .to.throw('Precio y stock no pueden ser negativos');
    });
  });

  describe('Manejo de Stock', () =&gt; {
    let producto: Producto;

    beforeEach(() =&gt; {
      producto = new Producto(1, 'Mouse', 50, 10);
    });

    it('debe incrementar stock', () =&gt; {
      producto.incrementarStock(5);

      expect(producto.obtener().stock).to.equal(15);
    });

    it('debe decrementar stock', () =&gt; {
      producto.decrementarStock(3);

      expect(producto.obtener().stock).to.equal(7);
    });

    it('debe verificar disponibilidad', () =&gt; {
      expect(producto.hayStock(5)).to.be.true;
      expect(producto.hayStock(15)).to.be.false;
    });
  });

  describe('Descuentos', () =&gt; {
    let producto: Producto;

    beforeEach(() =&gt; {
      producto = new Producto(1, 'Teclado', 100, 5);
    });

    it('debe aplicar descuento del 10%', () =&gt; {
      const precioConDescuento = producto.aplicarDescuento(10);

      expect(precioConDescuento).to.equal(90);
    });

    it('debe rechazar descuentos inválidos', () =&gt; {
      expect(() =&gt; producto.aplicarDescuento(-10))
        .to.throw('Descuento debe estar entre 0 y 100');

      expect(() =&gt; producto.aplicarDescuento(150))
        .to.throw('Descuento debe estar entre 0 y 100');
    });
  });
});</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_módulo_6_mocks_stubs_y_spies"><a class="link" href="#_módulo_6_mocks_stubs_y_spies">Módulo 6: Mocks, Stubs y Spies</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Los Mocks, Stubs y Spies son técnicas fundamentales para testear código que depende de otras funciones o servicios. Este módulo explora Sinon.js, la librería más popular para estas tareas.</p>
</div>
<div class="sect2">
<h3 id="_6_1_sinon_js_librería_de_mocking"><a class="link" href="#_6_1_sinon_js_librería_de_mocking">6.1 Sinon.js - Librería de Mocking</a></h3>
<div class="sect3">
<h4 id="_qué_es_sinon_js"><a class="link" href="#_qué_es_sinon_js">¿Qué es Sinon.js?</a></h4>
<div class="paragraph">
<p>Sinon.js es una librería que proporciona herramientas para crear y gestionar test doubles (dobles de prueba): spies, stubs y mocks.</p>
</div>
<div class="listingblock">
<div class="title">Instalación:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install --save-dev sinon
npm install --save-dev @types/sinon  # Para TypeScript</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_diferencia_spies_stubs_y_mocks"><a class="link" href="#_diferencia_spies_stubs_y_mocks">Diferencia: Spies, Stubs y Mocks</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 37.5%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Herramienta</th>
<th class="tableblock halign-left valign-top">Propósito</th>
<th class="tableblock halign-left valign-top">Usa</th>
<th class="tableblock halign-left valign-top">Verifica</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Spy</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Observar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Función original</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cómo se llamó</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Stub</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reemplazar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementación fake</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cómo se llamó + Control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mock</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Afirmar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implementación fake</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Llamadas + Comportamiento</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Cuándo usar cada uno:</div>
<ul>
<li>
<p><strong>Spy</strong>: Quieres ver cómo se utiliza una función sin cambiar su comportamiento</p>
</li>
<li>
<p><strong>Stub</strong>: Necesitas reemplazar una función con una versión controlada</p>
</li>
<li>
<p><strong>=Mock</strong>: Necesitas verificar que una función fue llamada de forma específica</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_6_2_spies_espías"><a class="link" href="#_6_2_spies_espías">6.2 Spies (Espías)</a></h3>
<div class="paragraph">
<p>Los spies rastrean llamadas a funciones sin modificar su comportamiento.</p>
</div>
<div class="sect3">
<h4 id="_sinon_spy_crear_un_spy"><a class="link" href="#_sinon_spy_crear_un_spy">sinon.spy() - Crear un Spy</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import sinon from 'sinon';
import { expect } from 'chai';

// Función a espiar
function enviarEmail(destinatario: string, asunto: string): void {
  console.log(`Email enviado a ${destinatario}: ${asunto}`);
}

describe('Sinon Spies - Tracking de Llamadas', () =&gt; {
  it('debe rastrear si una función fue llamada', () =&gt; {
    // Crear spy
    const spy = sinon.spy(enviarEmail);

    // Usar la función
    spy('usuario@example.com', 'Bienvenido');

    // Verificar
    expect(spy.called).to.be.true;
    expect(spy.callCount).to.equal(1);

    // Limpiar
    spy.restore();
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rastrear_argumentos"><a class="link" href="#_rastrear_argumentos">Rastrear Argumentos</a></h4>
<div class="paragraph">
<p>Los spies permiten verificar con qué argumentos se llamó una función.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import sinon from 'sinon';
import { expect } from 'chai';

function procesarOrden(orderId: number, cliente: string, monto: number): void {
  console.log(`Procesando orden ${orderId} de ${cliente} por $${monto}`);
}

describe('Spies - Validación de Argumentos', () =&gt; {
  let spy;

  beforeEach(() =&gt; {
    spy = sinon.spy(procesarOrden);
  });

  afterEach(() =&gt; {
    spy.restore();
  });

  it('debe capturar los argumentos de la llamada', () =&gt; {
    spy(123, 'Juan', 500);

    // Verificar llamada
    expect(spy.called).to.be.true;

    // Obtener argumentos de la primera llamada
    const args = spy.getCall(0).args;
    expect(args[0]).to.equal(123);
    expect(args[1]).to.equal('Juan');
    expect(args[2]).to.equal(500);
  });

  it('debe permitir verificación con calledWith', () =&gt; {
    spy(123, 'Juan', 500);

    // Sintaxis más limpia
    expect(spy.calledWith(123, 'Juan', 500)).to.be.true;
    expect(spy.calledWith(999, 'Ana', 100)).to.be.false;
  });

  it('debe rastrear múltiples llamadas', () =&gt; {
    spy(1, 'Juan', 100);
    spy(2, 'Ana', 200);
    spy(3, 'Carlos', 300);

    expect(spy.callCount).to.equal(3);

    // Verificar argumentos de cada llamada
    expect(spy.getCall(0).args[1]).to.equal('Juan');
    expect(spy.getCall(1).args[1]).to.equal('Ana');
    expect(spy.getCall(2).args[1]).to.equal('Carlos');
  });

  it('debe rastrear orden de llamadas', () =&gt; {
    spy(1, 'Juan', 100);
    spy(2, 'Ana', 200);

    expect(spy.firstCall.args[0]).to.equal(1);
    expect(spy.lastCall.args[0]).to.equal(2);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_spying_en_métodos_de_objeto"><a class="link" href="#_spying_en_métodos_de_objeto">Spying en Métodos de Objeto</a></h4>
<div class="paragraph">
<p>Puedes crear spies sobre métodos de objetos existentes.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import sinon from 'sinon';
import { expect } from 'chai';

class ServicioEmail {
  enviar(to: string, subject: string, body: string): { success: boolean } {
    console.log(`Enviando email a ${to}`);
    return { success: true };
  }
}

describe('Spies - Métodos de Objeto', () =&gt; {
  let servicio: ServicioEmail;
  let spy;

  beforeEach(() =&gt; {
    servicio = new ServicioEmail();
    spy = sinon.spy(servicio, 'enviar');
  });

  afterEach(() =&gt; {
    spy.restore();
  });

  it('debe rastrear llamadas a métodos', () =&gt; {
    servicio.enviar('usuario@example.com', 'Hola', 'Contenido');

    expect(spy.called).to.be.true;
    expect(spy.calledWith('usuario@example.com', 'Hola', 'Contenido')).to.be.true;
  });

  it('debe permitir múltiples spies simultáneamente', () =&gt; {
    const spy2 = sinon.spy(servicio, 'enviar');

    servicio.enviar('user1@example.com', 'Test', 'Body');
    servicio.enviar('user2@example.com', 'Test2', 'Body2');

    expect(spy.callCount).to.equal(2);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_call_count_y_call_history"><a class="link" href="#_call_count_y_call_history">Call Count y Call History</a></h4>
<div class="paragraph">
<p>Información detallada sobre todas las llamadas.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Tabla de propiedades útiles:</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Propiedad</th>
<th class="tableblock halign-left valign-top">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spy.called</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">¿Se llamó al menos una vez?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spy.callCount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Número total de llamadas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spy.calledOnce</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">¿Se llamó exactamente una vez?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spy.calledTwice</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">¿Se llamó exactamente dos veces?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spy.calledThrice</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">¿Se llamó exactamente tres veces?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spy.notCalled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">¿No se llamó nunca?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spy.firstCall</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primera llamada (objeto Call)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spy.lastCall</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Última llamada (objeto Call)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>s=py.getCall(n)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtener n-ésima llamada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spy.getCalls()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Todas las llamadas</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import sinon from 'sinon';
import { expect } from 'chai';

function notificar(mensaje: string): void {
  console.log(mensaje);
}

describe('Spies - Call History', () =&gt; {
  let spy;

  beforeEach(() =&gt; {
    spy = sinon.spy(notificar);
  });

  afterEach(() =&gt; {
    spy.restore();
  });

  it('debe verificar callCount', () =&gt; {
    spy('Mensaje 1');
    spy('Mensaje 2');
    spy('Mensaje 3');

    expect(spy.callCount).to.equal(3);
    expect(spy.calledThrice).to.be.true;
  });

  it('debe acceder a detalles de cada llamada', () =&gt; {
    spy('Primero');
    spy('Segundo');

    const calls = spy.getCalls();

    expect(calls).to.have.lengthOf(2);
    expect(calls[0].args[0]).to.equal('Primero');
    expect(calls[1].args[0]).to.equal('Segundo');
  });
});</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_6_3_stubs_reemplazos"><a class="link" href="#_6_3_stubs_reemplazos">6.3 Stubs (Reemplazos)</a></h3>
<div class="paragraph">
<p>Los stubs reemplazan funciones completamente, permitiendo controlar su comportamiento.</p>
</div>
<div class="sect3">
<h4 id="_sinon_stub_crear_un_stub"><a class="link" href="#_sinon_stub_crear_un_stub">sinon.stub() - Crear un Stub</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import sinon from 'sinon';
import { expect } from 'chai';

// Función a reemplazar
function obtenerTemperatura(ciudad: string): number {
  // En realidad llamaría a API
  throw new Error('No debe llamarse en test');
}

describe('Sinon Stubs - Reemplazos', () =&gt; {
  it('debe reemplazar función con stub', () =&gt; {
    // Crear stub que devuelve un valor específico
    const stub = sinon.stub().returns(25);

    const resultado = stub();

    expect(resultado).to.equal(25);
    expect(stub.called).to.be.true;
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_valores_retornados_personalizados"><a class="link" href="#_valores_retornados_personalizados">Valores Retornados Personalizados</a></h4>
<div class="paragraph">
<p>Los stubs pueden retornar diferentes valores según la llamada.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import sinon from 'sinon';
import { expect } from 'chai';

class ServicioClima {
  obtenerTemperatura(ciudad: string): number {
    throw new Error('API externa');
  }
}

describe('Stubs - Valores Personalizados', () =&gt; {
  let stub;

  afterEach(() =&gt; {
    if (stub) stub.restore();
  });

  it('debe retornar valor específico', () =&gt; {
    stub = sinon.stub().returns(25);

    expect(stub()).to.equal(25);
    expect(stub.returned(25)).to.be.true;
  });

  it('debe retornar diferentes valores por llamada', () =&gt; {
    stub = sinon.stub()
      .onFirstCall().returns(20)
      .onSecondCall().returns(25)
      .onThirdCall().returns(30);

    expect(stub()).to.equal(20);  // Primera llamada
    expect(stub()).to.equal(25);  // Segunda llamada
    expect(stub()).to.equal(30);  // Tercera llamada
  });

  it('debe retornar valor según argumentos', () =&gt; {
    stub = sinon.stub()
      .withArgs('Madrid').returns(28)
      .withArgs('Barcelona').returns(25)
      .withArgs('Bilbao').returns(22);

    expect(stub('Madrid')).to.equal(28);
    expect(stub('Barcelona')).to.equal(25);
    expect(stub('Bilbao')).to.equal(22);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_stub_de_métodos_de_objeto"><a class="link" href="#_stub_de_métodos_de_objeto">Stub de Métodos de Objeto</a></h4>
<div class="paragraph">
<p>Reemplazar métodos específicos de un objeto.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import sinon from 'sinon';
import { expect } from 'chai';

class BaseDatos {
  query(sql: string): any {
    throw new Error('Conexión a DB real');
  }
}

class RepositorioUsuarios {
  constructor(private db: BaseDatos) {}

  obtener(id: number) {
    return this.db.query(`SELECT * FROM usuarios WHERE id = ${id}`);
  }
}

describe('Stubs - Métodos de Objeto', () =&gt; {
  let db: BaseDatos;
  let repo: RepositorioUsuarios;
  let stub;

  beforeEach(() =&gt; {
    db = new BaseDatos();
    repo = new RepositorioUsuarios(db);
  });

  afterEach(() =&gt; {
    if (stub) stub.restore();
  });

  it('debe stubear método de BD', () =&gt; {
    stub = sinon.stub(db, 'query').returns({
      id: 1,
      nombre: 'Juan',
      email: 'juan@example.com'
    });

    const usuario = repo.obtener(1);

    expect(usuario.nombre).to.equal('Juan');
    expect(stub.called).to.be.true;
  });

  it('debe retornar diferentes valores por argumento', () =&gt; {
    stub = sinon.stub(db, 'query')
      .withArgs('SELECT * FROM usuarios WHERE id = 1')
      .returns({ id: 1, nombre: 'Juan' })
      .withArgs('SELECT * FROM usuarios WHERE id = 2')
      .returns({ id: 2, nombre: 'Ana' });

    const usuario1 = repo.obtener(1);
    const usuario2 = repo.obtener(2);

    expect(usuario1.nombre).to.equal('Juan');
    expect(usuario2.nombre).to.equal('Ana');
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lanzar_errores_desde_stubs"><a class="link" href="#_lanzar_errores_desde_stubs">Lanzar Errores desde Stubs</a></h4>
<div class="paragraph">
<p>Los stubs pueden simular errores.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import sinon from 'sinon';
import { expect } from 'chai';

async function obtenerProducto(id: number) {
  // Llamaría a API
  throw new Error('No debe ejecutarse');
}

describe('Stubs - Lanzar Errores', () =&gt; {
  it('debe lanzar error desde stub', async () =&gt; {
    const stub = sinon.stub().throws(new Error('Producto no encontrado'));

    try {
      stub(999);
      throw new Error('Debería haber lanzado error');
    } catch (err) {
      expect(err.message).to.equal('Producto no encontrado');
    }
  });

  it('debe lanzar error según argumentos', () =&gt; {
    const stub = sinon.stub()
      .withArgs(999).throws(new Error('No encontrado'))
      .withArgs(1).returns({ id: 1, nombre: 'Laptop' });

    expect(() =&gt; stub(999)).to.throw('No encontrado');
    expect(stub(1).nombre).to.equal('Laptop');
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_reject_de_promises"><a class="link" href="#_reject_de_promises">Reject de Promises</a></h4>
<div class="paragraph">
<p>Los stubs pueden rechazar promises.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import sinon from 'sinon';
import { expect } from 'chai';

describe('Stubs - Promise Rejection', () =&gt; {
  it('debe rechazar promise', async () =&gt; {
    const stub = sinon.stub()
      .rejects(new Error('Fallo en la operación'));

    try {
      await stub();
      throw new Error('Debería haber rechazado');
    } catch (err) {
      expect(err.message).to.equal('Fallo en la operación');
    }
  });

  it('debe resolver o rechazar según argumentos', async () =&gt; {
    const stub = sinon.stub()
      .withArgs(1).resolves({ id: 1, nombre: 'Laptop' })
      .withArgs(999).rejects(new Error('No encontrado'));

    const resultado = await stub(1);
    expect(resultado.nombre).to.equal('Laptop');

    try {
      await stub(999);
    } catch (err) {
      expect(err.message).to.equal('No encontrado');
    }
  });
});</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_6_4_mocks_burlas"><a class="link" href="#_6_4_mocks_burlas">6.4 Mocks (Burlas)</a></h3>
<div class="paragraph">
<p>Los mocks combinan la funcionalidad de stubs con aserciones integradas sobre cómo fueron llamados.</p>
</div>
<div class="sect3">
<h4 id="_sinon_mock_crear_un_mock"><a class="link" href="#_sinon_mock_crear_un_mock">sinon.mock() - Crear un Mock</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import sinon from 'sinon';
import { expect } from 'chai';

class RegistradorEventos {
  registrar(evento: string, datos: any): void {
    console.log(`Evento: ${evento}`, datos);
  }
}

describe('Sinon Mocks - Aserciones Integradas', () =&gt; {
  it('debe verificar expectativas de llamadas', () =&gt; {
    const registrador = new RegistradorEventos();
    const mock = sinon.mock(registrador);

    // Establecer expectativa
    mock.expects('registrar')
      .once()  // Debe llamarse una sola vez
      .withArgs('login', sinon.match({ usuarioId: 1 }));

    // Usar el objeto
    registrador.registrar('login', { usuarioId: 1 });

    // Verificar expectativas
    mock.verify();
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expectativas_de_mocks"><a class="link" href="#_expectativas_de_mocks">Expectativas de Mocks</a></h4>
<div class="paragraph">
<p>Tabla de métodos de expectativas:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Método</th>
<th class="tableblock halign-left valign-top">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.once()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debe llamarse exactamente una vez</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.twice()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debe llamarse exactamente dos veces</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.thrice()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debe llamarse exactamente tres veces</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.exactly(n)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debe llamarse exactamente n veces</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.atLeast(n)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debe llamarse al menos n veces</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.atMost(n)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debe llamarse como máximo n veces</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.withArgs(args)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debe llamarse con estos argumentos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.withExactArgs(args)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exactamente estos argumentos (sin variación)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.=returns(value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retorna un valor específico</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.throws(error)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lanza un error específico</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.verify()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verifica que se cumplieron todas las expectativas</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Ejemplo completo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import sinon from 'sinon';
import { expect } from 'chai';

class ServicioNotificaciones {
  enviar(tipo: string, destinatario: string, mensaje: string): void {}
  registrar(evento: string, datos: any): void {}
}

describe('Mocks - Expectativas', () =&gt; {
  let servicio: ServicioNotificaciones;
  let mock;

  beforeEach(() =&gt; {
    servicio = new ServicioNotificaciones();
  });

  afterEach(() =&gt; {
    if (mock) mock.restore();
  });

  it('debe verificar que se llamó con argumentos específicos', () =&gt; {
    mock = sinon.mock(servicio);

    mock.expects('enviar')
      .withArgs('email', 'usuario@example.com', 'Bienvenido')
      .once();

    servicio.enviar('email', 'usuario@example.com', 'Bienvenido');

    mock.verify();
  });

  it('debe verificar múltiples llamadas esperadas', () =&gt; {
    mock = sinon.mock(servicio);

    mock.expects('registrar').twice();
    mock.expects('enviar').atLeast(1);

    servicio.registrar('login', { usuarioId: 1 });
    servicio.registrar('logout', { usuarioId: 1 });
    servicio.enviar('email', 'user@example.com', 'Mensaje');

    mock.verify();
  });

  it('debe fallar si expectativas no se cumplen', () =&gt; {
    mock = sinon.mock(servicio);

    mock.expects('enviar').once();

    try {
      servicio.enviar('email', 'user@example.com', 'Msg 1');
      servicio.enviar('email', 'user@example.com', 'Msg 2'); // Segunda llamada!

      mock.verify();
      throw new Error('Debería haber fallado');
    } catch (err) {
      expect(err.message).to.include('expected');
    }
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_práctico_completo_carrito_de_compras"><a class="link" href="#_ejemplo_práctico_completo_carrito_de_compras">Ejemplo Práctico Completo: Carrito de Compras</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// src/carrito.ts
export class CarritoCompras {
  private items: any[] = [];

  constructor(
    private notificador: any,
    private baseDatos: any,
    private analizador: any
  ) {}

  agregarProducto(productoId: number, nombre: string, precio: number): void {
    this.items.push({ productoId, nombre, precio });
    this.notificador.notificar(`Producto ${nombre} agregado`);
  }

  completarCompra(): void {
    this.baseDatos.guardarPedido(this.items);
    this.analizador.rastrearCompra(this.items);
    this.notificador.notificar('Compra completada');
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests con Spies, Stubs y Mocks:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import sinon from 'sinon';
import { expect } from 'chai';
import { CarritoCompras } from '../src/carrito';

describe('CarritoCompras - Spies, Stubs y Mocks', () =&gt; {
  let carrito: CarritoCompras;
  let notificador, baseDatos, analizador;
  let notificadorMock, baseDatasStub, analizadorSpy;

  beforeEach(() =&gt; {
    notificador = {
      notificar: (mensaje: string) =&gt; console.log(mensaje)
    };
    baseDatos = {
      guardarPedido: (items: any[]) =&gt; {}
    };
    analizador = {
      rastrearCompra: (items: any[]) =&gt; {}
    };

    carrito = new CarritoCompras(notificador, baseDatos, analizador);
  });

  afterEach(() =&gt; {
    if (notificadorMock) notificadorMock.restore();
    if (baseDatasStub) baseDatasStub.restore();
    if (analizadorSpy) analizadorSpy.restore();
  });

  describe('Usando Spies', () =&gt; {
    it('debe rastrear notificaciones', () =&gt; {
      analizadorSpy = sinon.spy(analizador, 'rastrearCompra');

      carrito.agregarProducto(1, 'Laptop', 1000);

      expect(analizadorSpy.called).to.be.false; // No se llama en agregar
    });
  });

  describe('Usando Stubs', () =&gt; {
    it('debe stubear BD para evitar guardarla', () =&gt; {
      baseDatasStub = sinon.stub(baseDatos, 'guardarPedido').returns(true);

      carrito.agregarProducto(1, 'Laptop', 1000);
      carrito.completarCompra();

      expect(baseDatasStub.called).to.be.true;
    });
  });

  describe('Usando Mocks', () =&gt; {
    it('debe verificar que notificador es llamado correctamente', () =&gt; {
      notificadorMock = sinon.mock(notificador);
      baseDatasStub = sinon.stub(baseDatos, 'guardarPedido');
      analizadorSpy = sinon.spy(analizador, 'rastrearCompra');

      notificadorMock.expects('notificar')
        .twice()
        .withArgs(sinon.match.string);

      carrito.agregarProducto(1, 'Laptop', 1000);
      carrito.completarCompra();

      notificadorMock.verify();
    });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cuándo_usar_cada_uno"><a class="link" href="#_cuándo_usar_cada_uno">Cuándo Usar Cada Uno</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Herramienta</th>
<th class="tableblock halign-left valign-top">Cuándo Usar</th>
<th class="tableblock halign-left valign-top">Beneficio</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Spy</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monitorear función real</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verifica intera acciones sin interferir</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Stub</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reemplazar dependencia</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control total, aisla código de test</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mock</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verificar comportamiento</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aserciones integradas, expresa intención</p></td>
</tr>
</tbody>
</table>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_módulo_7_testing_de_código_asíncrono"><a class="link" href="#_módulo_7_testing_de_código_asíncrono">Módulo 7: Testing de Código Asíncrono</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>=
Testing de código asincrónico requiere técnicas especiales que veremos en este módulo. Cubriremos los tres patrones principales: callbacks, promises y async/await, además de técnicas avanzadas como polling y retry.</p>
</div>
<div class="sect2">
<h3 id="_7_1_callbacks"><a class="link" href="#_7_1_callbacks">7.1 Callbacks</a></h3>
<div class="sect3">
<h4 id="_por_qué_es_diferente_testear_callbacks"><a class="link" href="#_por_qué_es_diferente_testear_callbacks">¿Por qué es diferente testear callbacks?</a></h4>
<div class="paragraph">
<p>El código sincrónico se ejecuta inmediatamente. El código asincrónico se ejecuta después de un tiempo indeterminado. Sin técnicas especiales, Mocha terminaría el test antes de que el callback se ejecute.</p>
</div>
<div class="listingblock">
<div class="title">Problema común:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

function leerArchivo(ruta: string, callback: (err: any, datos: string) =&gt; void): void {
  // Simular lectura con delay
  setTimeout(() =&gt; {
    callback(null, 'Contenido del archivo');
  }, 100);
}

describe('Callbacks - Problema', () =&gt; {
  it('FALLA: No espera el callback', () =&gt; {
    let resultado: string;

    leerArchivo('archivo.txt', (err, datos) =&gt; {
      resultado = datos;
    });

    // Este test pasa porque la aserción sucede antes del callback
    // El resultado es undefined pero no se verifica
    expect(resultado).to.equal('Contenido del archivo'); // FALLA: resultado es undefined
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_solución_done_callback"><a class="link" href="#_solución_done_callback">Solución: done Callback</a></h4>
<div class="paragraph">
<p>Mocha permite pasar un parámetro <code>done</code> al callback del test. El test solo finaliza cuando <code>done()</code> se ejecuta.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo correcto:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

function leerArchivo(ruta: string, callback: (err: any, datos: string) =&gt; void): void {
  setTimeout(() =&gt; {
    callback(null, 'Contenido del archivo');
  }, 100);
}

describe('Callbacks - done Parameter', () =&gt; {
  it('debe esperar callback antes de finalizar', (done) =&gt; {
    let resultado: string;

    leerArchivo('archivo.txt', (err, datos) =&gt; {
      resultado = datos;
      expect(resultado).to.equal('Contenido del archivo');
      done();  // Señala que el test termina aquí
    });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_manejo_de_errores_con_callbacks"><a class="link" href="#_manejo_de_errores_con_callbacks">Manejo de Errores con Callbacks</a></h4>
<div class="paragraph">
<p>Los errores en callbacks deben pasarse a <code>done()</code>.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

function conectarBaseDatos(url: string, callback: (err: any, conexion?: any) =&gt; void): void {
  setTimeout(() =&gt; {
    f (url === 'válida') {
      callback(null, { conectado: true });
    } else {
      callback(new Error('URL inválida'));
    }
  }, 50);
}

describe('Callbacks - Error Handling', () =&gt; {
  it('debe pasar error a done()', (done) =&gt; {
    conectarBaseDatos('inválida', (err, conexion) =&gt; {
      try {
        expect(err).to.exist;
        expect(err.message).to.equal('URL inválida');
        done();
      } catch (e) {
        done(e);  // Pasar el error a done
      }
    });
  });

  it('debe manejar error correctamente', (done) =&gt; {
    conectarBaseDatos('válida', (err, conexion) =&gt; {
      try {
        expect(err).to.be.null;
        expect(conexion.conectado).to.be.true;
        done();
      } catch (e) {
        done(e);
      }
    });
  });

  it('debe fallar si callback lanza error sin try/catch', (done) =&gt; {
    conectarBaseDatos('válida', (err, conexion) =&gt; {
      expect(err).to.be.null;
      expect(conexion.conectado).to.be.true;
      done();
      // Si hubiera error, done() nunca se ejecutaría
    });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_timeout_en_callbacks"><a class="link" href="#_timeout_en_callbacks">Timeout en Callbacks</a></h4>
<div class="paragraph">
<p>Mocha tiene timeout por defecto de 2000ms. Puede ser personalizado.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

function operacionLenta(callback: () =&gt; void): void {
  setTimeout(callback, 3000);  // Tarda 3 segundos
}

describe('Callbacks - Timeout', () =&gt; {
  it('falla si tard más que el timeout', (done) =&gt; {
    operacionLenta(() =&gt; {
      done();
    });
    // Falla: timeout 2000ms &lt; operación 3000ms
  });

  it('personalizar timeout para test específico', function(done) {
    this.timeout(5000);  // 5 segundos solo para este test

    operacionLenta(() =&gt; {
      expect(true).to.be.true;
      done();
    });
  });

  it('aumentar timeout global', function(done) {
    this.timeout(10000);

    operacionLenta(() =&gt; {
      done();
    });
  });

  it('inhabilitar timeout', function(done) {
    this.timeout(0);  // Sin timeout

    operacionLenta(() =&gt; {
      done();
    });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_práctico_servicio_de_email"><a class="link" href="#_ejemplo_práctico_servicio_de_email">Ejemplo Práctico: Servicio de Email</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// src/servicioEmail.ts
export class ServicioEmail {
  enviar(
    destinatario: string,
    asunto: string,
    cuerpo: string,
    callback: (err: any, resultado?: { id: string }) =&gt; void
  ): void {
    // Simular envío asincrónico
    setTimeout(() =&gt; {
      if (!destinatario.includes('@')) {
        callback(new Error('Email inválido'));
      } else {
        callback(null, { id: `email_${Date.now()}` });
      }
    }, 100);
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import { ServicioEmail } from '../src/servicioEmail';

describe('ServicioEmail - Callbacks', () =&gt; {
  let servicio: ServicioEmail;

  beforeEach(() =&gt; {
    servicio = new ServicioEmail();
  });

  it('debe enviar email válido', (done) =&gt; {
    servicio.enviar('usuario@example.com', 'Hola', 'Contenido', (err, resultado) =&gt; {
      try {
        expect(err).to.be.null;
        expect(resultado).to.exist;
        expect(resultado!.id).to.match(/^email_\d+$/);
        done();
      } catch (e) {
        done(e);
      }
    });
  });

  it('debe rechazar email inválido', (done) =&gt; {
    servicio.enviar('usuario-invalido', 'Hola', 'Contenido', (err, resultado) =&gt; {
      try {
        expect(err).to.exist;
        expect(err.message).to.equal('Email inválido');
        expect(resultado).to.be.undefined;
        done();
      } catch (e) {
        done(e);
      }
    });
  });
});</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_7_2_promises"><a class="link" href="#_7_2_promises">7.2 Promises</a></h3>
<div class="sect3">
<h4 id="_testing_de_promises"><a class="link" href="#_testing_de_promises">Testing de Promises</a></h4>
<div class="paragraph">
<p>Con Promises, no se necesita <code>done</code> callback. Solo retorna la promise.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo básico:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

function obtenerDatos(id: number): Promise&lt;{ id: number; nombre: string }&gt; {
  return new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; {
      if (id &gt; 0) {
        resolve({ id, nombre: 'Usuario' });
      } else {
        reject(new Error('ID inválido'));
      }
    }, 50);
  });
}

describe('Promises - Return Pattern', () =&gt; {
  it('debe retornar la promise para que Mocha la espere', () =&gt; {
    // Retornar promise directo
    return obtenerDatos(1).then(datos =&gt; {
      expect(datos.nombre).to.equal('Usuario');
    });
  });

  it('puede usar encadenamiento de promesas', () =&gt; {
    return obtenerDatos(5)
      .then(datos =&gt; {
        expect(datos.id).to.equal(5);
        return obtenerDatos(10);
      })
      .then(datos =&gt; {
        expect(datos.id).to.equal(10);
      });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_manejo_de_rechazos"><a class="link" href="#_manejo_de_rechazos">Manejo de Rechazos</a></h4>
<div class="paragraph">
<p>Las promises rechazadas deben ser manejadas con <code>.catch()</code> o <code>.rejectedWith()</code>.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

function obtenerProducto(id: number): Promise&lt;{ id: number; precio: number }&gt; {
  return new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; {
      if (id &gt; 0) {
        resolve({ id, precio: 99.99 });
      } else {
        reject(new Error('Producto no encontrado'));
      }
    }, 50);
  });
}

describe('Promises - Error Handling', () =&gt; {
  it('debe capturar rechazos con .catch()', () =&gt; {
    return obtenerProducto(-1)
      .then(() =&gt; {
        throw new Error('Debería haber rechazado');
      })
      .catch(err =&gt; {
        expect(err.message).to.equal('Producto no encontrado');
      });
  });

  it('debe verificar que rechaza correctamente', () =&gt; {
    return obtenerProducto(-1).then(
      () =&gt; {
        throw new Error('No debería resolver');
      },
      (err) =&gt; {
        expect(err.message).to.equal('Producto no encontrado');
      }
    );
  });

  it('debe usar rejectedWith con Chai', () =&gt; {
    return expect(obtenerProducto(-1)).to.be.rejectedWith('Producto no encontrado');
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_promise_all_y_promise_race"><a class="link" href="#_promise_all_y_promise_race">Promise.all() y Promise.race()</a></h4>
<div class="paragraph">
<p>Testing con múltiples promises simultáneamente.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

function obtenerUsuario(id: number): Promise&lt;{ id: number; nombre: string }&gt; {
  return new Promise((resolve) =&gt; {
    setTimeout(() =&gt; {
      resolve({ id, nombre: `Usuario ${id}` });
    }, Math.random() * 100);
  });
}

function obtenerCarrito(id: number): Promise&lt;{ id: number; items: number }&gt; {
  return new Promise((resolve) =&gt; {
    setTimeout(() =&gt; {
      resolve({ id, items: Math.random() * 10 | 0 });
    }, Math.random() * 100);
  });
}

describe('Promises - Promise.all()', () =&gt; {
  it('debe esperar todas las promises', () =&gt; {
    return Promise.all([
      obtenerUsuario(1),
      obtenerCarrito(1)
    ]).then(([usuario, carrito]) =&gt; {
      expect(usuario.nombre).to.equal('Usuario 1');
      expect(carrito.items).to.be.a('number');
    });
  });

  it('debe fallar si alguna promise falla', () =&gt; {
    const promeseFallida = Promise.reject(new Error('Fallo en BD'));

    return expect(
      Promise.all([obtenerUsuario(1), promeseFallida])
    ).to.be.rejected;
  });
});

describe('Promises - Promise.race()', () =&gt; {
  it('debe resolver con la primera promise que se completa', () =&gt; {
    return Promise.race([
      obtenerUsuario(1),
      obtenerCarrito(1)
    ]).then(resultado =&gt; {
      expect(resultado).to.exist;
      expect(resultado.id).to.equal(1);
    });
  });

  it('debe rechazar si primera promise se rechaza', () =&gt; {
    const promeseFallida = Promise.reject(new Error('Primer rechazo'));

    return expect(
      Promise.race([promeseFallida, obtenerUsuario(1)])
    ).to.be.rejected;
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_práctico_cliente_http"><a class="link" href="#_ejemplo_práctico_cliente_http">Ejemplo Práctico: Cliente HTTP</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// src/clienteHttp.ts
export class ClienteHttp {
  get(url: string): Promise&lt;any&gt; {
    return new Promise((resolve, reject) =&gt; {
      setTimeout(() =&gt; {
        if (url.startsWith('http')) {
          resolve({ status: 200, datos: { id: 1, nombre: 'Recurso' } });
        } else {
          reject(new Error('URL inválida'));
        }
      }, 50);
    });
  }

  post(url: string, datos: any): Promise&lt;any&gt; {
    return new Promise((resolve, reject) =&gt; {
      setTimeout(() =&gt; {
        if (url.startsWith('http') &amp;&amp; datos) {
          resolve({ status: 201, id: Math.random() });
        } else {
          reject(new Error('Datos inválidos'));
        }
      }, 50);
    });
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import { ClienteHttp } from '../src/clienteHttp';

describe('ClienteHttp - Promises', () =&gt; {
  let cliente: ClienteHttp;

  beforeEach(() =&gt; {
    cliente = new ClienteHttp();
  });

  it('debe realizar GET y retornar datos', () =&gt; {
    return cliente.get('http://api.example.com/usuarios/1')
      .then(respuesta =&gt; {
        expect(respuesta.status).to.equal(200);
        expect(respuesta.datos.nombre).to.equal('Recurso');
      });
  });

  it('debe rechazar GET con URL inválida', () =&gt; {
    return expect(
      cliente.get('api-invalida')
    ).to.be.rejectedWith('URL inválida');
  });

  it('debe encadenar GET y POST', () =&gt; {
    return cliente.get('http://api.example.com/datos')
      .then(respuesta =&gt; {
        return cliente.post('http://api.example.com/crear', {
          nombre: respuesta.datos.nombre
        });
      })
      .then(crearRespuesta =&gt; {
        expect(crearRespuesta.status).to.equal(201);
        expect(crearRespuesta.id).to.be.a('number');
      });
  });
});</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_7_3_asyncawait"><a class="link" href="#_7_3_asyncawait">7.3 Async/Await</a></h3>
<div class="sect3">
<h4 id="_asyncawait_la_forma_moderna"><a class="link" href="#_asyncawait_la_forma_moderna">Async/Await - La Forma Moderna</a></h4>
<div class="paragraph">
<p>Async/await permite escribir código asincrónico que se parece a código sincrónico. Es el patrón preferido hoy.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo básico:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

async function obtenerDatos(id: number): Promise&lt;{ id: number; nombre: string }&gt; {
  return new Promise((resolve) =&gt; {
    setTimeout(() =&gt; {
      resolve({ id, nombre: `Elemento ${id}` });
    }, 100);
  });
}

describe('Async/Await - Básico', () =&gt; {
  it('debe usar async/await', async () =&gt; {
    const datos = await obtenerDatos(5);

    expect(datos.id).to.equal(5);
    expect(datos.nombre).to.equal('Elemento 5');
  });

  it('puede encadenar múltiples awaits', async () =&gt; {
    const datos1 = await obtenerDatos(1);
    const datos2 = await obtenerDatos(2);
    const datos3 = await obtenerDatos(3);

    expect(datos1.id).to.equal(1);
    expect(datos2.id).to.equal(2);
    expect(datos3.id).to.equal(3);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_manejo_de_errores_en_asyncawait"><a class="link" href="#_manejo_de_errores_en_asyncawait">Manejo de Errores en Async/Await</a></h4>
<div class="paragraph">
<p>Usar try/catch para manejar rechazos de promises.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

async function obtenerUsuario(id: number): Promise&lt;{ nombre: string }&gt; {
  return new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; {
      if (id &gt; 0) {
        resolve({ nombre: `Usuario ${id}` });
      } else {
        reject(new Error('Usuario no encontrado'));
      }
    }, 50);
  });
}

describe('Async/Await - Try/Catch', () =&gt; {
  it('debe capturar errores con try/catch', async () =&gt; {
    try {
      await obtenerUsuario(-1);
      throw new Error('Debería haber lanzado error');
    } catch (err) {
      expect(err.message).to.equal('Usuario no encontrado');
    }
  });

  it('debe permitir manejo de ambos casos', async () =&gt; {
    try {
      const usuario = await obtenerUsuario(5);
      expect(usuario.nombre).to.equal('Usuario 5');
    } catch (err) {
      throw new Error('No debería fallar');
    }
  });

  it('debe esperar múltiples operaciones', async () =&gt; {
    try {
      const usuario1 = await obtenerUsuario(1);
      const usuario2 = await obtenerUsuario(2);
      const usuario3 = await obtenerUsuario(3);

      expect(usuario1.nombre).to.include('Usuario');
      expect(usuario2.nombre).to.include('Usuario');
      expect(usuario3.nombre).to.include('Usuario');
    } catch (err) {
      throw new Error('Todas deberían resolver');
    }
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_asyncawait_con_promise_all"><a class="link" href="#_asyncawait_con_promise_all">Async/Await con Promise.all()</a></h4>
<div class="paragraph">
<p>Ejecutar múltiples promises en paralelo es más eficiente.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

async function obtenerProducto(id: number): Promise&lt;{ id: number; precio: number }&gt; {
  return new Promise((resolve) =&gt; {
    setTimeout(() =&gt; {
      resolve({ id, precio: Math.random() * 1000 });
    }, Math.random() * 100);
  });
}

describe('Async/Await - Paralelo vs Secuencial', () =&gt; {
  it('secuencial: espera cada uno (más lento)', async () =&gt; {
    const inicio = Date.now();

    const prod1 = await obtenerProducto(1);
    const prod2 = await obtenerProducto(2);
    const prod3 = await obtenerProducto(3);

    const tiempoTotal = Date.now() - inicio;

    expect([prod1, prod2, prod3]).to.have.lengthOf(3);
    expect(tiempoTotal).to.be.greaterThan(200); // ~300ms si cada uno tarda ~100ms
  });

  it('paralelo: ejecuta en paralelo (más rápido)', async () =&gt; {
    const inicio = Date.now();

    const productos = await Promise.all([
      obtenerProducto(1),
      obtenerProducto(2),
      obtenerProducto(3)
    ]);

    const tiempoTotal = Date.now() - inicio;

    expect(productos).to.have.lengthOf(3);
    expect(tiempoTotal).to.be.lessThan(200); // ~100ms max
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_práctico_procesamiento_de_datos"><a class="link" href="#_ejemplo_práctico_procesamiento_de_datos">Ejemplo Práctico: Procesamiento de Datos</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// src/procesadorDatos.ts
export class ProcesadorDatos {
  async obtenerJSON(url: string): Promise&lt;any&gt; {
    // Simular fetch
    return new Promise((resolve, reject) =&gt; {
      setTimeout(() =&gt; {
        if (url.includes('invalid')) {
          reject(new Error('URL no válida'));
        } else {
          resolve({ datos: [1, 2, 3, 4, 5] });
        }
      }, 50);
    });
  }

  async transformar(datos: any): Promise&lt;number&gt; {
    // Simular transformación
    return new Promise((resolve) =&gt; {
      setTimeout(() =&gt; {
        const suma = datos.datos.reduce((a: number, b: number) =&gt; a + b, 0);
        resolve(suma);
      }, 50);
    });
  }

  async procesar(url: string): Promise&lt;number&gt; {
    const respuesta = await this.obtenerJSON(url);
    const resultado = await this.transformar(respuesta);
    return resultado;
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import { ProcesadorDatos } from '../src/procesadorDatos';

describe('ProcesadorDatos - Async/Await', () =&gt; {
  let procesador: ProcesadorDatos;

  beforeEach(() =&gt; {
    procesador = new ProcesadorDatos();
  });

  it('debe obtener y transformar datos', async () =&gt; {
    const resultado = await procesador.procesar('http://api.example.com/datos');

    expect(resultado).to.equal(15); // 1+2+3+4+5
  });

  it('debe manejar errores en URL inválida', async () =&gt; {
    try {
      await procesador.procesar('http://invalid-url/datos');
      throw new Error('Debería haber rechazado');
    } catch (err) {
      expect(err.message).to.include('URL no válida');
    }
  });

  it('debe ejecutar múltiples procesamientos en paralelo', async () =&gt; {
    const resultados = await Promise.all([
      procesador.procesar('http://api.example.com/datos1'),
      procesador.procesar('http://api.example.com/datos2'),
      procesador.procesar('http://api.example.com/datos3')
    ]);

    expect(resultados).to.have.lengthOf(3);
    resultados.forEach(r =&gt; expect(r).to.equal(15));
  });
});</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_7_4_polling_y_retry"><a class="link" href="#_7_4_polling_y_retry">7.4 Polling y Retry</a></h3>
<div class="sect3">
<h4 id="_polling_esperar_condiciones"><a class="link" href="#_polling_esperar_condiciones">Polling: Esperar Condiciones</a></h4>
<div class="paragraph">
<p>A veces necesitas esperar hasta que una condición sea verdadera.</p>
</div>
<div class="listingblock">
<div class="title">Función de helper polling:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// src/polling.ts
export function polling(
  condicion: () =&gt; boolean | Promise&lt;boolean&gt;,
  intervalo: number = 100,
  timeout: number = 5000
): Promise&lt;void&gt; {
  const inicio = Date.now();

  return new Promise((resolve, reject) =&gt; {
    const verificar = async () =&gt; {
      try {
        const resultado = await Promise.resolve(condicion());

        if (resultado) {
          resolve();
        } else if (Date.now() - inicio &gt; timeout) {
          reject(new Error(`Polling timeout after ${timeout}ms`));
        } else {
          setTimeout(verificar, intervalo);
        }
      } catch (err) {
        reject(err);
      }
    };

    verificar();
  });
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo de uso:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import { polling } from '../src/polling';

class ServicioAsincrono {
  private estado: string = 'iniciando';

  iniciar(): void {
    setTimeout(() =&gt; {
      this.estado = 'listo';
    }, 300);
  }

  getEstado(): string {
    return this.estado;
  }
}

describe('Polling - Esperar Condiciones', () =&gt; {
  it('debe esperar hasta que servicio esté listo', async () =&gt; {
    const servicio = new ServicioAsincrono();
    servicio.iniciar();

    wait polling(() =&gt; servicio.getEstado() === 'listo', 50, 5000);

    expect(servicio.getEstado()).to.equal('listo');
  });

  it('debe timeout si condición no se cumple', async () =&gt; {
    const servicio = new ServicioAsincrono();
    // No llama iniciar(), nunca llegará a 'listo'

    try {
      wait polling(() =&gt; servicio.getEstado() === 'listo', 50, 500);
      throw new Error('Debería haber hecho timeout');
    } catch (err) {
      expect(err.message).to.include('timeout');
    }
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_retry_reintentar_operaciones"><a class="link" href="#_retry_reintentar_operaciones">Retry: Reintentar Operaciones</a></h4>
<div class="paragraph">
<p>A veces operaciones fallan temporalmente y deben reintentarse.</p>
</div>
<div class="listingblock">
<div class="title">Función retry:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// src/retry.ts
export async function retry&lt;T&gt;(
  fn: () =&gt; Promise&lt;T&gt;,
  maxIntentos: number = 3,
  intervalo: number = 100
): Promise&lt;T&gt; {
  let ultimoError: Error | null = null;

  for (let intento = 1; intento &lt;= maxIntentos; intento++) {
    try {
      return await fn();
    } catch (err) {
      ultimoError = err;

      if (intento &lt; maxIntentos) {
        // Esperar antes de reintentar (backoff exponencial opcional)
        await new Promise(resolve =&gt; setTimeout(resolve, intervalo * intento));
      }
    }
  }

  throw ultimoError || new Error('Retry falló');
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import { retry } from '../src/retry';

class ServicioInestable {
  private llamadas: number = 0;

  async operacion(): Promise&lt;string&gt; {
    this.llamadas++;

    if (this.llamadas &lt; 3) {
      throw new Error('Fallo temporal');
    }

    return 'Éxito';
  }
}

describe('Retry - Reintentos', () =&gt; {
  it('debe reintentar hasta obtener éxito', async () =&gt; {
    const servicio = new ServicioInestable();

    const resultado = await retry(
      () =&gt; servicio.operacion(),
      5,
      50
    );

    expect(resultado).to.equal('Éxito');
    expect(servicio.llamadas).to.equal(3);
  });

  it('debe fallar si máximo intentos se agota', async () =&gt; {
    const servicio = new ServicioInestable();

    try {
      await retry(
        () =&gt; servicio.operacion(),
        2,  // Solo 2 intentos, necesita 3
        50
      );
      throw new Error('Debería haber fallado');
    } catch (err) {
      expect(err.message).to.include('Fallo temporal');
    }
  });

  it('debe usar backoff exponencial', async () =&gt; {
    let tiempos: number[] = [];
    let ultimoTiempo = Date.now();

    const servicio = new ServicioInestable();

    const resultado = await retry(
      async () =&gt; {
        const ahora = Date.now();
        tiempos.push(ahora - ultimoTiempo);
        ultimoTiempo = ahora;
        return servicio.operacion();
      },
      5,
      50
    );

    // Segundo intento debería tener delay, tercero mayor delay
    expect(tiempos[1]).to.be.greaterThan(50);
    expect(tiempos[2]).to.be.greaterThan(100);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_timeout_personalizado"><a class="link" href="#_timeout_personalizado">Timeout Personalizado</a></h4>
<div class="paragraph">
<p>Control fino del timeout en operaciones asincrónicas.</p>
</div>
<div class="listingblock">
<div class="title">Función timeout:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// src/timeout.ts
export function conTimeout&lt;T&gt;(
  promise: Promise&lt;T&gt;,
  tiempoMs: number
): Promise&lt;T&gt; {
  return Promise.race([
    promise,
    new Promise&lt;T&gt;((_, reject) =&gt;
      setTimeout(
        () =&gt; reject(new Error(`Operación timeout después de ${tiempoMs}ms`)),
        tiempoMs
      )
    )
  ]);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import { conTimeout } from '../src/timeout';

function operacionLenta(duracion: number): Promise&lt;string&gt; {
  return new Promise(resolve =&gt; {
    setTimeout(() =&gt; resolve('Completado'), duracion);
  });
}

describe('Timeout - Control de Tiempo', () =&gt; {
  it('debe completarse antes del timeout', async () =&gt; {
    const resultado = await conTimeout(
      operacionLenta(100),
      1000  // 1 segundo de timeout
    );

    expect(resultado).to.equal('Completado');
  });

  it('debe fallar si excede timeout', async () =&gt; {
    try {
      await conTimeout(
        operacionLenta(1000),
        100  // 100ms timeout
      );
      throw new Error('Debería haber hecho timeout');
    } catch (err) {
      expect(err.message).to.include('timeout');
    }
  });

  it('puede usar en tests con this.timeout()', function(done) {
    this.timeout(5000);

    conTimeout(operacionLenta(200), 3000)
      .then(resultado =&gt; {
        expect(resultado).to.equal('Completado');
        done();
      })
      .catch(done);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_integrado_pipeline_asincrónico"><a class="link" href="#_ejemplo_integrado_pipeline_asincrónico">Ejemplo Integrado: Pipeline Asincrónico</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// src/pipeline.ts
export class PipelineAsincrónico {
  async descargarDatos(url: string): Promise&lt;any&gt; {
    return new Promise((resolve) =&gt; {
      setTimeout(() =&gt; {
        resolve({ id: 1, datos: [1, 2, 3] });
      }, 100);
    });
  }

  async procesar(datos: any): Promise&lt;any&gt; {
    return new Promise((resolve) =&gt; {
      setTimeout(() =&gt; {
        resolve({ suma: datos.datos.reduce((a: number, b: number) =&gt; a + b, 0) });
      }, 100);
    });
  }

  async guardar(resultado: any): Promise&lt;boolean&gt; {
    return new Promise((resolve) =&gt; {
      setTimeout(() =&gt; {
        resolve(true);
      }, 100);
    });
  }

  async ejecutar(url: string): Promise&lt;boolean&gt; {
    const datos = await this.descargarDatos(url);
    const resultado = await this.procesar(datos);
    return await this.guardar(resultado);
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import { PipelineAsincrónico } from '../src/pipeline';
import { retry } from '../src/retry';
import { conTimeout } from '../src/timeout';

describe('Pipeline Asincrónico - Integración', () =&gt; {
  let pipeline: PipelineAsincrónico;

  beforeEach(() =&gt; {
    pipeline = new PipelineAsincrónico();
  });

  it('debe ejecutar pipeline completo', async () =&gt; {
    const resultado = await pipeline.ejecutar('http://api.example.com/datos');
    expect(resultado).to.be.true;
  });

  it('debe ejecutar pipeline con timeout', async () =&gt; {
    const resultado = await conTimeout(
      pipeline.ejecutar('http://api.example.com/datos'),
      5000
    );
    expect(resultado).to.be.true;
  });

  it('debe reintentar si falla temporalmente', async () =&gt; {
    let intentos = 0;

    const resultado = await retry(
      async () =&gt; {
        intentos++;
        if (intentos &lt; 2) throw new Error('Fallo temporal');
        return pipeline.ejecutar('http://api.example.com/datos');
      },
      3,
      50
    );

    expect(resultado).to.be.true;
    expect(intentos).to.equal(2);
  });
});</code></pre>
</div>
</div>
<hr>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_módulo_8_fixtures_y_setup"><a class="link" href="#_módulo_8_fixtures_y_setup">Módulo 8: Fixtures y Setup</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>En tests reales, a menudo necesitas datos de prueba consistentes. Las fixtures son conjuntos de datos predefinidos que preparan el estado inicial para cada test. Este módulo cubre estrategias para preparar datos, mockear bases de datos y simular APIs.</p>
</div>
<div class="sect2">
<h3 id="_8_1_preparación_de_datos"><a class="link" href="#_8_1_preparación_de_datos">8.1 Preparación de Datos</a></h3>
<div class="sect3">
<h4 id="_qué_son_las_fixtures"><a class="link" href="#_qué_son_las_fixtures">¿Qué son las Fixtures?</a></h4>
<div class="paragraph">
<p>Las fixtures son datos conocidos y predefinidos que se usan como punto de partida para tests. Evitan perder tiempo creando datos en cada test.</p>
</div>
<div class="listingblock">
<div class="title">Problema sin fixtures:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

class RepositorioUsuarios {
  private usuarios: any[] = [];

  agregar(usuario: any): number {
    usuario.id = this.usuarios.length + 1;
    this.usuarios.push(usuario);
    return usuario.id;
  }

  obtener(id: number): any {
    eturn this.usuarios.find(u =&gt; u.id === id);
  }
}

describe('RepositorioUsuarios - Sin Fixtures', () =&gt; {
  let repo: RepositorioUsuarios;

  beforeEach(() =&gt; {
    repo = new RepositorioUsuarios();
  });

  it('test 1: debe agregar usuario', () =&gt; {
    // Repetir esto en cada test es tedioso
    const id = repo.agregar({ nombre: 'Juan', email: 'juan@example.com', edad: 30 });
    expect(id).to.equal(1);
  });

  it('test 2: debe obtener usuario', () =&gt; {
    const id = repo.agregar({ nombre: 'Juan', email: 'juan@example.com', edad: 30 });
    const usuario = repo.obtener(id);
    expect(usuario.nombre).to.equal('Juan');
  });

  it('test 3: debe retornar undefined si no existe', () =&gt; {
    const usuario = repo.obtener(999);
    expect(usuario).to.be.undefined;
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fixtures_estáticas"><a class="link" href="#_fixtures_estáticas">Fixtures Estáticas</a></h4>
<div class="paragraph">
<p>Fixtures son datos predefinidos que se reutilizan.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

class RepositorioUsuarios {
  private usuarios: any[] = [];

  agregar(usuario: any): number {
    usuario.id = (this.usuarios.length || 0) + 1;
    this.usuarios.push(usuario);
    return usuario.id;
  }

  obtener(id: number): any {
    eturn this.usuarios.find(u =&gt; u.id === id);
  }

  obtenerTodos(): any[] {
    return [...this.usuarios];
  }
}

// Fixtures - Datos predefinidos
const fictura_usuarios = {
  juan: { nombre: 'Juan', email: 'juan@example.com', edad: 30 },
  ana: { nombre: 'Ana', email: 'ana@example.com', edad: 28 },
  carlos: { nombre: 'Carlos', email: 'carlos@example.com', edad: 35 }
};

const fixture_productos = {
  laptop: { nombre: 'Laptop', precio: 1000, stock: 5 },
  mouse: { nombre: 'Mouse', precio: 25, stock: 100 },
  teclado: { nombre: 'Teclado', precio: 75, stock: 50 }
};

describe('RepositorioUsuarios - Con Fixtures', () =&gt; {
  let repo: RepositorioUsuarios;

  beforeEach(() =&gt; {
    repo = new RepositorioUsuarios();
    // Preparar fixtures
    repo.agregar(fictura_usuarios.juan);
    repo.agregar(fictura_usuarios.ana);
    repo.agregar(fictura_usuarios.carlos);
  });

  it('debe obtener usuario Juan', () =&gt; {
    const usuario = repo.obtener(1);
    expect(usuario.nombre).to.equal('Juan');
  });

  it('debe obtener usuario Ana', () =&gt; {
    const usuario = repo.obtener(2);
    expect(usuario.nombre).to.equal('Ana');
  });

  it('debe tener 3 usuarios en total', () =&gt; {
    const todos = repo.obtenerTodos();
    expect(todos).to.have.lengthOf(3);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_factories_generadores_de_objetos"><a class="link" href="#_factories_generadores_de_objetos">Factories: Generadores de Objetos</a></h4>
<div class="paragraph">
<p>Las factories crean objetos de prueba con valores por defecto.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

interface Usuario {
  id?: number;
  nombre: string;
  email: string;
  edad: number;
  activo: boolean;
}

// Factory para crear usuarios
class UsuarioFactory {
  static crear(overrides?: Partial&lt;Usuario&gt;): Usuario {
    const usuario: Usuario = {
      nombre: 'Usuario Genérico',
      email: 'usuario@example.com',
      edad: 25,
      activo: true
    };

    return { ...usuario, ...overrides };
  }

  static crearLotes(cantidad: number, overrides?: Partial&lt;Usuario&gt;): Usuario[] {
    const usuarios: Usuario[] = [];
    for (let i = 0; i &lt; cantidad; i++) {
      usuarios.push(
        this.crear({
          ...overrides,
          nombre: overrides?.nombre || `Usuario ${i + 1}`,
          email: overrides?.email || `usuario${i + 1}@example.com`
        })
      );
    }
    return usuarios;
  }
}

describe('UsuarioFactory - Generadores', () =&gt; {
  it('debe crear usuario con defaults', () =&gt; {
    const usuario = UsuarioFactory.crear();

    expect(usuario.nombre).to.equal('Usuario Genérico');
    expect(usuario.edad).to.equal(25);
    expect(usuario.activo).to.be.true;
  });

  it('debe crear usuario con overrides', () =&gt; {
    const usuario = UsuarioFactory.crear({
      nombre: 'Juan',
      edad: 30
    });

    expect(usuario.nombre).to.equal('Juan');
    expect(usuario.edad).to.equal(30);
    expect(usuario.email).to.equal('usuario@example.com'); // Default
  });

  it('debe crear múltiples usuarios', () =&gt; {
    const usuarios = UsuarioFactory.crearLotes(5);

    expect(usuarios).to.have.lengthOf(5);
    expect(usuarios[0].nombre).to.equal('Usuario 1');
    expect(usuarios[4].nombre).to.equal('Usuario 5');
  });

  it('debe crear lotes con overrides personalizados', () =&gt; {
    const usuarios = UsuarioFactory.crearLotes(3, { edad: 40 });

    expect(usuarios).to.have.lengthOf(3);
    usuarios.forEach(u =&gt; {
      expect(u.edad).to.equal(40);
    });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_builders_construcción_fluida"><a class="link" href="#_builders_construcción_fluida">Builders: Construcción Fluida</a></h4>
<div class="paragraph">
<p>Los builders permiten construir objetos complejos paso a paso.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

interface Carrito {
  id: string;
  usuario: string;
  items: Array&lt;{ productoId: number; cantidad: number; precio: number }&gt;;
  descuento: number;
  estado: 'abierto' | 'procesando' | 'completado';
}

// Builder fluido para Carrito
class CarritoBuilder {
  private carrito: Carrito = {
    id: `carrito_${Date.now()}`,
    usuario: 'usuario_genérico',
    items: [],
    descuento: 0,
    estado: 'abierto'
  };

  conUsuario(usuario: string): CarritoBuilder {
    this.carrito.usuario = usuario;
    return this;
  }

  agregarItem(productoId: number, cantidad: number, precio: number): CarritoBuilder {
    this.carrito.items.push({ productoId, cantidad, precio });
    return this;
  }

  conDescuento(descuento: number): CarritoBuilder {
    this.carrito.descuento = descuento;
    return this;
  }

  enEstado(estado: Carrito['estado']): CarritoBuilder {
    this.carrito.estado = estado;
    return this;
  }

  construir(): Carrito {
    return { ...this.carrito };
  }
}

describe('CarritoBuilder - Construcción Fluida', () =&gt; {
  it('debe construir carrito complejo con fluent API', () =&gt; {
    const carrito = new CarritoBuilder()
      .conUsuario('juan@example.com')
      .agregarItem(1, 2, 99.99)  // Laptop x2
      .agregarItem(2, 1, 25.00)  // Mouse x1
      .conDescuento(10)           // 10% descuento
      .enEstado('procesando')
      .construir();

    expect(carrito.usuario).to.equal('juan@example.com');
    expect(carrito.items).to.have.lengthOf(2);
    expect(carrito.descuento).to.equal(10);
    expect(carrito.estado).to.equal('procesando');
  });

  it('debe construir carritos diferentes independientemente', () =&gt; {
    const carrito1 = new CarritoBuilder()
      .conUsuario('juan@example.com')
      .agregarItem(1, 1, 100)
      .construir();

    const carrito2 = new CarritoBuilder()
      .conUsuario('ana@example.com')
      .agregarItem(2, 2, 50)
      .agregarItem(3, 1, 75)
      .construir();

    expect(carrito1.usuario).to.equal('juan@example.com');
    expect(carrito1.items).to.have.lengthOf(1);

    expect(carrito2.usuario).to.equal('ana@example.com');
    expect(carrito2.items).to.have.lengthOf(2);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_reset_de_estado"><a class="link" href="#_reset_de_estado">Reset de Estado</a></h4>
<div class="paragraph">
<p>Limpiar completamente el estado entre tests.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

class BaseDatos {
  private datos: Map&lt;string, any[]&gt; = new Map();

  insert(tabla: string, registro: any): void {
    if (!this.datos.has(tabla)) {
      this.datos.set(tabla, []);
    }
    this.datos.get(tabla)!.push(registro);
  }

  select(tabla: string): any[] {
    return this.datos.get(tabla) || [];
  }

  count(tabla: string): number {
    return (this.datos.get(tabla) || []).length;
  }

  // Limpiar base de datos
  reset(): void {
    this.datos.clear();
  }
}

describe('BaseDatos - Reset de Estado', () =&gt; {
  let db: BaseDatos;

  beforeEach(() =&gt; {
    db = new BaseDatos();
  });

  afterEach(() =&gt; {
    // Limpiar completamente
    db.reset();
  });

  it('debe insertar registro', () =&gt; {
    db.insert('usuarios', { id: 1, nombre: 'Juan' });
    expect(db.count('usuarios')).to.equal(1);
  });

  it('debe empezar limpio gracias a reset', () =&gt; {
    // Los datos del test anterior se limpiaron
    expect(db.count('usuarios')).to.equal(0);

    db.insert('usuarios', { id: 1, nombre: 'Ana' });
    expect(db.count('usuarios')).to.equal(1);
  });

  it('debe manejar múltiples tablas', () =&gt; {
    db.insert('usuarios', { id: 1 });
    db.insert('productos', { id: 1 });

    expect(db.count('usuarios')).to.equal(1);
    expect(db.count('productos')).to.equal(1);
  });
});</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_8_2_database_mocking"><a class="link" href="#_8_2_database_mocking">8.2 Database Mocking</a></h3>
<div class="sect3">
<h4 id="_mockear_conexiones_de_base_de_datos"><a class="link" href="#_mockear_conexiones_de_base_de_datos">Mockear Conexiones de Base de Datos</a></h4>
<div class="paragraph">
<p>No debería ejecutarse contra BD real en tests. Usar stubs de Sinon.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import sinon from 'sinon';
import { expect } from 'chai';

class ConexionBD {
  conectar(): Promise&lt;void&gt; {
    throw new Error('No debería conectarse en test');
  }
}

class RepositorioProductos {
  constructor(private conexion: ConexionBD) {}

  async obtener(id: number): Promise&lt;any&gt; {
    await this.conexion.conectar();
    // Ejecutaría query en BD real
    return { id, nombre: 'Laptop' };
  }
}

describe('RepositorioProductos - BD Mocking', () =&gt; {
  let conexion: ConexionBD;
  let repo: RepositorioProductos;
  let stub: sinon.SinonStub;

  beforeEach(() =&gt; {
    conexion = new ConexionBD();
    repo = new RepositorioProductos(conexion);
  });

  afterEach(() =&gt; {
    if (stub) stub.restore();
  });

  it('debe obtener producto sin conectar a BD real', async () =&gt; {
    // Stub la conexión
    stub = sinon.stub(conexion, 'conectar').resolves();

    const producto = await repo.obtener(1);

    expect(producto.nombre).to.equal('Laptop');
    expect(stub.called).to.be.true;
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_database_en_memoria"><a class="link" href="#_database_en_memoria">Database en Memoria</a></h4>
<div class="paragraph">
<p>Usar una base de datos en memoria para tests rápidos.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo con Map simple:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

// BD en memoria
class RepositorioEnMemoria&lt;T extends { id: number }&gt; {
  private datos = new Map&lt;number, T&gt;();
  private proximoId = 1;

  guardar(item: Omit&lt;T, 'id'&gt;): T {
    const id = this.proximoId++;
    const conId = { ...item, id } as T;
    this.datos.set(id, conId);
    return conId;
  }

  obtener(id: number): T | undefined {
    return this.datos.get(id);
  }

  obtenerTodos(): T[] {
    return Array.from(this.datos.values());
  }

  actualizar(id: number, actualizaciones: Partial&lt;T&gt;): T {
    const item = this.datos.get(id);
    if (!item) throw new Error('No encontrado');

    const actualizado = { ...item, ...actualizaciones } as T;
    this.datos.set(id, actualizado);
    return actualizado;
  }

  eliminar(id: number): boolean {
    return this.datos.delete(id);
  }

  limpiar(): void {
    this.datos.clear();
    this.proximoId = 1;
  }
}

interface Usuario {
  id: number;
  nombre: string;
  email: string;
}

describe('RepositorioEnMemoria - CRUD', () =&gt; {
  let repo: RepositorioEnMemoria&lt;Usuario&gt;;

  beforeEach(() =&gt; {
    repo = new RepositorioEnMemoria&lt;Usuario&gt;();
  });

  it('debe guardar y obtener usuario', () =&gt; {
    const usuario = repo.guardar({ nombre: 'Juan', email: 'juan@example.com' });

    expect(usuario.id).to.equal(1);
    expect(usuario.nombre).to.equal('Juan');

    const obtenido = repo.obtener(1);
    expect(obtenido).to.deep.equal(usuario);
  });

  it('debe incrementar IDs automáticamente', () =&gt; {
    const u1 = repo.guardar({ nombre: 'Juan', email: 'juan@example.com' });
    const u2 = repo.guardar({ nombre: 'Ana', email: 'ana@example.com' });
    const u3 = repo.guardar({ nombre: 'Carlos', email: 'carlos@example.com' });

    expect(u1.id).to.equal(1);
    expect(u2.id).to.equal(2);
    expect(u3.id).to.equal(3);
  });

  it('debe actualizar usuario', () =&gt; {
    repo.guardar({ nombre: 'Juan', email: 'juan@example.com' });

    const actualizado = repo.actualizar(1, { nombre: 'Juan Updated' });

    expect(actualizado.nombre).to.equal('Juan Updated');
    expect(actualizado.id).to.equal(1); // ID no cambia
  });

  it('debe eliminar usuario', () =&gt; {
    repo.guardar({ nombre: 'Juan', email: 'juan@example.com' });
    expect(repo.obtenerTodos()).to.have.lengthOf(1);

    const eliminado = repo.eliminar(1);

    expect(eliminado).to.be.true;
    expect(repo.obtenerTodos()).to.have.lengthOf(0);
  });

  it('debe limpiar completamente', () =&gt; {
    repo.guardar({ nombre: 'Juan', email: 'juan@example.com' });
    repo.guardar({ nombre: 'Ana', email: 'ana@example.com' });

    expect(repo.obtenerTodos()).to.have.lengthOf(2);

    repo.limpiar();

    expect(repo.obtenerTodos()).to.have.lengthOf(0);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_transacciones_en_tests"><a class="link" href="#_transacciones_en_tests">Transacciones en Tests</a></h4>
<div class="paragraph">
<p>Simular comportamiento transaccional.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

class TransaccionBD {
  private datos: any[] = [];
  private snapshot: any[] = [];

  iniciar(): void {
    // Hacer snapshot del estado actual
    this.snapshot = JSON.parse(JSON.stringify(this.datos));
  }

  commit(): void {
    // Cambios persisten, limpiar snapshot
    this.snapshot = [];
  }

  rollback(): void {
    // Restaurar snapshot
    this.datos = JSON.parse(JSON.stringify(this.snapshot));
    this.snapshot = [];
  }

  insert(registro: any): void {
    this.datos.push(registro);
  }

  select(): any[] {
    return this.datos;
  }
}

describe('TransaccionBD - Rollback', () =&gt; {
  let txn: TransaccionBD;

  beforeEach(() =&gt; {
    txn = new TransaccionBD();
    txn.insert({ id: 1, valor: 100 });
  });

  it('debe commit cambios', () =&gt; {
    txn.iniciar();
    txn.insert({ id: 2, valor: 200 });

    expect(txn.select()).to.have.lengthOf(2);

    txn.commit();

    expect(txn.select()).to.have.lengthOf(2);
  });

  it('debe rollback cambios fallidos', () =&gt; {
    txn.iniciar();
    txn.insert({ id: 2, valor: 200 });
    txn.insert({ id: 3, valor: 300 });

    expect(txn.select()).to.have.lengthOf(3);

    txn.rollback();

    expect(txn.select()).to.have.lengthOf(1);
  });
});</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_8_3_api_mocking"><a class="link" href="#_8_3_api_mocking">8.3 API Mocking</a></h3>
<div class="sect3">
<h4 id="_http_mocking_con_nock"><a class="link" href="#_http_mocking_con_nock">HTTP Mocking con Nock</a></h4>
<div class="paragraph">
<p>Nock permite mockear requests HTTP sin hacer llamadas reales.</p>
</div>
<div class="listingblock">
<div class="title">Instalación:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install --save-dev nock
npm install --save-dev @types/nock</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import nock from 'nock';
import { expect } from 'chai';

class ClienteAPI {
  async obtenerUsuario(id: number): Promise&lt;any&gt; {
    const respuesta = await fetch(`https://api.example.com/usuarios/${id}`);
    if (!respuesta.ok) throw new Error('No encontrado');
    return respuesta.json();
  }

  async crearUsuario(datos: any): Promise&lt;any&gt; {
    const respuesta = await fetch('https://api.example.com/usuarios', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(datos)
    });
    return respuesta.json();
  }
}

describe('ClienteAPI - Nock HTTP Mocking', () =&gt; {
  afterEach(() =&gt; {
    nock.cleanAll();
  });

  it('debe mockear GET request', async () =&gt; {
    // Preparar mock
    nock('https://api.example.com')
      .get('/usuarios/1')
      .reply(200, { id: 1, nombre: 'Juan' });

    const cliente = new ClienteAPI();
    const usuario = await cliente.obtenerUsuario(1);

    expect(usuario.nombre).to.equal('Juan');
  });

  it('debe mockear POST request', async () =&gt; {
    nock('https://api.example.com')
      .post('/usuarios', { nombre: 'Ana', email: 'ana@example.com' })
      .reply(201, { id: 2, nombre: 'Ana', email: 'ana@example.com' });

    const cliente = new ClienteAPI();
    const usuario = await cliente.crearUsuario({
      nombre: 'Ana',
      email: 'ana@example.com'
    });

    expect(usuario.id).to.equal(2);
  });

  it('debe mockear error 404', async () =&gt; {
    nock('https://api.example.com')
      .get('/usuarios/999')
      .reply(404, { error: 'No encontrado' });

    const cliente = new ClienteAPI();

    try {
      await cliente.obtenerUsuario(999);
      throw new Error('Debería haber fallado');
    } catch (err) {
      expect(err.message).to.include('No encontrado');
    }
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fixture_files_datos_en_archivos"><a class="link" href="#_fixture_files_datos_en_archivos">Fixture Files (Datos en Archivos)</a></h4>
<div class="paragraph">
<p>Separar datos de prueba en archivos JSON.</p>
</div>
<div class="listingblock">
<div class="title">Estructura:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">tests/
  fixtures/
    usuario-valido.json
    usuario-invalido.json
    productos.json
  mocks/
    api.test.ts</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fixtures/usuario-valido.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "id": 1,
  "nombre": "Juan",
  "email": "juan@example.com",
  "activo": true
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">fixtures/productos.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  { "id": 1, "nombre": "Laptop", "precio": 1000 },
  { "id": 2, "nombre": "Mouse", "precio": 25 },
  { "id": 3, "nombre": "Teclado", "precio": 75 }
]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Uso en tests:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import * as fs from 'fs';
import * as path from 'path';
import { expect } from 'chai';

// Helper para cargar fixtures
function cargarFixture(nombre: string): any {
  const ruta = path.join(__dirname, 'fixtures', `${nombre}.json`);
  const contenido = fs.readFileSync(ruta, 'utf-8');
  return JSON.parse(contenido);
}

describe('API - Fixtures desde Archivos', () =&gt; {
  it('debe validar usuario desde fixture', () =&gt; {
    const usuario = cargarFixture('usuario-valido');

    expect(usuario.id).to.equal(1);
    expect(usuario.nombre).to.equal('Juan');
    expect(usuario.activo).to.be.true;
  });

  it('debe cargar múltiples productos', () =&gt; {
    const productos = cargarFixture('productos');

    expect(productos).to.have.lengthOf(3);
    expect(productos[0].nombre).to.equal('Laptop');
    expect(productos[1].precio).to.equal(25);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_stub_de_librerías_http"><a class="link" href="#_stub_de_librerías_http">Stub de Librerías HTTP</a></h4>
<div class="paragraph">
<p>Usar Sinon para stubear librerías HTTP sin Nock.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import sinon from 'sinon';
import { expect } from 'chai';
import axios from 'axios'; // Supongamos que usamos axios

class ServicioProductos {
  async obtenerProducto(id: number): Promise&lt;any&gt; {
    const respuesta = await axios.get(`/api/productos/${id}`);
    return respuesta.data;
  }
}

describe('ServicioProductos - Stub de Axios', () =&gt; {
  let stub: sinon.SinonStub;

  afterEach(() =&gt; {
    if (stub) stub.restore();
  });

  it('debe obtener producto mediante axios stub', async () =&gt; {
    stub = sinon.stub(axios, 'get').resolves({
      data: { id: 1, nombre: 'Laptop', precio: 1000 }
    });

    const servicio = new ServicioProductos();
    const producto = await servicio.obtenerProducto(1);

    expect(producto.nombre).to.equal('Laptop');
    expect(stub.calledWith('/api/productos/1')).to.be.true;
  });

  it('debe manejar error de axios', async () =&gt; {
    const error = new Error('Conexión rechazada');
    stub = sinon.stub(axios, 'get').rejects(error);

    const servicio = new ServicioProductos();

    try {
      await servicio.obtenerProducto(999);
      throw new Error('Debería haber fallado');
    } catch (err) {
      expect(err.message).to.equal('Conexión rechazada');
    }
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_integrado_e_commerce"><a class="link" href="#_ejemplo_integrado_e_commerce">Ejemplo Integrado: E-commerce</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// src/ecommerce.ts
export class ServicioEcommerce {
  constructor(
    private repositorioProductos: any,
    private clienteAPI: any
  ) {}

  async procesarCompra(usuarioId: number, productoIds: number[]): Promise&lt;any&gt; {
    // Obtener usuario de API
    const usuario = await this.clienteAPI.obtenerUsuario(usuarioId);

    // Obtener productos del repositorio
    const productos = await Promise.all(
      productoIds.map(id =&gt; this.repositorioProductos.obtener(id))
    );

    // Calcular total
    const total = productos.reduce((s: number, p: any) =&gt; s + p.precio, 0);

    return {
      usuario: usuario.nombre,
      productos: productos.length,
      total
    };
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests completos:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import sinon from 'sinon';
import nock from 'nock';
import { expect } from 'chai';
import { ServicioEcommerce } from '../src/ecommerce';

describe('ServicioEcommerce - Integración Fixtures', () =&gt; {
  let servicio: ServicioEcommerce;
  let repositorio: any;
  let clienteAPI: any;

  beforeEach(() =&gt; {
    // Repositorio en memoria
    repositorio = {
      obtener: async (id: number) =&gt; {
        const productos: any = {
          1: { id: 1, nombre: 'Laptop', precio: 1000 },
          2: { id: 2, nombre: 'Mouse', precio: 25 },
          3: { id: 3, nombre: 'Teclado', precio: 75 }
        };
        return productos[id];
      }
    };

    // Mock de API HTTP
    clienteAPI = {
      obtenerUsuario: async (id: number) =&gt; {
        return { id, nombre: 'Juan' };
      }
    };

    servicio = new ServicioEcommerce(repositorio, clienteAPI);
  });

  afterEach(() =&gt; {
    nock.cleanAll();
  });

  it('debe procesar compra completa', async () =&gt; {
    const result = await servicio.procesarCompra(1, [1, 2]);

    expect(result.usuario).to.equal('Juan');
    expect(result.productos).to.equal(2);
    expect(result.total).to.equal(1025);
  });

  it('debe manejar múltiples compras', async () =&gt; {
    const compra1 = await servicio.procesarCompra(1, [1]);
    const compra2 = await servicio.procesarCompra(2, [2, 3]);

    expect(compra1.total).to.equal(1000);
    expect(compra2.total).to.equal(100);
  });
});</code></pre>
</div>
</div>
<hr>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_módulo_9_reporters_y_salida"><a class="link" href="#_módulo_9_reporters_y_salida">Módulo 9: Reporters y Salida</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Los reporters en Mocha controlan cómo se muestran los resultados de los tests. Desde output simple en terminal hasta reportes JSON complejos. Este módulo explora los reporters nativos, cómo crear personalizados y configurar la salida.</p>
</div>
<div class="sect2">
<h3 id="_9_1_reporters_nativos"><a class="link" href="#_9_1_reporters_nativos">9.1 Reporters Nativos</a></h3>
<div class="paragraph">
<p>Mocha incluye varios reporters listos para usar.</p>
</div>
<div class="sect3">
<h4 id="_elegir_un_reporter"><a class="link" href="#_elegir_un_reporter">Elegir un Reporter</a></h4>
<div class="listingblock">
<div class="title">Sintaxis:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mocha --reporter &lt;nombre&gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Reporters disponibles:</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Reporter</th>
<th class="tableblock halign-left valign-top">Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spec</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Formato jerárquico detallado (por defecto)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dot</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Puntos verdes/rojos, muy compacto</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test Anything Protocol para herramientas CI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>json</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON puro para procesamiento</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>json-stream</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON línea por línea</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nyan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ASCII art (lúdico)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>markdown</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output en formato Markdown</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mínimo, solo resumen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>l=anding</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Animación de "landing"</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_spec_reporter_por_defecto"><a class="link" href="#_spec_reporter_por_defecto">Spec Reporter (Por Defecto)</a></h4>
<div class="paragraph">
<p>Es el más legible. Muestra estructura jerárquica con checkmarks y cross marks.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de output:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">  Calculadora
    ✓ debe sumar dos números
    ✓ debe restar dos números
    ✓ debe multiplicar dos números
    ✗ debe dividir por cero correctamente

  4 passing (15ms)
  1 failing</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejecutar con spec reporter:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mocha --reporter spec
npx mocha tests/**/*.test.ts --require ts-node/register --reporter spec</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dot_reporter"><a class="link" href="#_dot_reporter">Dot Reporter</a></h4>
<div class="paragraph">
<p>Muy compacto. Un punto por test: verde si pasa, rojo si falla.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de output:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">  .....✖.

  8 passing
  1 failing</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejecutar:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mocha --reporter dot</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_json_reporter"><a class="link" href="#_json_reporter">JSON Reporter</a></h4>
<div class="paragraph">
<p>Perfecto para procesamiento automático y herramientas CI/CD.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mocha --reporter json &gt; results.json</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Contenido de results.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "stats": {
    "tests": 9,
    "passes": 8,
    "failures": 1,
    "pending": 0,
    "skipped": 0,
    "duration": 15
  },
  "tests": [
    {
      "title": "debe sumar dos números",
      "fullTitle": "Calculadora debe sumar dos números",
      "state": "passed",
      "duration": 2
    },
    {
      "title": "debe multiplicar por cero",
      "fullTitle": "Calculadora debe multiplicar por cero",
      "state": "failed",
      "duration": 5,
      "err": {
        "message": "expected 0 to equal 1"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Procesar JSON en terminal:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mocha --reporter json | jq '.stats'
mocha --reporter json | jq '.tests[] | select(.state == "failed")'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tap_reporter"><a class="link" href="#_tap_reporter">TAP Reporter</a></h4>
<div class="paragraph">
<p>TAP (Test Anything Protocol) para herramientas CI estándar.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de output:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">1..9
ok 1 - Calculadora debe sumar dos números
ok 2 - Calculadora debe restar dos números
ok 3 - Calculadora debe multiplicar dos números
not ok 4 - Calculadora debe dividir correctamente
  ---
  message: expected 0 to equal 1
  ...
ok 5 - Calculadora debe obtener raíz cuadrada</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejecutar:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mocha --reporter tap &gt; results.tap</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_markdown_reporter"><a class="link" href="#_markdown_reporter">Markdown Reporter</a></h4>
<div class="paragraph">
<p>Genera output en formato Markdown.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mocha --reporter markdown &gt; results.md</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Contenido generado:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-markdown hljs" data-lang="markdown"># Mocha Tests

## Passing

- ✓ Calculadora debe sumar dos números
- ✓ Calculadora debe restar dos números
- ✓ Calculadora debe multiplicar dos números

## Failing

### 1) Calculadora debe dividir correctamente
  expected 0 to equal 1</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configurar_reporter_predeterminado"><a class="link" href="#_configurar_reporter_predeterminado">Configurar Reporter Predeterminado</a></h4>
<div class="listingblock">
<div class="title">En .mocharc.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "reporter": "spec",
  "require": ["ts-node/register"],
  "spec": "tests/**/*.test.ts"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">En .mocharc.js:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">module.exports = {
  reporter: 'dot',
  reporterOptions: {
    reportDir: './test-results'
  }
};</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_9_2_reporters_personalizados"><a class="link" href="#_9_2_reporters_personalizados">9.2 Reporters Personalizados</a></h3>
<div class="sect3">
<h4 id="_estructura_de_un_reporter_personalizado"><a class="link" href="#_estructura_de_un_reporter_personalizado">Estructura de un Reporter Personalizado</a></h4>
<div class="paragraph">
<p>Un reporter es una clase que extiende de EventEmitter y responde a eventos de Mocha.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Eventos principales:</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Evento</th>
<th class="tableblock halign-left valign-top">Se dispara cuando&#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>start</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comienzan todos los tests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>suite</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comienza un suite</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comienza un test</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pass</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un test pasó</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fail</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un test falló</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pending</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un test está pendiente</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>end</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finalizan todos los tests</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Ejemplo básico:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// reporters/miReporter.ts
import { EventEmitter } from 'events';

export class MiReporter extends EventEmitter {
  constructor(runner: any) {
    super();

    let testCount = 0;
    let passCount = 0;
    let failCount = 0;

    runner.on('test', () =&gt; {
      testCount++;
    });

    runner.on('pass', (test: any) =&gt; {
      passCount++;
      console.log(`✓ ${test.title}`);
    });

    runner.on('fail', (test: any, err: any) =&gt; {
      failCount++;
      console.log(`✗ ${test.title}: ${err.message}`);
    });

    runner.on('end', () =&gt; {
      console.log(`\n${passCount}/${testCount} tests pasaron`);
      if (failCount &gt; 0) {
        console.log(`${failCount} tests fallaron`);
      }
    });
  }
}

// Exportar como función (Mocha espera así)
module.exports = MiReporter;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Usar el reporter personalizado:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mocha --reporter ./reporters/miReporter.ts tests/**/*.test.ts</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_reporter_con_estadísticas_detalladas"><a class="link" href="#_reporter_con_estadísticas_detalladas">Reporter con Estadísticas Detalladas</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// reporters/estadisticasReporter.ts
import { EventEmitter } from 'events';
import * as chalk from 'chalk'; // npm install chalk

export class EstadisticasReporter extends EventEmitter {
  private tests: any[] = [];
  private passIds: number[] = [];
  private failIds: number[] = [];
  private estadisticasPorSuite: Map&lt;string, any&gt; = new Map();
  private suiteCurrent: string[] = [];

  constructor(runner: any) {
    super();

    runner.on('suite', (suite: any) =&gt; {
      if (suite.title) {
        this.suiteCurrent.push(suite.title);
      }
    });

    runner.on('suite end', (suite: any) =&gt; {
      if (suite.title) {
        this.suiteCurrent.pop();
      }
    });

    runner.on('test', (test: any) =&gt; {
      test.id = this.tests.length;
      this.tests.push(test);
    });

    runner.on('pass', (test: any) =&gt; {
      this.passIds.push(test.id);
      const suitePath = this.suiteCurrent.join(' &gt; ');
      console.log(chalk.green(`  ✓ ${test.title}`));
    });

    runner.on('fail', (test: any, err: any) =&gt; {
      this.failIds.push(test.id);
      const suitePath = this.suiteCurrent.join(' &gt; ');
      console.log(chalk.red(`  ✗ ${test.title}`));
      console.log(chalk.red(`    ${err.message}`));
    });

    runner.on('end', () =&gt; {
      const total = this.tests.length;
      const passed = this.passIds.length;
      const failed = this.failIds.length;
      const porcentaje = total &gt; 0 ? ((passed / total) * 100).toFixed(2) : 0;

      onsole.log('\n' + chalk.bold('=== RESUMEN DE ESTADÍSTICAS ==='));
      console.log(chalk.green(`Pasando: ${passed}`));
      console.log(chalk.red(`Fallando: ${failed}`));
      console.log(chalk.blue(`Total: ${total}`));
      console.log(chalk.yellow(`Tasa de éxito: ${porcentaje}%`));
    });
  }
}

module.exports = EstadisticasReporter;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_reporter_json_personalizado"><a class="link" href="#_reporter_json_personalizado">Reporter JSON Personalizado</a></h4>
<div class="paragraph">
<p>Generar JSON con formato personalizado.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// reporters/jsonPersonalizadoReporter.ts
import { EventEmitter } from 'events';
import * as fs from 'fs';

export class JSONPersonalizadoReporter extends EventEmitter {
  private resultados: any = {
    timestamp: new Date().toISOString(),
    suites: [],
    tests: [],
    statistics: {
      total: 0,
      passed: 0,
      failed: 0,
      pending: 0
    }
  };

  private suiteCurrent: string[] = [];

  constructor(runner: any, options?: any) {
    super();

    const outputFile = options?.reporterOptions?.outputFile || 'test-results.json';

    runner.on('test', (test: any) =&gt; {
      this.resultados.statistics.total++;
    });

    runner.on('pass', (test: any) =&gt; {
      this.resultados.statistics.passed++;
      this.resultados.tests.push({
        title: test.title,
        fullTitle: test.fullTitle(),
        state: 'passed',
        duration: test.duration
      });
    });

    runner.on('fail', (test: any, err: any) =&gt; {
      this.resultados.statistics.failed++;
      this.resultados.tests.push({
        title: test.title,
        fullTitle: test.fullTitle(),
        state: 'failed',
        duration: test.duration,
        error: {
          message: err.message,
          stack: err.stack
        }
      });
    });

    runner.on('pending', (test: any) =&gt; {
      this.resultados.statistics.pending++;
      this.resultados.tests.push({
        title: test.title,
        fullTitle: test.fullTitle(),
        state: 'pending'
      });
    });

    runner.on('end', () =&gt; {
      fs.writeFileSync(outputFile, JSON.stringify(this.resultados, null, 2));
      console.log(`\nResultados guardados en: ${outputFile}`);
    });
  }
}

module.exports = JSONPersonalizadoReporter;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Usar con opciones:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mocha --reporter ./reporters/jsonPersonalizadoReporter.ts \
  --reporter-options outputFile=resultados.json</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_reporter_html"><a class="link" href="#_reporter_html">Reporter HTML</a></h4>
<div class="paragraph">
<p>Generar reporte HTML visual.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// reporters/htmlReporter.ts
import { EventEmitter } from 'events';
import * as fs from 'fs';

export class HTMLReporter extends EventEmitter {
  private html = '';
  private tests: any[] = [];

  constructor(runner: any, options?: any) {
    super();

    const outputFile = options?.reporterOptions?.outputFile || 'test-report.html';

    runner.on('test', (test: any) =&gt; {
      test.id = this.tests.length;
      this.tests.push(test);
    });

    runner.on('pass', (test: any) =&gt; {
      this.tests[test.id].state = 'passed';
    });

    runner.on('fail', (test: any, err: any) =&gt; {
      this.tests[test.id].state = 'failed';
      this.tests[test.id].error = err.message;
    });

    runner.on('end', () =&gt; {
      const html = this.generarHTML();
      fs.writeFileSync(outputFile, html);
      console.log(`\nReporte HTML guardado en: ${outputFile}`);
    });
  }

  private generarHTML(): string {
    onst passed = this.tests.filter(t =&gt; t.state === 'passed').length;
    onst failed = this.tests.filter(t =&gt; t.state === 'failed').length;
    const total = this.tests.length;

    let testHTML = '';
    for (const test of this.tests) {
      onst icon = test.state === 'passed' ? '✓' : '✗';
      onst color = test.state === 'passed' ? 'green' : 'red';

      testHTML += `
        tr style="background-color: ${color === 'green' ? '#e8f5e9' : '#ffebee'}"&gt;
          &lt;td&gt;${icon}&lt;/td&gt;
          &lt;td&gt;${test.title}&lt;/td&gt;
          &lt;td&gt;${test.state}&lt;/td&gt;
          &lt;td&gt;${test.duration || 0}ms&lt;/td&gt;
          ${test.error ? `&lt;td&gt;&lt;code&gt;${test.error}&lt;/code&gt;&lt;/td&gt;` : '&lt;td&gt;—&lt;/td&gt;'}
        &lt;/tr&gt;
      `;
    }

    return `
      &lt;!DOCTYPE html&gt;
      &lt;html&gt;
        &lt;head&gt;
          &lt;title&gt;Mocha Test Report&lt;/title&gt;
          &lt;style&gt;
            body { font-family: Arial, sans-serif; margin: 20px; }
            .stats { display: flex; gap: 20px; margin-bottom: 20px; }
            .stat { padding: 10px 20px; border-radius: 5px; }
            .passed { background-color: #c8e6c9; }
            .failed { background-color: #ffcdd2; }
            .total { background-color: #bbdefb; }
            table { border-collapse: collapse; width: 100%; }
            th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
            th { background-color: #f5f5f5; font-weight: bold; }
          &lt;/style&gt;
        &lt;/head&gt;
        &lt;body&gt;
          &lt;h1&gt;Test Report&lt;/h1&gt;
          &lt;div class="stats"&gt;
            &lt;div class="stat passed"&gt;Pasando: &lt;strong&gt;${passed}&lt;/strong&gt;&lt;/div&gt;
            &lt;div class="stat failed"&gt;Fallando: &lt;strong&gt;${failed}&lt;/strong&gt;&lt;/div&gt;
            &lt;div class="stat total"&gt;Total: &lt;strong&gt;${total}&lt;/strong&gt;&lt;/div&gt;
          &lt;/div&gt;
          &lt;table&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th&gt;Estado&lt;/th&gt;
                &lt;th&gt;Test&lt;/th&gt;
                &lt;th&gt;Resultado&lt;/th&gt;
                &lt;th&gt;Duración&lt;/th&gt;
                &lt;th&gt;Detalles&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              ${testHTML}
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/body&gt;
      &lt;/html&gt;
    `;
  }
}

module.exports = HTMLReporter;</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_9_3_configuración_de_salida"><a class="link" href="#_9_3_configuración_de_salida">9.3 Configuración de Salida</a></h3>
<div class="sect3">
<h4 id="_colores_en_output"><a class="link" href="#_colores_en_output">Colores en Output</a></h4>
<div class="paragraph">
<p>Mocha detecta automáticamente si la terminal soporta colores. Puede forzarse:</p>
</div>
<div class="listingblock">
<div class="title">Con línea de comandos:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mocha --colors                    # Forzar colores
mocha --no-colors                 # Sin colores
mocha --reporter spec --colors    # Especificar reporter + colores</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">En .mocharc.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "reporter": "spec",
  "colors": true,
  "require": ["ts-node/register"]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_verbosidad_de_output"><a class="link" href="#_verbosidad_de_output">Verbosidad de Output</a></h4>
<div class="paragraph">
<p>Controlar cuánta información se muestra.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo básico (sin verbosidad):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">  5 passing</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Con --reporter spec (verbose):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">  Calculadora
    ✓ debe sumar dos números (2ms)
    ✓ debe restar dos números (1ms)
    ✓ debe multiplicar dos números (1ms)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Cambiar verbosidad manualmente:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mocha --reporter min           # Mínimo, solo resumen
mocha --reporter spec          # Detallado
mocha --reporter tap           # TAP format (otro nivel de verbosidad)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_controlar_salida_estándar"><a class="link" href="#_controlar_salida_estándar">Controlar Salida Estándar</a></h4>
<div class="paragraph">
<p>Capturar stdout/stderr en tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import * as sinon from 'sinon';

describe('Output Capture', () =&gt; {
  it('debe capturar console.log', () =&gt; {
    const logStub = sinon.stub(console, 'log');

    console.log('Mensaje importante');

    expect(logStub.calledWith('Mensaje importante')).to.be.true;

    logStub.restore();
  });

  it('debe capturar console.error', () =&gt; {
    const errorStub = sinon.stub(console, 'error');

    console.error('Error detectado');

    expect(errorStub.called).to.be.true;

    errorStub.restore();
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configurar_opciones_del_reporter"><a class="link" href="#_configurar_opciones_del_reporter">Configurar Opciones del Reporter</a></h4>
<div class="listingblock">
<div class="title">En .mocharc.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "reporter": "spec",
  "reporterOptions": {
    "reportDir": "./test-results",
    "reportFilename": "index.html"
  },
  "colors": true,
  "slow": 300,
  "timeout": 5000
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">En línea de comandos:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mocha \
  --reporter spec \
  --reporter-options reportDir=./reports \
  --slow 300 \
  --timeout 5000</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_integrado_reporter_completo"><a class="link" href="#_ejemplo_integrado_reporter_completo">Ejemplo Integrado: Reporter Completo</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// reporters/completoReporter.ts
import { EventEmitter } from 'events';
import * as fs from 'fs';
import * as path from 'path';

export class ReporterCompleto extends EventEmitter {
  private resultados: any = {
    timestamp: new Date().toISOString(),
    environment: {
      node: process.version,
      platform: process.platform
    },
    tests: [],
    statistics: {
      total: 0,
      passed: 0,
      failed: 0,
      pending: 0,
      duration: 0
    }
  };

  private inicioTotal: number = Date.now();
  private testActual: any;

  constructor(runner: any, options?: any) {
    super();

    const outputDir = options?.reporterOptions?.outputDir || './test-results';
    const outputFile = path.join(outputDir, 'report.json');

    // Crear directorio si no existe
    if (!fs.existsSync(outputDir)) {
      fs.mkdirSync(outputDir, { recursive: true });
    }

    runner.on('test', (test: any) =&gt; {
      this.testActual = {
        title: test.title,
        fullTitle: test.fullTitle(),
        startTime: Date.now()
      };
      this.resultados.statistics.total++;
    });

    runner.on('pass', (test: any) =&gt; {
      this.resultados.statistics.passed++;
      this.testActual.state = 'passed';
      this.testActual.duration = Date.now() - this.testActual.startTime;
      this.resultados.tests.push(this.testActual);
      console.log(`✓ ${test.title} (${this.testActual.duration}ms)`);
    });

    runner.on('fail', (test: any, err: any) =&gt; {
      this.resultados.statistics.failed++;
      this.testActual.state = 'failed';
      this.testActual.duration = Date.now() - this.testActual.startTime;
      this.testActual.error = {
        message: err.message,
        stack: err.stack
      };
      this.resultados.tests.push(this.testActual);
      console.log(`✗ ${test.title}`);
      console.log(`  ${err.message}`);
    });

    runner.on('pending', (test: any) =&gt; {
      this.resultados.statistics.pending++;
      console.log(`⊘ ${test.title} (pendiente)`);
    });

    runner.on('end', () =&gt; {
      this.resultados.statistics.duration = Date.now() - this.inicioTotal;

      // Guardar JSON
      fs.writeFileSync(outputFile, JSON.stringify(this.resultados, null, 2));

      // Mostrar resumen
      this.mostrarResumen();

      console.log(`\nReporte completo guardado en: ${outputFile}`);
    });
  }

  private mostrarResumen(): void {
    const { passed, failed, total, duration } = this.resultados.statistics;
    const porcentaje = total &gt; 0 ? ((passed / total) * 100).toFixed(2) : 0;

    console.log('\n' + '='.repeat(50));
    console.log('RESUMEN DE TESTS');
    console.log('='.repeat(50));
    console.log(`Total:     ${total}`);
    console.log(`Pasado:    ${passed}`);
    console.log(`Fallido:   ${failed}`);
    console.log(`Duracion:  ${duration}ms`);
    console.log(`Exito:     ${porcentaje}%`);
    console.log('='.repeat(50));
  }
}

module.exports = ReporterCompleto;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Usar:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mocha --reporter ./reporters/completoReporter.ts \
  --reporter-options outputDir=./test-results</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Salida esperada:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">✓ Calculadora debe sumar (2ms)
✓ Calculadora debe restar (1ms)
✗ Calculadora debe dividir
  expected 0 to equal 1

=================================================
RESUMEN DE TESTS
=================================================
Total:     3
Pasado:    2
Fallido:   1
Duracion:  45ms
Exito:     66.67%
=================================================

Reporte completo guardado en: ./test-results/report.json</code></pre>
</div>
</div>
<hr>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_módulo_10_code_coverage"><a class="link" href="#_módulo_10_code_coverage">Módulo 10: Code Coverage</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Code coverage mide qué porcentaje del código ha sido ejecutado durante los tests. Es una métrica importante para identificar código no probado y mejorar la calidad de los tests.</p>
</div>
<div class="sect2">
<h3 id="_10_1_nyc_istanbul_coverage_tool"><a class="link" href="#_10_1_nyc_istanbul_coverage_tool">10.1 Nyc - Istanbul Coverage Tool</a></h3>
<div class="sect3">
<h4 id="_qué_es_code_coverage"><a class="link" href="#_qué_es_code_coverage">¿Qué es Code Coverage?</a></h4>
<div class="paragraph">
<p>Code coverage responde: "¿Qué porcentaje de mi código ha sido ejecutado durante los tests?"</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Tipos de coverage:</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tipo</th>
<th class="tableblock halign-left valign-top">Qué mide</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Statement</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">% de sentencias ejecutadas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>const x = 5;</code> se ejecutó</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Branch</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">% de caminos condicionales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>if (x &gt; 5)</code> se evaluó true y false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Function</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">% de funciones llamadas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sumar()</code> fue invocada</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Line</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">% de líneas ejecutadas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Línea 42 se ejecutó</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_instalación_de_nyc"><a class="link" href="#_instalación_de_nyc">Instalación de NYC</a></h4>
<div class="paragraph">
<p>NYC =(New York Coverage) es una herramienta basada en Istanbul para medir coverage.</p>
</div>
<div class="listingblock">
<div class="title">Instalación:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install --save-dev nyc
npm install --save-dev @types/istanbul-lib-coverage</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuración_de_nyc"><a class="link" href="#_configuración_de_nyc">Configuración de NYC</a></h4>
<div class="listingblock">
<div class="title">En .mocharc.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "reporter": "spec",
  "require": ["ts-node/register"],
  "spec": "tests/**/*.test.ts",
  "nyc": {
    "reporter": ["text", "html", "json"],
    "extension": [".ts"],
    "exclude": [
      "tests/**",
      "node_modules/**"
    ],
    "branches": 80,
    "lines": 80,
    "functions": 80,
    "statements": 80
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">O crear .nycrc.json separado:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "all": true,
  "include": ["src/**/*.ts"],
  "exclude": [
    "src/**/*.test.ts",
    "src/**/*.spec.ts",
    "src/**/index.ts",
    "node_modules/**"
  ],
  "reporter": [
    "text",
    "text-summary",
    "html",
    "json",
    "lcov"
  ],
  "report-dir": "./coverage",
  "branches": 80,
  "lines": 80,
  "functions": 80,
  "statements": 80
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejecutar_tests_con_coverage"><a class="link" href="#_ejecutar_tests_con_coverage">Ejecutar Tests con Coverage</a></h4>
<div class="listingblock">
<div class="title">Comando básico:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">nyc mocha</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Comando en package.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "scripts": {
    "test": "mocha",
    "test:coverage": "nyc mocha",
    "test:coverage:report": "nyc report --reporter=html"
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejecutar:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm run test:coverage
npm run test:coverage:report  # Genera reporte HTML</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_práctico_coverage_en_acción"><a class="link" href="#_ejemplo_práctico_coverage_en_acción">Ejemplo Práctico: Coverage en Acción</a></h4>
<div class="listingblock">
<div class="title">Código a testear:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// src/calculadora.ts
export class Calculadora {
  sumar(a: number, b: number): number {
    return a + b;
  }

  restar(a: number, b: number): number {
    return a - b;
  }

  multiplicar(a: number, b: number): number {
    return a * b;
  }

  dividir(a: number, b: number): number {
    f (b === 0) {
      throw new Error('No se puede dividir por cero');
    }
    return a / b;
  }

  raizCuadrada(n: number): number {
    if (n &lt; 0) {
      throw new Error('No se puede calcular raíz de número negativo');
    }
    return Math.sqrt(n);
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests incompletos (bajo coverage):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import { Calculadora } from '../src/calculadora';

describe('Calculadora - Coverage Bajo', () =&gt; {
  let calc: Calculadora;

  beforeEach(() =&gt; {
    calc = new Calculadora();
  });

  it('debe sumar dos números', () =&gt; {
    expect(calc.sumar(2, 3)).to.equal(5);
  });

  it('debe restar dos números', () =&gt; {
    expect(calc.restar(5, 3)).to.equal(2);
  });
  // Solo test para sumar y restar
  // Multiplicar, dividir y raizCuadrada no están testeados!
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Coverage report:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">------------|---------|----------|---------|---------|-------------------
File        |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Lines
------------|---------|----------|---------|---------|-------------------
All files   |    40    |    20    |    40    |    40    |
 calculadora|    40    |    20    |    40    |    40    |
  .ts       |          |          |          |          | 13,16,19,22,25
------------|---------|----------|---------|---------|-------------------

Solo 40% de statements cubiertos!</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_generar_reportes_html"><a class="link" href="#_generar_reportes_html">Generar Reportes HTML</a></h4>
<div class="paragraph">
<p>NYC genera reportes HTML detallados automáticamente.</p>
</div>
<div class="listingblock">
<div class="title">Ejecutar coverage con HTML:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">nyc --reporter=html mocha
open coverage/index.html  # En macOS
# O navega manualmente a coverage/index.html</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">El reporte HTML muestra:</div>
<ul>
<li>
<p>Porcentaje de coverage por archivo</p>
</li>
<li>
<p>Código resaltado: líneas verdes (cubiertas), rojas (no cubiertas)</p>
</li>
<li>
<p>Estadísticas detalladas</p>
</li>
<li>
<p>Tendencia de coverage</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configurar_thresholds_límites"><a class="link" href="#_configurar_thresholds_límites">Configurar Thresholds (Límites)</a></h4>
<div class="paragraph">
<p>Establecer límites de coverage mínimos requeridos.</p>
</div>
<div class="listingblock">
<div class="title">En .nycrc.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "branches": 80,        // Mínimo 80% branch coverage
  "lines": 80,           // Mínimo 80% line coverage
  "functions": 80,       // Mínimo 80% function coverage
  "statements": 80       // Mínimo 80% statement coverage
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">En package.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "scripts": {
    "test:coverage": "nyc --branches 80 --lines 80 --functions 80 mocha"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si el coverage es menor al umbral, nyc falla:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm run test:coverage
ERROR: Coverage for lines (40%) does not meet threshold (80%)
Coverage for statements (40%) does not meet threshold (80%)</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_10_2_análisis_de_coverage"><a class="link" href="#_10_2_análisis_de_coverage">10.2 Análisis de Coverage</a></h3>
<div class="sect3">
<h4 id="_statement_coverage"><a class="link" href="#_statement_coverage">Statement Coverage</a></h4>
<div class="paragraph">
<p>Mide si cada sentencia ha sido ejecutada.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export function procesarPedido(monto: number): string {
  const impuesto = monto * 0.21;        // Sentencia 1
  const total = monto + impuesto;        // Sentencia 2

  if (total &gt; 1000) {                    // Sentencia 3 (rama)
    return 'Envío gratis';               // Sentencia 4
  } else {
    return 'Envío: $10';                 // Sentencia 5
  }
}

describe('Statement Coverage', () =&gt; {
  it('debe procesar monto bajo', () =&gt; {
    const resultado = procesarPedido(100);
    expect(resultado).to.equal('Envío: $10');
    // Ejecuta: sentencias 1, 2, 3, 5
    // NO ejecuta: sentencia 4
    // Coverage: 4/5 = 80% statements
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_branch_coverage"><a class="link" href="#_branch_coverage">Branch Coverage</a></h4>
<div class="paragraph">
<p>Mide si todas las ramas condicionales se ejecutan.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export function validarEdad(edad: number): string {
  if (edad &lt; 0) {
    return 'Edad inválida';      // Rama 1
  } else if (edad &lt; 18) {
    return 'Menor de edad';      // Rama 2
  } else if (edad &gt;= 65) {
    return 'Jubilado';           // Rama 3
  } else {
    return 'Adulto activo';      // Rama 4
  }
}

describe('Branch Coverage - Incompleto', () =&gt; {
  it('debe rechazar edad negativa', () =&gt; {
    expect(validarEdad(-5)).to.equal('Edad inválida');
  });

  it('debe detectar menor de edad', () =&gt; {
    expect(validarEdad(16)).to.equal('Menor de edad');
  });

  // Falta rama para edad &gt;= 65
  // Falta rama para adulto (18-64)
  // Branch coverage: 2/4 = 50%
});

describe('Branch Coverage - Completo', () =&gt; {
  it('debe rechazar edad negativa', () =&gt; {
    expect(validarEdad(-5)).to.equal('Edad inválida');
  });

  it('debe detectar menor de edad', () =&gt; {
    expect(validarEdad(16)).to.equal('Menor de edad');
  });

  it('debe detectar jubilado', () =&gt; {
    expect(validarEdad(70)).to.equal('Jubilado');
  });

  it('debe detectar adulto activo', () =&gt; {
    expect(validarEdad(40)).to.equal('Adulto activo');
  });

  // Todas las ramas ejecutadas
  // Branch coverage: 4/4 = 100%
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_coverage"><a class="link" href="#_function_coverage">Function Coverage</a></h4>
<div class="paragraph">
<p>Mide si cada función ha sido invocada al menos una vez.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export class Servicio {
  saludar(): string {
    return 'Hola';
  }

  despedir(): string {
    return 'Adiós';
  }

  ayuda(): string {
    return 'Ayuda disponible';
  }
}

describe('Function Coverage - Incompleto', () =&gt; {
  const servicio = new Servicio();

  it('debe saludar', () =&gt; {
    expect(servicio.saludar()).to.equal('Hola');
  });

  // Falta llamar a despedir() y ayuda()
  // Function coverage: 1/3 = 33%
});

describe('Function Coverage - Completo', () =&gt; {
  const servicio = new Servicio();

  it('debe saludar', () =&gt; {
    expect(servicio.saludar()).to.equal('Hola');
  });

  it('debe despedir', () =&gt; {
    expect(servicio.despedir()).to.equal('Adiós');
  });

  it('debe mostrar ayuda', () =&gt; {
    expect(servicio.ayuda()).to.equal('Ayuda disponible');
  });

  // Todas las funciones invocadas
  // Function coverage: 3/3 = 100%
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_line_coverage"><a class="link" href="#_line_coverage">Line Coverage</a></h4>
<div class="paragraph">
<p>Mide si cada línea de código ha sido ejecutada.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export function procesarDatos(datos: any[]): any[] {
  const filtrados = datos.filter(d =&gt; d.activo);  // Línea 2
  const mapeados = filtrados.map(d =&gt; ({           // Línea 3
    ...d,
    procesado: true
  }));
  return mapeados;                                  // Línea 6
}

describe('Line Coverage', () =&gt; {
  it('debe procesar datos no vacíos', () =&gt; {
    const resultado = procesarDatos([
      { id: 1, activo: true },
      { id: 2, activo: false }
    ]);
    expect(resultado).to.have.lengthOf(1);
  });

  // Todas las líneas ejecutadas: 2, 3, 6
  // Line coverage: 3/3 = 100%
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_leer_reportes_de_coverage"><a class="link" href="#_leer_reportes_de_coverage">Leer Reportes de Coverage</a></h4>
<div class="listingblock">
<div class="title">Estructura de salida text:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">====== Coverage summary =======
Statements   : XX.XX% ( X/X )
Branches     : XX.XX% ( X/X )
Functions    : XX.XX% ( X/X )
Lines        : XX.XX% ( X/X )
====================================</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Visualizar con reportes:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">nyc report --reporter=text-summary   # Resumen en terminal
nyc report --reporter=text           # Detallado en terminal
nyc report --reporter=html           # HTML interactivo
open coverage/index.html</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_10_3_mejora_de_coverage"><a class="link" href="#_10_3_mejora_de_coverage">10.3 Mejora de Coverage</a></h3>
<div class="sect3">
<h4 id="_identificar_código_no_cubierto"><a class="link" href="#_identificar_código_no_cubierto">Identificar Código No Cubierto</a></h4>
<div class="paragraph">
<p>El reporte HTML muestra exactamente qué líneas no están cubiertas.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de código:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// src/usuario.ts
export class Usuario {
  constructor(
    public nombre: string,
    public email: string,
    public edad: number
  ) {}

  esAdulto(): boolean {
    return this.edad &gt;= 18;  // Cubierta
  }

  esJubilado(): boolean {
    return this.edad &gt;= 65;  // NO cubierta
  }

  email_valido(): boolean {
    return this.email.includes('@');  // NO cubierta
  }
}

// tests/usuario.test.ts
import { expect } from 'chai';
import { Usuario } from '../src/usuario';

describe('Usuario', () =&gt; {
  it('debe verificar si es adulto', () =&gt; {
    const usuario = new Usuario('Juan', 'juan@example.com', 25);
    expect(usuario.esAdulto()).to.be.true;
  });

  // Falta test para esJubilado()
  // Falta test para emailValido()
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">NYC report mostraría:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">File         |  % Stmts | % Branch | % Funcs | % Lines
usuario.ts   |   66.67  |   50     |   66.67 |   66.67
Uncovered    |          |          |         | 13, 17</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_estrategia_edge_cases"><a class="link" href="#_estrategia_edge_cases">Estrategia: Edge Cases</a></h4>
<div class="paragraph">
<p>Agregar tests para casos extremos.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo mejorado:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Usuario - Mejorado', () =&gt; {
  it('debe verificar si es adulto', () =&gt; {
    const mayor = new Usuario('Juan', 'juan@example.com', 25);
    expect(mayor.esAdulto()).to.be.true;

    const menor = new Usuario('Ana', 'ana@example.com', 16);
    expect(menor.esAdulto()).to.be.false;
  });

  it('debe verificar si es jubilado', () =&gt; {
    const jubilado = new Usuario('Carlos', 'carlos@example.com', 70);
    expect(jubilado.esJubilado()).to.be.true;

    const noJubilado = new Usuario('Juan', 'juan@example.com', 30);
    expect(noJubilado.esJubilado()).to.be.false;
  });

  it('debe validar email', () =&gt; {
    const conEmail = new Usuario('Juan', 'juan@example.com', 25);
    expect(conEmail.email_valido()).to.be.true;

    const sinEmail = new Usuario('Ana', 'ana-invalid', 28);
    expect(sinEmail.email_valido()).to.be.false;
  });

  // Ahora: Statement: 100%, Branch: 100%, Function: 100%
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_estrategia_error_paths"><a class="link" href="#_estrategia_error_paths">Estrategia: Error Paths</a></h4>
<div class="paragraph">
<p>Testear caminos de error.</p>
</div>
<div class="listingblock">
<div class="title">Código con errores:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export function dividir(a: number, b: number): number {
  if (!Number.isFinite(a) || !Number.isFinite(b)) {
    throw new Error('Argumentos invalidos');  // Error path
  }

  f (b === 0) {
    throw new Error('División por cero');     // Error path
  }

  return a / b;  // Happy path
}

describe('Dividir - Sin Errores', () =&gt; {
  it('debe dividir correctamente', () =&gt; {
    expect(dividir(10, 2)).to.equal(5);
  });
  // No cubre error paths!
});

describe('Dividir - Con Errores Cubiertos', () =&gt; {
  it('debe dividir correctamente', () =&gt; {
    expect(dividir(10, 2)).to.equal(5);
  });

  it('debe lanzar error si denominador es cero', () =&gt; {
    expect(() =&gt; dividir(10, 0)).to.throw('División por cero');
  });

  it('debe lanzar error si argumentos inválidos', () =&gt; {
    expect(() =&gt; dividir(NaN, 5)).to.throw('Argumentos invalidos');
    expect(() =&gt; dividir(5, Infinity)).to.throw('Argumentos invalidos');
  });

  // Ahora 100% coverage
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_coverage_goals_definir_objetivos_realistas"><a class="link" href="#_coverage_goals_definir_objetivos_realistas">Coverage Goals: Definir Objetivos Realistas</a></h4>
<div class="paragraph">
<p>No siempre es posible (ni deseable) alcanzar 100% coverage.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Estrategia recomendada:</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tipo de código</th>
<th class="tableblock halign-left valign-top">Coverage</th>
<th class="tableblock halign-left valign-top">Razón</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lógica crítica</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">90-100%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Errores aquí son costosos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servicios</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80-90%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comportamiento importante</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Utilidades</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80-90%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cobertura razonable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UI/Controllers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">70-80%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cambios frecuentes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Código generado</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;50%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Costo-beneficio bajo</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Configurar thresholds reales:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "all": true,
  "branches": 80,
  "lines": 85,
  "functions": 80,
  "statements": 85,
  "check-coverage": true,
  "per-file": true
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_exclusiones_código_a_no_cubrir"><a class="link" href="#_exclusiones_código_a_no_cubrir">Exclusiones: Código a No Cubrir</a></h4>
<div class="paragraph">
<p>A veces es razonable excluir código del coverage.</p>
</div>
<div class="listingblock">
<div class="title">Excluir archivos específicos:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "exclude": [
    "src/generated/**",
    "src/migrations/**",
    "src/**/*.mock.*",
    "src/**/*.d.ts"
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Excluir líneas en código:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">export function log(mensaje: string): void {
  /* istanbul ignore next */  // Ignorar siguiente línea
  console.log(mensaje);
}

export function apiCall(): Promise&lt;any&gt; {
  /* istanbul ignore if */  // Ignorar rama if
  f (process.env.NODE_ENV === 'test') {
    return Promise.resolve({ data: 'mock' });
  }

  return fetch('/api/endpoint');
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_integrado_mejora_de_coverage"><a class="link" href="#_ejemplo_integrado_mejora_de_coverage">Ejemplo Integrado: Mejora de Coverage</a></h4>
<div class="listingblock">
<div class="title">Código inicial:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// src/producto.ts
export class Producto {
  constructor(
    public id: number,
    public nombre: string,
    public precio: number,
    public stock: number
  ) {}

  aplicarDescuento(porcentaje: number): number {
    if (porcentaje &lt; 0 || porcentaje &gt; 100) {
      throw new Error('Descuento inválido');
    }
    return this.precio * (1 - porcentaje / 100);
  }

  comprar(cantidad: number): boolean {
    if (cantidad &gt; this.stock) {
      return false;
    }
    this.stock -= cantidad;
    return true;
  }

  reponerStock(cantidad: number): void {
    if (cantidad &lt;= 0) {
      throw new Error('Cantidad debe ser positiva');
    }
    this.stock += cantidad;
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests iniciales (bajo coverage):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';
import { Producto } from '../src/producto';

describe('Producto - Coverage Inicial', () =&gt; {
  let producto: Producto;

  beforeEach(() =&gt; {
    producto = new Producto(1, 'Laptop', 1000, 5);
  });

  it('debe aplicar descuento válido', () =&gt; {
    const precioConDesc = producto.aplicarDescuento(10);
    expect(precioConDesc).to.equal(900);
  });

  it('debe comprar si hay stock', () =&gt; {
    const resultado = producto.comprar(2);
    expect(resultado).to.be.true;
    expect(producto.stock).to.equal(3);
  });

  // Coverage: ~50% (faltan tests para)
  // - Descuento inválido (negativo)
  // - Descuento inválido (&gt;100)
  // - Compra sin stock
  // - ReponerStock
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests mejorados (alto coverage):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Producto - Coverage Completo', () =&gt; {
  let producto: Producto;

  beforeEach(() =&gt; {
    producto = new Producto(1, 'Laptop', 1000, 5);
  });

  describe('aplicarDescuento', () =&gt; {
    it('debe aplicar descuento válido', () =&gt; {
      expect(producto.aplicarDescuento(10)).to.equal(900);
      expect(producto.aplicarDescuento(50)).to.equal(500);
      expect(producto.aplicarDescuento(0)).to.equal(1000);
      expect(producto.aplicarDescuento(100)).to.equal(0);
    });

    it('debe lanzar error para descuento negativo', () =&gt; {
      expect(() =&gt; producto.aplicarDescuento(-1))
        .to.throw('Descuento inválido');
    });

    it('debe lanzar error para descuento &gt; 100', () =&gt; {
      expect(() =&gt; producto.aplicarDescuento(101))
        .to.throw('Descuento inválido');
    });
  });

  describe('comprar', () =&gt; {
    it('debe comprar si hay stock sufficient', () =&gt; {
      const resultado = producto.comprar(2);
      expect(resultado).to.be.true;
      expect(producto.stock).to.equal(3);
    });

    it('debe comprar cantidad exacta del stock', () =&gt; {
      const resultado = producto.comprar(5);
      expect(resultado).to.be.true;
      expect(producto.stock).to.equal(0);
    });

    it('debe fallar si stock insufficient', () =&gt; {
      const resultado = producto.comprar(10);
      expect(resultado).to.be.false;
      expect(producto.stock).to.equal(5); // Sin cambios
    });
  });

  describe('reponerStock', () =&gt; {
    it('debe reponer stock positivo', () =&gt; {
      producto.reponerStock(3);
      expect(producto.stock).to.equal(8);
    });

    it('debe lanzar error para cantidad cero', () =&gt; {
      expect(() =&gt; producto.reponerStock(0))
        .to.throw('Cantidad debe ser positiva');
    });

    it('debe lanzar error para cantidad negativa', () =&gt; {
      expect(() =&gt; producto.reponerStock(-5))
        .to.throw('Cantidad debe ser positiva');
    });
  });

  // Coverage: ~99% (casi perfecto)
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejecutar y ver mejora:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ npm run test:coverage

====== Coverage summary =======
Statements   : 98.00% ( 49/50 )
Branches     : 95.00% ( 19/20 )
Functions    : 100.00% ( 4/4 )
Lines        : 98.00% ( 49/50 )
====================================</code></pre>
</div>
</div>
<hr>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_módulo_11_testing_de_apis_rest"><a class="link" href="#_módulo_11_testing_de_apis_rest">Módulo 11: Testing de APIs REST</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Testing de APIs REST es fundamental en aplicaciones modernas. Este módulo cubre Supertest, la librería estándar para hacer assertions en HTTP requests/responses. Veremos desde requests básicos hasta flujos complejos multi-endpoint.</p>
</div>
<div class="sect2">
<h3 id="_11_1_supertest_http_assertions"><a class="link" href="#_11_1_supertest_http_assertions">11.1 Supertest - HTTP Assertions</a></h3>
<div class="sect3">
<h4 id="_qué_es_supertest"><a class="link" href="#_qué_es_supertest">¿Qué es Supertest?</a></h4>
<div class="paragraph">
<p>Supertest es un librería que simplifica testing de aplicaciones HTTP. Proporciona una API fluida para hacer requests y validar respuestas sin necesidad de un servidor ejecutándose.</p>
</div>
</div>
<div class="sect3">
<h4 id="_instalación"><a class="link" href="#_instalación">Instalación</a></h4>
<div class="listingblock">
<div class="title">Instalación básica:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install --save-dev supertest
npm install --save-dev @types/supertest</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Dependencias típicas para una API:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install express
npm install --save-dev @types/express
npm install --save-dev @types/node
npm install --save-dev ts-node
npm install --save-dev typescript</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_api_básica_para_testear"><a class="link" href="#_api_básica_para_testear">API Básica para Testear</a></h4>
<div class="listingblock">
<div class="title">Crear aplicación Express simple (src/api.ts):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import express, { Express, Request, Response } from 'express';

export function crearApp(): Express {
  const app = express();

  // Middleware
  app.use(express.json());

  // Rutas
  app.get('/health', (req: Request, res: Response) =&gt; {
    res.status(200).json({ status: 'ok' });
  });

  app.get('/usuarios/:id', (req: Request, res: Response) =&gt; {
    const { id } = req.params;

    if (!id || isNaN(parseInt(id))) {
      return res.status(400).json({ error: 'ID inválido' });
    }

    f (id === '1') {
      return res.status(200).json({
        id: 1,
        nombre: 'Juan',
        email: 'juan@example.com'
      });
    }

    res.status(404).json({ error: 'Usuario no encontrado' });
  });

  return app;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_request_builder_estructura_básica"><a class="link" href="#_request_builder_estructura_básica">Request Builder - Estructura Básica</a></h4>
<div class="paragraph">
<p>Supertest utiliza un patrón builder para construir y enviar requests.</p>
</div>
<div class="listingblock">
<div class="title">Estructura básica:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import request from 'supertest';
import { expect } from 'chai';
import { crearApp } from '../src/api';

describe('API - Request Builder', () =&gt; {
  let app;

  beforeEach(() =&gt; {
    app = crearApp();
  });

  it('debe hacer GET request básico', () =&gt; {
    return request(app)
      .get('/health')                    // 1. Método HTTP + ruta
      .expect(200)                       // 2. Assertion de status
      .then(respuesta =&gt; {               // 3. Acceso a respuesta
        expect(respuesta.body.status)
          .to.equal('ok');
      });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_response_assertions"><a class="link" href="#_response_assertions">Response Assertions</a></h4>
<div class="paragraph">
<p>Tabla de assertions comunes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Método</th>
<th class="tableblock halign-left valign-top">Qué valida</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.expect(status)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status HTTP (200, 404, 500, etc.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.expect(status, body)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status y body exacto</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.expect(campo, valor)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Propiedad del response body</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.expect(fn)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom assertion function</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Ejemplos:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import request from 'supertest';
import { expect } from 'chai';
import { crearApp } from '../src/api';

describe('Response Assertions', () =&gt; {
  let app;

  beforeEach(() =&gt; {
    app = crearApp();
  });

  it('debe validar status code 200', () =&gt; {
    return request(app)
      .get('/health')
      .expect(200);  // Solo status
  });

  it('debe validar status y body exacto', () =&gt; {
    return request(app)
      .get('/health')
      .expect(200, { status: 'ok' });  // Status + body completo
  });

  it('debe validar propiedad específica', () =&gt; {
    return request(app)
      .get('/health')
      .expect('Content-Type', /json/);  // Validar header
  });

  it('debe usar custom assertion', () =&gt; {
    return request(app)
      .get('/usuarios/1')
      .expect(res =&gt; {
        expect(res.body.nombre).to.equal('Juan');
        expect(res.body.email).to.include('@');
      });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_status_codes_y_headers"><a class="link" href="#_status_codes_y_headers">Status Codes y Headers</a></h4>
<div class="paragraph">
<p>Validar status y headers HTTP.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Tabla de status comunes:</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Status</th>
<th class="tableblock halign-left valign-top">Significado</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OK - Éxito</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Created - Recurso creado</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No Content - Éxito sin body</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bad Request - Datos inválidos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">401</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unauthorized - Falta autenticación</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">403</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forbidden - Sin permisos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Found - Recurso no existe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server Error - Error del servidor</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Ejemplos:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import request from 'supertest';
import { expect } from 'chai';
import { crearApp } from '../src/api';

describe('Status Codes y Headers', () =&gt; {
  let app;

  beforeEach(() =&gt; {
    app = crearApp();
  });

  it('debe retornar 200 en health check', () =&gt; {
    return request(app)
      .get('/health')
      .expect(200)
      .expect('Content-Type', /json/);
  });

  it('debe retornar 404 para usuario no encontrado', () =&gt; {
    return request(app)
      .get('/usuarios/999')
      .expect(404)
      .expect(res =&gt; {
        expect(res.body.error).to.equal('Usuario no encontrado');
      });
  });

  it('debe retornar 400 para ID inválido', () =&gt; {
    return request(app)
      .get('/usuarios/abc')
      .expect(400)
      .expect('Content-Type', /json/);
  });

  it('debe validar headers específicos', () =&gt; {
    return request(app)
      .get('/health')
      .expect(200)
      .expect('Content-Type', 'application/json; charset=utf-8')
      .expect('X-Powered-By', /express/i)  // Regex también funciona
      .expect(res =&gt; {
        expect(res.headers['content-length']).to.exist;
      });
  });
});</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_11_2_testing_de_endpoints"><a class="link" href="#_11_2_testing_de_endpoints">11.2 Testing de Endpoints</a></h3>
<div class="sect3">
<h4 id="_api_completa_para_tests"><a class="link" href="#_api_completa_para_tests">API Completa para Tests</a></h4>
<div class="listingblock">
<div class="title">API con CRUD completo (src/api-completa.ts):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import express, { Express, Request, Response } from 'express';

interface Producto {
  id: number;
  nombre: string;
  precio: number;
  stock: number;
}

export function crearAppProductos(): Express {
  const app = express();
  app.use(express.json());

  let productos: Producto[] = [
    { id: 1, nombre: 'Laptop', precio: 1000, stock: 5 },
    { id: 2, nombre: 'Mouse', precio: 25, stock: 100 }
  ];
  let proximoId = 3;

  // GET todos
  app.get('/productos', (req: Request, res: Response) =&gt; {
    res.status(200).json(productos);
  });

  // GET uno
  app.get('/productos/:id', (req: Request, res: Response) =&gt; {
    onst producto = productos.find(p =&gt; p.id === parseInt(req.params.id));
    if (!producto) {
      return res.status(404).json({ error: 'No encontrado' });
    }
    res.status(200).json(producto);
  });

  // POST crear
  app.post('/productos', (req: Request, res: Response) =&gt; {
    const { nombre, precio, stock } = req.body;

    if (!nombre || !precio) {
      return res.status(400).json({ error: 'Campos requeridos' });
    }

    const nuevo: Producto = {
      id: proximoId++,
      nombre,
      precio,
      stock: stock || 0
    };

    productos.push(nuevo);
    res.status(201).json(nuevo);
  });

  // PUT actualizar
  app.put('/productos/:id', (req: Request, res: Response) =&gt; {
    onst producto = productos.find(p =&gt; p.id === parseInt(req.params.id));
    if (!producto) {
      return res.status(404).json({ error: 'No encontrado' });
    }

    producto.nombre = req.body.nombre || producto.nombre;
    producto.precio = req.body.precio || producto.precio;
    producto.stock = req.body.stock !== undefined ? req.body.stock : producto.stock;

    res.status(200).json(producto);
  });

  // DELETE
  app.delete('/productos/:id', (req: Request, res: Response) =&gt; {
    onst index = productos.findIndex(p =&gt; p.id === parseInt(req.params.id));
    f (index === -1) {
      return res.status(404).json({ error: 'No encontrado' });
    }

    const eliminado = productos.splice(index, 1);
    res.status(200).json(eliminado[0]);
  });

  return app;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get_requests"><a class="link" href="#_get_requests">GET Requests</a></h4>
<div class="paragraph">
<p>Testing de GET sin parámetros y con parámetros.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplos:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import request from 'supertest';
import { expect } from 'chai';
import { crearAppProductos } from '../src/api-completa';

describe('GET Requests', () =&gt; {
  let app;

  beforeEach(() =&gt; {
    app = crearAppProductos();
  });

  it('debe obtener todos los productos', () =&gt; {
    return request(app)
      .get('/productos')
      .expect(200)
      .expect(res =&gt; {
        expect(res.body).to.be.an('array');
        expect(res.body).to.have.lengthOf.at.least(1);
        expect(res.body[0]).to.have.property('id');
        expect(res.body[0]).to.have.property('nombre');
      });
  });

  it('debe obtener producto específico por ID', () =&gt; {
    return request(app)
      .get('/productos/1')
      .expect(200)
      .expect(res =&gt; {
        expect(res.body.id).to.equal(1);
        expect(res.body.nombre).to.equal('Laptop');
        expect(res.body.precio).to.equal(1000);
      });
  });

  it('debe retornar 404 para producto no existente', () =&gt; {
    return request(app)
      .get('/productos/999')
      .expect(404)
      .expect(res =&gt; {
        expect(res.body.error).to.equal('No encontrado');
      });
  });

  it('debe manejar GET con query params', function() {
    // Si la API soportara filtros: GET /productos?nombre=Laptop&amp;maxPrecio=2000
    return request(app)
      .get('/productos')
      .query({ nombre: 'Laptop' })
      .expect(200);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_post_requests"><a class="link" href="#_post_requests">POST Requests</a></h4>
<div class="paragraph">
<p>Crear nuevos recursos y validar respuestas.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplos:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import request from 'supertest';
import { expect } from 'chai';
import { crearAppProductos } from '../src/api-completa';

describe('POST Requests', () =&gt; {
  let app;

  beforeEach(() =&gt; {
    app = crearAppProductos();
  });

  it('debe crear nuevo producto', () =&gt; {
    return request(app)
      .post('/productos')
      .send({
        nombre: 'Teclado',
        precio: 75,
        stock: 50
      })
      .expect(201)
      .expect(res =&gt; {
        expect(res.body.id).to.exist;
        expect(res.body.nombre).to.equal('Teclado');
        expect(res.body.precio).to.equal(75);
        expect(res.body.stock).to.equal(50);
      });
  });

  it('debe crear producto sin stock (default 0)', () =&gt; {
    return request(app)
      .post('/productos')
      .send({
        nombre: 'Monitor',
        precio: 300
      })
      .expect(201)
      .expect(res =&gt; {
        expect(res.body.stock).to.equal(0);
      });
  });

  it('debe rechazar POST sin campos requeridos', () =&gt; {
    return request(app)
      .post('/productos')
      .send({
        nombre: 'Incompleto'
        // Falta precio
      })
      .expect(400)
      .expect(res =&gt; {
        expect(res.body.error).to.equal('Campos requeridos');
      });
  });

  it('debe rechazar POST con body vacío', () =&gt; {
    return request(app)
      .post('/productos')
      .send({})
      .expect(400);
  });

  it('debe validar tipos de datos', () =&gt; {
    return request(app)
      .post('/productos')
      .send({
        nombre: 'Producto',
        precio: 'no-es-numero'  // Error!
      })
      .expect(400);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_putpatch_requests"><a class="link" href="#_putpatch_requests">PUT/PATCH Requests</a></h4>
<div class="paragraph">
<p>Actualizar recursos existentes.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplos:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import request from 'supertest';
import { expect } from 'chai';
import { crearAppProductos } from '../src/api-completa';

describe('PUT Requests', () =&gt; {
  let app;

  beforeEach(() =&gt; {
    app = crearAppProductos();
  });

  it('debe actualizar producto existente', () =&gt; {
    return request(app)
      .put('/productos/1')
      .send({
        nombre: 'Laptop Mejorada',
        precio: 1200
      })
      .expect(200)
      .expect(res =&gt; {
        expect(res.body.id).to.equal(1);
        expect(res.body.nombre).to.equal('Laptop Mejorada');
        expect(res.body.precio).to.equal(1200);
      });
  });

  it('debe actualizar solo campo especificado', () =&gt; {
    return request(app)
      .put('/productos/2')
      .send({
        stock: 200
      })
      .expect(200)
      .expect(res =&gt; {
        expect(res.body.nombre).to.equal('Mouse'); // Sin cambios
        expect(res.body.stock).to.equal(200);
      });
  });

  it('debe retornar 404 para producto inexistente', () =&gt; {
    return request(app)
      .put('/productos/999')
      .send({ nombre: 'Test' })
      .expect(404);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delete_requests"><a class="link" href="#_delete_requests">DELETE Requests</a></h4>
<div class="paragraph">
<p>Eliminar recursos.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplos:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import request from 'supertest';
import { expect } from 'chai';
import { crearAppProductos } from '../src/api-completa';

describe('DELETE Requests', () =&gt; {
  let app;

  beforeEach(() =&gt; {
    app = crearAppProductos();
  });

  it('debe eliminar producto existente', () =&gt; {
    return request(app)
      .delete('/productos/2')
      .expect(200)
      .expect(res =&gt; {
        expect(res.body.id).to.equal(2);
        expect(res.body.nombre).to.equal('Mouse');
      });
  });

  it('debe verificar que producto fue eliminado', () =&gt; {
    // Primero eliminar
    return request(app)
      .delete('/productos/1')
      .expect(200)
      .then(() =&gt; {
        // Luego intentar obtener
        return request(app)
          .get('/productos/1')
          .expect(404);
      });
  });

  it('debe retornar 404 para delete inexistente', () =&gt; {
    return request(app)
      .delete('/productos/999')
      .expect(404);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_headers_y_autenticación"><a class="link" href="#_headers_y_autenticación">Headers y Autenticación</a></h4>
<div class="paragraph">
<p>Testing con headers custom y autenticación.</p>
</div>
<div class="listingblock">
<div class="title">API con autenticación:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import express, { Express, Request, Response, NextFunction } from 'express';

export function crearAppConAuth(): Express {
  const app = express();
  app.use(express.json());

  // Middleware de autenticación
  const verificarToken = (req: Request, res: Response, next: NextFunction) =&gt; {
    const token = req.headers['authorization']?.replace('Bearer ', '');

    if (!token) {
      return res.status(401).json({ error: 'Token requerido' });
    }

    if (token !== 'valid-token-123') {
      return res.status(403).json({ error: 'Token inválido' });
    }

    next();
  };

  app.get('/datos-publicos', (req: Request, res: Response) =&gt; {
    res.json({ data: 'Pública' });
  });

  app.get('/datos-privados', verificarToken, (req: Request, res: Response) =&gt; {
    res.json({ data: 'Privada', user: 'admin' });
  });

  return app;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import request from 'supertest';
import { expect } from 'chai';
import { crearAppConAuth } from '../src/api-auth';

describe('Headers y Autenticación', () =&gt; {
  let app;

  beforeEach(() =&gt; {
    app = crearAppConAuth();
  });

  it('debe acceder a endpoint público sin token', () =&gt; {
    return request(app)
      .get('/datos-publicos')
      .expect(200)
      .expect(res =&gt; {
        expect(res.body.data).to.equal('Pública');
      });
  });

  it('debe rechazar endpoint privado sin token', () =&gt; {
    return request(app)
      .get('/datos-privados')
      .expect(401)
      .expect(res =&gt; {
        expect(res.body.error).to.equal('Token requerido');
      });
  });

  it('debe rechazar token inválido', () =&gt; {
    return request(app)
      .get('/datos-privados')
      .set('Authorization', 'Bearer invalid-token')
      .expect(403)
      .expect(res =&gt; {
        expect(res.body.error).to.equal('Token inválido');
      });
  });

  it('debe acceder a endpoint privado con token válido', () =&gt; {
    return request(app)
      .get('/datos-privados')
      .set('Authorization', 'Bearer valid-token-123')
      .expect(200)
      .expect(res =&gt; {
        expect(res.body.data).to.equal('Privada');
        expect(res.body.user).to.equal('admin');
      });
  });

  it('debe enviar múltiples headers', () =&gt; {
    return request(app)
      .get('/datos-privados')
      .set('Authorization', 'Bearer valid-token-123')
      .set('X-Custom-Header', 'valor')
      .set('Content-Type', 'application/json')
      .expect(200);
  });
});</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_11_3_testing_de_flujos_complejos"><a class="link" href="#_11_3_testing_de_flujos_complejos">11.3 Testing de Flujos Complejos</a></h3>
<div class="sect3">
<h4 id="_chaining_de_requests"><a class="link" href="#_chaining_de_requests">Chaining de Requests</a></h4>
<div class="paragraph">
<p>Ejecutar múltiples requests secuencialmente y usar datos del primero en el segundo.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo: Crear producto, luego obtenerlo, luego actualizar, luego eliminar:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import request from 'supertest';
import { expect } from 'chai';
import { crearAppProductos } from '../src/api-completa';

describe('Chaining de Requests - Flujo CRUD Completo', () =&gt; {
  let app;
  let productoId: number;

  beforeEach(() =&gt; {
    app = crearAppProductos();
  });

  it('debe ejecutar flujo completo: Create -&gt; Read -&gt; Update -&gt; Delete', () =&gt; {
    // 1. CREATE
    return request(app)
      .post('/productos')
      .send({
        nombre: 'Nuevo Producto',
        precio: 500,
        stock: 10
      })
      .expect(201)
      .then(res =&gt; {
        productoId = res.body.id;
        expect(res.body.nombre).to.equal('Nuevo Producto');

        // 2. READ
        return request(app)
          .get(`/productos/${productoId}`)
          .expect(200);
      })
      .then(res =&gt; {
        expect(res.body.id).to.equal(productoId);

        // 3. UPDATE
        return request(app)
          .put(`/productos/${productoId}`)
          .send({
            nombre: 'Producto Actualizado',
            precio: 600
          })
          .expect(200);
      })
      .then(res =&gt; {
        expect(res.body.nombre).to.equal('Producto Actualizado');
        expect(res.body.precio).to.equal(600);

        // 4. DELETE
        return request(app)
          .delete(`/productos/${productoId}`)
          .expect(200);
      })
      .then(res =&gt; {
        expect(res.body.id).to.equal(productoId);

        // 5. VERIFY DELETED
        return request(app)
          .get(`/productos/${productoId}`)
          .expect(404);
      });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_datos_dependientes"><a class="link" href="#_datos_dependientes">Datos Dependientes</a></h4>
<div class="paragraph">
<p>Usar datos de una respuesta en la siguiente request.</p>
</div>
<div class="listingblock">
<div class="title">API de Usuarios con Órdenes:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import express, { Express, Request, Response } from 'express';

interface Usuario {
  id: number;
  nombre: string;
  email: string;
}

interface Orden {
  id: number;
  usuarioId: number;
  producto: string;
  monto: number;
}

export function crearAppOrdenes(): Express {
  const app = express();
  app.use(express.json());

  let usuarios: Usuario[] = [
    { id: 1, nombre: 'Juan', email: 'juan@example.com' }
  ];
  let ordenes: Orden[] = [];
  let proximoUsuarioId = 2;
  let proximaOrdenId = 1;

  // Crear usuario
  app.post('/usuarios', (req: Request, res: Response) =&gt; {
    const usuario: Usuario = {
      id: proximoUsuarioId++,
      nombre: req.body.nombre,
      email: req.body.email
    };
    usuarios.push(usuario);
    res.status(201).json(usuario);
  });

  // Crear orden para usuario
  app.post('/usuarios/:usuarioId/ordenes', (req: Request, res: Response) =&gt; {
    const usuarioId = parseInt(req.params.usuarioId);
    onst usuario = usuarios.find(u =&gt; u.id === usuarioId);

    if (!usuario) {
      return res.status(404).json({ error: 'Usuario no encontrado' });
    }

    const orden: Orden = {
      id: proximaOrdenId++,
      usuarioId,
      producto: req.body.producto,
      monto: req.body.monto
    };

    ordenes.push(orden);
    res.status(201).json(orden);
  });

  // Obtener órdenes del usuario
  app.get('/usuarios/:usuarioId/ordenes', (req: Request, res: Response) =&gt; {
    const usuarioId = parseInt(req.params.usuarioId);
    onst ordenesUsuario = ordenes.filter(o =&gt; o.usuarioId === usuarioId);
    res.status(200).json(ordenesUsuario);
  });

  return app;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Tests con datos dependientes:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import request from 'supertest';
import { expect } from 'chai';
import { crearAppOrdenes } from '../src/api-ordenes';

describe('Datos Dependientes - Flujo Usuario + Órdenes', () =&gt; {
  let app;
  let usuarioId: number;
  let ordenIds: number[] = [];

  beforeEach(() =&gt; {
    app = crearAppOrdenes();
  });

  it('debe crear usuario y agregar múltiples órdenes', () =&gt; {
    // 1. Crear usuario (necesitamos su ID)
    return request(app)
      .post('/usuarios')
      .send({
        nombre: 'Ana García',
        email: 'ana@example.com'
      })
      .expect(201)
      .then(res =&gt; {
        usuarioId = res.body.id;
        expect(usuarioId).to.exist;

        // 2. Crear primera orden (usando ID del usuario)
        return request(app)
          .post(`/usuarios/${usuarioId}/ordenes`)
          .send({
            producto: 'Laptop',
            monto: 1000
          })
          .expect(201);
      })
      .then(res =&gt; {
        ordenIds.push(res.body.id);
        expect(res.body.usuarioId).to.equal(usuarioId);

        // 3. Crear segunda orden
        return request(app)
          .post(`/usuarios/${usuarioId}/ordenes`)
          .send({
            producto: 'Mouse',
            monto: 25
          })
          .expect(201);
      })
      .then(res =&gt; {
        ordenIds.push(res.body.id);

        // 4. Verificar que usuario tiene 2 órdenes
        return request(app)
          .get(`/usuarios/${usuarioId}/ordenes`)
          .expect(200);
      })
      .then(res =&gt; {
        expect(res.body).to.have.lengthOf(2);
        expect(res.body[0].producto).to.equal('Laptop');
        expect(res.body[1].producto).to.equal('Mouse');
      });
  });

  it('debe fallar al crear orden para usuario inexistente', () =&gt; {
    return request(app)
      .post('/usuarios/999/ordenes')
      .send({
        producto: 'Test',
        monto: 100
      })
      .expect(404);
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_estado_compartido_entre_tests"><a class="link" href="#_estado_compartido_entre_tests">Estado Compartido Entre Tests</a></h4>
<div class="paragraph">
<p>Mantener estado entre múltiples tests.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo con inicialización y limpieza:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import request from 'supertest';
import { expect } from 'chai';
import { crearAppOrdenes } from '../src/api-ordenes';

describe('Estado Compartido - Suite Integration', () =&gt; {
  let app;
  let usuarioId: number;
  let ordenId: number;

  beforeEach(() =&gt; {
    app = crearAppOrdenes();
  });

  // Test 1: Setup - crear usuario
  it('debe crear usuario inicial', () =&gt; {
    return request(app)
      .post('/usuarios')
      .send({
        nombre: 'Usuario Test',
        email: 'test@example.com'
      })
      .expect(201)
      .then(res =&gt; {
        usuarioId = res.body.id;
      });
  });

  // Test 2: Usar usuario del test anterior
  it('debe crear orden para usuario existente', () =&gt; {
    // usuarioId ya existe del test anterior
    return request(app)
      .post(`/usuarios/${usuarioId}/ordenes`)
      .send({
        producto: 'Monitor',
        monto: 300
      })
      .expect(201)
      .then(res =&gt; {
        ordenId = res.body.id;
        expect(res.body.usuarioId).to.equal(usuarioId);
      });
  });

  // Test 3: Usar orden del test anterior
  it('debe obtener orden creada', () =&gt; {
    return request(app)
      .get(`/usuarios/${usuarioId}/ordenes`)
      .expect(200)
      .then(res =&gt; {
        onst miOrden = res.body.find((o: any) =&gt; o.id === ordenId);
        expect(miOrden).to.exist;
        expect(miOrden.producto).to.equal('Monitor');
      });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_integrado_e_commerce_completo"><a class="link" href="#_ejemplo_integrado_e_commerce_completo">Ejemplo Integrado: E-commerce Completo</a></h4>
<div class="paragraph">
<p>API completa con múltiples endpoints interconectados.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import request from 'supertest';
import { expect } from 'chai';
import { crearAppOrdenes } from '../src/api-ordenes';

describe('E-commerce - Flujo Completo de Compra', () =&gt; {
  let app;

  beforeEach(() =&gt; {
    app = crearAppOrdenes();
  });

  it('debe completar flujo de compra: usuario -&gt; carrito -&gt; orden', () =&gt; {
    let usuarioId: number;
    let ordenId: number;

    // 1. Registrar nuevo usuario
    return request(app)
      .post('/usuarios')
      .send({
        nombre: 'Cliente Premium',
        email: 'premium@example.com'
      })
      .expect(201)
      .then(res =&gt; {
        usuarioId = res.body.id;

        // 2. Primera orden
        return request(app)
          .post(`/usuarios/${usuarioId}/ordenes`)
          .send({
            producto: 'Laptop Gaming',
            monto: 2000
          })
          .expect(201);
      })
      .then(res =&gt; {
        ordenId = res.body.id;

        // 3. Segunda orden
        return request(app)
          .post(`/usuarios/${usuarioId}/ordenes`)
          .send({
            producto: 'Monitor 4K',
            monto: 800
          })
          .expect(201);
      })
      .then(res =&gt; {
        // 4. Listar todas las órdenes del usuario
        return request(app)
          .get(`/usuarios/${usuarioId}/ordenes`)
          .expect(200);
      })
      .then(res =&gt; {
        expect(res.body).to.have.lengthOf(2);
        const montoTotal = res.body.reduce((sum: number, o: any) =&gt; sum + o.monto, 0);
        expect(montoTotal).to.equal(2800);
      });
  });

  it('debe validar operaciones concurrentes', () =&gt; {
    let usuarioId: number;

    return request(app)
      .post('/usuarios')
      .send({
        nombre: 'Usuario Ocupado',
        email: 'ocupado@example.com'
      })
      .expect(201)
      .then(res =&gt; {
        usuarioId = res.body.id;

        // Crear 3 órdenes en paralelo
        return Promise.all([
          request(app)
            .post(`/usuarios/${usuarioId}/ordenes`)
            .send({ producto: 'Libro', monto: 20 })
            .expect(201),
          request(app)
            .post(`/usuarios/${usuarioId}/ordenes`)
            .send({ producto: 'Pen', monto: 5 })
            .expect(201),
          request(app)
            .post(`/usuarios/${usuarioId}/ordenes`)
            .send({ producto: 'Notebook', monto: 10 })
            .expect(201)
        ]);
      })
      .then(responses =&gt; {
        expect(responses).to.have.lengthOf(3);
        responses.forEach((res, index) =&gt; {
          expect(res.body.id).to.exist;
        });
      });
  });
});</code></pre>
</div>
</div>
<hr>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_módulo_12_buenas_prácticas"><a class="link" href="#_módulo_12_buenas_prácticas">Módulo 12: Buenas Prácticas</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Este módulo cubre patrones y convenciones que hacen tus tests mantenibles, legibles y efectivos a largo plazo. La calidad del código de tests es tan importante como la del código de producción.</p>
</div>
<div class="sect2">
<h3 id="_12_1_estructura_de_tests"><a class="link" href="#_12_1_estructura_de_tests">12.1 Estructura de Tests</a></h3>
<div class="sect3">
<h4 id="_organización_de_archivos"><a class="link" href="#_organización_de_archivos">Organización de Archivos</a></h4>
<div class="paragraph">
<p>Estructura recomendada de un proyecto con tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">proyecto/
├── src/
│   ├── calculadora.ts
│   ├── usuario.ts
│   ├── carrito.ts
│   └── utils.ts
├── tests/
│   ├── unit/
│   │   ├── calculadora.test.ts
│   │   ├── usuario.test.ts
│   │   ├── carrito.test.ts
│   │   └── utils.test.ts
│   ├── integration/
│   │   ├── carrito-producto.test.ts
│   │   └── usuario-autenticacion.test.ts
│   ├── fixtures/
│   │   ├── usuarios.json
│   │   └── productos.json
│   └── helpers/
│       ├── test-utils.ts
│       └── mock-data.ts
├── package.json
├── tsconfig.json
└── .mocharc.json</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Principios de organización:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Por tipo de test</strong>: unit, integration, e2e en carpetas separadas</p>
</li>
<li>
<p><strong>Espejo de estructura src</strong>: Tests en estructura similar a src para fácil navegación</p>
</li>
<li>
<p><strong>Helpers y fixtures centralizados</strong>: Reutilizar código de test</p>
</li>
<li>
<p><strong>Naming consistente</strong>: <code>archivo.test.ts</code> o <code>archivo.spec.ts</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_convenciones_de_naming"><a class="link" href="#_convenciones_de_naming">Convenciones de Naming</a></h4>
<div class="paragraph">
<p>Nombres claros hacen tests auto-documentados.</p>
</div>
<div class="listingblock">
<div class="title">Malas prácticas:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Calc', () =&gt; {
  it('works', () =&gt; {
    // ¿Qué calcula? ¿Qué debería hacer?
  });

  it('test1', () =&gt; {
    // ¿Cuál es el case?
  });

  it('should work with stuff', () =&gt; {
    // "stuff" es muy vago
  });
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Buenas prácticas:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Calculadora', () =&gt; {
  describe('sumar', () =&gt; {
    it('debe retornar suma de dos números positivos', () =&gt; {
      const resultado = calc.sumar(2, 3);
      expect(resultado).to.equal(5);
    });

    it('debe manejar números negativos', () =&gt; {
      const resultado = calc.sumar(-5, 3);
      expect(resultado).to.equal(-2);
    });

    it('debe retornar 0 cuando ambos son 0', () =&gt; {
      const resultado = calc.sumar(0, 0);
      expect(resultado).to.equal(0);
    });
  });
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Convenciones:</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Patrón</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Describe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nombre de clase/función: <code>describe('Calculadora', &#8230;&#8203;)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">It/Test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comportamiento esperado: <code>it('debe sumar números positivos', &#8230;&#8203;)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archivo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>calculadora.test.ts</code> (plural: tests, singular: test okay)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>usuarioValido</code>, <code>respuestaConError</code>, <code>datosMock</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_dry_dont_repeat_yourself_en_tests"><a class="link" href="#_dry_dont_repeat_yourself_en_tests">DRY (Don&#8217;t Repeat Yourself) en Tests</a></h4>
<div class="paragraph">
<p>Refa=ctorizar código duplicado en helpers.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo de duplicación:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Usuario - DRY Malo', () =&gt; {
  it('debe validar nombre', () =&gt; {
    const usuario = {
      nombre: 'Juan',
      email: 'juan@example.com',
      edad: 30,
      ciudad: 'Madrid',
      activo: true
    };
    expect(usuario.nombre).to.equal('Juan');
  });

  it('debe validar email', () =&gt; {
    const usuario = {
      nombre: 'Ana',
      email: 'ana@example.com',
      edad: 28,
      ciudad: 'Barcelona',
      activo: true
    };
    expect(usuario.email).to.include('@');
  });

  it('debe validar edad', () =&gt; {
    const usuario = {
      nombre: 'Carlos',
      email: 'carlos@example.com',
      edad: 35,
      ciudad: 'Valencia',
      activo: true
    };
    expect(usuario.edad).to.be.greaterThan(0);
  });
  // Repetición innecesaria!
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Refactorizado con helper:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// tests/helpers/usuario-fixtures.ts
export const crearUsuarioBase = (overrides = {}) =&gt; ({
  nombre: 'Usuario Default',
  email: 'usuario@example.com',
  edad: 25,
  ciudad: 'Madrid',
  activo: true,
  ...overrides
});

// tests/unit/usuario.test.ts
describe('Usuario - DRY Bueno', () =&gt; {
  it('debe validar nombre', () =&gt; {
    const usuario = crearUsuarioBase({ nombre: 'Juan' });
    expect(usuario.nombre).to.equal('Juan');
  });

  it('debe validar email', () =&gt; {
    const usuario = crearUsuarioBase({ email: 'ana@example.com' });
    expect(usuario.email).to.include('@');
  });

  it('debe validar edad', () =&gt; {
    const usuario = crearUsuarioBase({ edad: 35 });
    expect(usuario.edad).to.be.greaterThan(0);
  });
  // Mucho más limpio!
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_single_responsibility_un_test_una_cosa"><a class="link" href="#_single_responsibility_un_test_una_cosa">Single Responsibility: Un Test, Una Cosa</a></h4>
<div class="paragraph">
<p>Cada test debe verificar una única funcionalidad.</p>
</div>
<div class="listingblock">
<div class="title">Mal: Multiple assertions sin relación:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">it('debe procesar carrito completo', () =&gt; {
  const carrito = new Carrito();

  // Testing agregar item
  carrito.agregar({ id: 1, nombre: 'Laptop', precio: 1000 });
  expect(carrito.items.length).to.equal(1);
  expect(carrito.items[0].nombre).to.equal('Laptop');

  // Testing calcular total
  expect(carrito.obtenerTotal()).to.equal(1000);

  // Testing aplicar descuento
  carrito.aplicarDescuento(10);
  expect(carrito.descuentoAplicado).to.be.true;
  expect(carrito.obtenerTotal()).to.equal(900);

  // Testing vaciar carrito
  carrito.vaciar();
  expect(carrito.items.length).to.equal(0);
});
// Un test que hace demasiado!</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Bien: Tests separados y enfocados:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Carrito', () =&gt; {
  let carrito: Carrito;

  beforeEach(() =&gt; {
    carrito = new Carrito();
  });

  describe('agregar items', () =&gt; {
    it('debe agregar un item al carrito', () =&gt; {
      carrito.agregar({ id: 1, nombre: 'Laptop', precio: 1000 });
      expect(carrito.items).to.have.lengthOf(1);
    });

    it('debe almacenar datos del item correctamente', () =&gt; {
      carrito.agregar({ id: 1, nombre: 'Laptop', precio: 1000 });
      expect(carrito.items[0].nombre).to.equal('Laptop');
    });
  });

  describe('calcular total', () =&gt; {
    it('debe retornar total sin descuento', () =&gt; {
      carrito.agregar({ id: 1, nombre: 'Laptop', precio: 1000 });
      expect(carrito.obtenerTotal()).to.equal(1000);
    });
  });

  describe('aplicar descuento', () =&gt; {
    it('debe aplicar descuento porcentual', () =&gt; {
      carrito.agregar({ id: 1, nombre: 'Laptop', precio: 1000 });
      carrito.aplicarDescuento(10);
      expect(carrito.obtenerTotal()).to.equal(900);
    });
  });

  describe('vaciar', () =&gt; {
    it('debe eliminar todos los items', () =&gt; {
      carrito.agregar({ id: 1, nombre: 'Laptop', precio: 1000 });
      carrito.vaciar();
      expect(carrito.items).to.have.lengthOf(0);
    });
  });
});
// Cada test verifica una cosa!</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_12_2_escritura_de_tests_efectivos"><a class="link" href="#_12_2_escritura_de_tests_efectivos">12.2 Escritura de Tests Efectivos</a></h3>
<div class="sect3">
<h4 id="_one_assertion_per_test"><a class="link" href="#_one_assertion_per_test">One Assertion Per Test</a></h4>
<div class="paragraph">
<p>Un test debe tener idealmente una sola assertion (verificación).</p>
</div>
<div class="listingblock">
<div class="title">Anti-patrón: Múltiples assertions:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">it('debe hacer muchas cosas', () =&gt; {
  const resultado = sumar(2, 3);

  expect(resultado).to.equal(5);              // Assertion 1
  expect(typeof resultado).to.equal('number'); // Assertion 2
  expect(resultado).to.be.greaterThan(0);     // Assertion 3

  // Si falla la primera, nunca se ejecuta la segunda
  // Es confuso saber cuál falló exactamente
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Patrón correcto: Una assertion principal por test:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('sumar', () =&gt; {
  it('debe retornar resultado numérico correcto', () =&gt; {
    const resultado = sumar(2, 3);
    expect(resultado).to.equal(5);
  });

  it('debe retornar dato de tipo number', () =&gt; {
    const resultado = sumar(2, 3);
    expect(typeof resultado).to.equal('number');
  });

  it('debe retornar valor positivo', () =&gt; {
    const resultado = sumar(2, 3);
    expect(resultado).to.be.greaterThan(0);
  });
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Ventajas:</strong>
- Claridad: Sé exactamente qué falló
- Mantenibilidad: Tests fáciles de modificar
- Reusabilidad: Un error no oculta otros</p>
</div>
</div>
<div class="sect3">
<h4 id="_nombres_descriptivos"><a class="link" href="#_nombres_descriptivos">Nombres Descriptivos</a></h4>
<div class="paragraph">
<p>Los nombres deben explicar qué se está testando y qué se espera.</p>
</div>
<div class="listingblock">
<div class="title">Malos nombres:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">it('works', () =&gt; {});
it('test', () =&gt; {});
it('should work', () =&gt; {});
it('edge case', () =&gt; {});
it('error test', () =&gt; {});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Buenos nombres (auto-documentados):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">it('debe retornar el doble del número ingresado', () =&gt; {});
it('debe lanzar error cuando parámetro es null', () =&gt; {});
it('debe ignorar espacios en blanco al validar email', () =&gt; {});
it('debe retornar lista vacía cuando no hay resultados', () =&gt; {});
it('debe incrementar contador después de cada llamada', () =&gt; {});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Formula útil: <code>"debe [acción] cuando [condición]"</code></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Patrón</th>
<th class="tableblock halign-left valign-top">Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valor positivo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"debe retornar suma correcta"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valor negativo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"debe lanzar error para entrada inválida"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Límite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"debe manejar strings vacíos"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lado efecto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"debe actualizar base de datos"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Performance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"debe completarse en menos de 100ms"</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_aaa_pattern_arrange_act_assert"><a class="link" href="#_aaa_pattern_arrange_act_assert">AAA Pattern: Arrange, Act, Assert</a></h4>
<div class="paragraph">
<p>El patrón AAA estructura tests claramente en tres fases.</p>
</div>
<div class="listingblock">
<div class="title">Estructura:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">it('debe calcular descuento correctamente', () =&gt; {
  // ARRANGE (Preparación)
  const precioOriginal = 100;
  const porcentajeDescuento = 10;
  const precioEsperado = 90;

  // ACT (Acción)
  const precioConDescuento = aplicarDescuento(
    precioOriginal,
    porcentajeDescuento
  );

  // ASSERT (Verificación)
  expect(precioConDescuento).to.equal(precioEsperado);
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo complejo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">class RepositorioUsuarios {
  private usuarios: any[] = [];

  guardar(usuario: any): void {
    this.usuarios.push(usuario);
  }

  obtenerPorEmail(email: string): any {
    eturn this.usuarios.find(u =&gt; u.email === email);
  }
}

describe('RepositorioUsuarios - AAA Pattern', () =&gt; {
  it('debe guardar y recuperar usuario por email', () =&gt; {
    // ARRANGE
    const repo = new RepositorioUsuarios();
    const usuarioNuevo = {
      nombre: 'Juan',
      email: 'juan@example.com',
      edad: 30
    };

    // ACT
    repo.guardar(usuarioNuevo);
    const usuarioRecuperado = repo.obtenerPorEmail('juan@example.com');

    // ASSERT
    expect(usuarioRecuperado).to.deep.equal(usuarioNuevo);
    expect(usuarioRecuperado.nombre).to.equal('Juan');
  });

  it('debe retornar undefined si email no existe', () =&gt; {
    // ARRANGE
    const repo = new RepositorioUsuarios();

    // ACT
    const resultado = repo.obtenerPorEmail('inexistente@example.com');

    // ASSERT
    expect(resultado).to.be.undefined;
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_evitar_dependencias_entre_tests"><a class="link" href="#_evitar_dependencias_entre_tests">Evitar Dependencias Entre Tests</a></h4>
<div class="paragraph">
<p>Tests deben ser independientes. Uno no debe requeri del estado de otro.</p>
</div>
<div class="listingblock">
<div class="title">Mal: Tests dependientes (frágil):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">let contador = 0;

describe('Contador - Dependencias', () =&gt; {
  it('test 1: debe incrementar', () =&gt; {
    contador++;
    expect(contador).to.equal(1);
    // El test 2 depende de este resultado!
  });

  it('test 2: debe valer 1', () =&gt; {
    // Solo pasa si test 1 pasó antes
    expect(contador).to.equal(1);
  });

  it('test 3: debe decrementar', () =&gt; {
    contador--;
    // Si test 2 no corrió, esto falla!
    expect(contador).to.equal(0);
  });
});
// Orden de ejecución afecta resultados!</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Bien: Tests independientes (robusto):</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">class Contador {
  private valor = 0;

  incrementar(): void {
    this.valor++;
  }

  decrementar(): void {
    this.valor--;
  }

  obtenerValor(): number {
    return this.valor;
  }
}

describe('Contador - Independencia', () =&gt; {
  let contador: Contador;

  beforeEach(() =&gt; {
    contador = new Contador();  // Reset para cada test!
  });

  it('debe comenzar en 0', () =&gt; {
    expect(contador.obtenerValor()).to.equal(0);
  });

  it('debe incrementar de forma independiente', () =&gt; {
    contador.incrementar();
    expect(contador.obtenerValor()).to.equal(1);
  });

  it('debe decrementar de forma independiente', () =&gt; {
    contador.decrementar();
    expect(contador.obtenerValor()).to.equal(-1);
  });
});
// Cada test funciona solo, sin dependencias!</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_12_3_mantenimiento_de_tests"><a class="link" href="#_12_3_mantenimiento_de_tests">12.3 Mantenimiento de Tests</a></h3>
<div class="sect3">
<h4 id="_tests_como_documentación"><a class="link" href="#_tests_como_documentación">Tests Como Documentación</a></h4>
<div class="paragraph">
<p>Bien escritos, los tests describen cómo usar el código.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo: Tests = Documentación viva</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">/**
 * Tests de Calculadora - Ejemplos de uso
 */
describe('Calculadora', () =&gt; {
  let calc: Calculadora;

  beforeEach(() =&gt; {
    calc = new Calculadora();
  });

  describe('constructor', () =&gt; {
    it('puede inicializar con valor inicial', () =&gt; {
      const calc2 = new Calculadora(10);
      expect(calc2.obtenerValor()).to.equal(10);
    });

    it('comienza en 0 si no se especifica', () =&gt; {
      expect(calc.obtenerValor()).to.equal(0);
    });
  });

  describe('sumar()', () =&gt; {
    it('suma un número al valor actual', () =&gt; {
      calc.sumar(5);
      expect(calc.obtenerValor()).to.equal(5);
    });

    it('permite encadenamiento: calc.sumar(5).sumar(3)', () =&gt; {
      calc.sumar(5).sumar(3);
      expect(calc.obtenerValor()).to.equal(8);
    });
  });

  describe('restar()', () =&gt; {
    it('resta un número del valor actual', () =&gt; {
      calc.sumar(10).restar(3);
      expect(calc.obtenerValor()).to.equal(7);
    });
  });

  describe('limpiar()', () =&gt; {
    it('reinicia el valor a 0', () =&gt; {
      calc.sumar(50).limpiar();
      expect(calc.obtenerValor()).to.equal(0);
    });
  });

  describe('snapshot', () =&gt; {
    it('guarda estado actual para comparación posterior', () =&gt; {
      calc.sumar(10).snapshot();
      calc.sumar(5);
      expect(calc.obtenerSnapshot()).to.equal(10);
    });
  });
});
// README innecesario: Los tests muestran todo!</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_refactoring_de_tests"><a class="link" href="#_refactoring_de_tests">Refactoring de Tests</a></h4>
<div class="paragraph">
<p>Mantener tests limpios a medida que evoluciona el código.</p>
</div>
<div class="listingblock">
<div class="title">Antes: Tests desordenados</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Validador', () =&gt; {
  it('email validation', () =&gt; {
    const v = new Validador();
    const result = v.emailValido('test@example.com');
    expect(result).to.be.true;
    const result2 = v.emailValido('invalid-email');
    expect(result2).to.be.false;
    const result3 = v.emailValido('');
    expect(result3).to.be.false;
  });

  it('telefono', () =&gt; {
    const v = new Validador();
    expect(v.telefonoValido('123-456-7890')).to.be.true;
    expect(v.telefonoValido('abc')).to.be.false;
  });
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Después: Tests refactorizados</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Validador', () =&gt; {
  let validador: Validador;

  beforeEach(() =&gt; {
    validador = new Validador();
  });

  describe('emailValido()', () =&gt; {
    it('debe retornar true para email válido', () =&gt; {
      expect(validador.emailValido('test@example.com')).to.be.true;
    });

    it('debe retornar false para email sin @', () =&gt; {
      expect(validador.emailValido('invalid-email')).to.be.false;
    });

    it('debe retornar false para email vacío', () =&gt; {
      expect(validador.emailValido('')).to.be.false;
    });
  });

  describe('telefonoValido()', () =&gt; {
    it('debe retornar true para teléfono válido', () =&gt; {
      expect(validador.telefonoValido('123-456-7890')).to.be.true;
    });

    it('debe retornar false para teléfono inválido', () =&gt; {
      expect(validador.telefonoValido('abc')).to.be.false;
    });
  });
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deprecación_de_tests"><a class="link" href="#_deprecación_de_tests">Deprecación de Tests</a></h4>
<div class="paragraph">
<p>A veces es necesario eliminar tests obsoletos.</p>
</div>
<div class="listingblock">
<div class="title">Proceso correcto:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Calculadora', () =&gt; {
  // MARCAR COMO DEPRECATED
  it.skip('cálculo antiguo (deprecado en v2.0)', () =&gt; {
    // Mantener test pero no ejecutar
    expect(true).to.be.true;
  });

  // NUEVO TEST QUE REEMPLAZA
  it('cálculo mejorado en v2.0', () =&gt; {
    const calc = new Calculadora();
    expect(calc.sumar(2, 3)).to.equal(5);
  });
});

// O comentar con contexto:
/*
it('función antigua - removida en v3.0', () =&gt; {
  // DEPRECATED: Use newFunction() en su lugar
  // expect(oldFunction()).to.equal(5);
});
*/</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_test_gardening_mantenimiento_regular"><a class="link" href="#_test_gardening_mantenimiento_regular">Test Gardening: Mantenimiento Regular</a></h4>
<div class="paragraph">
<p>Mantener suites de tests saludables.</p>
</div>
<div class="listingblock">
<div class="title">Checklist de mantenimiento:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">□ Ejecutar todos los tests regularmente
□ Eliminar tests duplicados
□ Actualizar tests cuando cambia implementación
□ Aumentar coverage para nuevo código
□ Revisar tests lentos (&gt;500ms)
□ Limpiar mocks/stubs sin usar
□ Refactorizar describe/it muy anidados
□ Actualizar fixtures obsoletas
□ Revisar tests con muchas variables
□ Documentar tests complejos</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo de gardening:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Encontrar tests muy lentos
mocha --reporter json | jq '.tests[] | select(.duration &gt; 500)'

# Encuentra tests duplicados
grep -r "it('debe" tests/ | sort | uniq -d

# Ver coverage y encontrar huecos
nyc mocha &amp;&amp; open coverage/index.html

# Limpiar tests marcados como skip
grep -r "it.skip" tests/ | wc -l

# Refactorizar si hay muchos describes anidados
grep -c "describe(" tests/archivo.test.ts</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Script de verificación anual:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "scripts": {
    "test:garden": "npm run test:coverage &amp;&amp; npm run test:slow &amp;&amp; npm run test:grep-skip",
    "test:slow": "mocha --reporter json | jq '.tests[] | select(.duration &gt; 500)'",
    "test:grep-skip": "grep -r 'it.skip\\|it.only\\|describe.skip\\|describe.only' tests/"
  }
}</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_módulo_13_debugging_y_troubleshooting_de_tests"><a class="link" href="#_módulo_13_debugging_y_troubleshooting_de_tests">Módulo 13: Debugging y Troubleshooting de Tests</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Técnicas para diagnosticar y resolver problemas en tests fallidos.</p>
</div>
<div class="sect2">
<h3 id="_13_1_técnicas_de_debug"><a class="link" href="#_13_1_técnicas_de_debug">13.1 Técnicas de Debug</a></h3>
<div class="sect3">
<h4 id="_console_log_debugging"><a class="link" href="#_console_log_debugging">console.log() Debugging</a></h4>
<div class="paragraph">
<p>La forma más simple pero efectiva de debuggear.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">import { expect } from 'chai';

function procesarDatos(datos: any[]): number {
  console.log('Datos ingresados:', datos);  // Debug 1
  const filtrados = datos.filter(d =&gt; d.activo);
  console.log('Después de filtrar:', filtrados);  // Debug 2
  const suma = filtrados.reduce((s, d) =&gt; s + d.valor, 0);
  console.log('Suma calculada:', suma);  // Debug 3
  return suma;
}

describe('procesarDatos - Debug', () =&gt; {
  it('debe sumar valores de datos activos', () =&gt; {
    const datos = [
      { valor: 10, activo: true },
      { valor: 20, activo: false },
      { valor: 30, activo: true }
    ];

    const resultado = procesarDatos(datos);
    // Output:
    // Datos ingresados: [ ... ]
    // Después de filtrar: [ ... ]
    // Suma calculada: 40

    expect(resultado).to.equal(40);
  });
});

// Ejecutar: mocha --reporter spec (muestra console.log)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vscode_debugger"><a class="link" href="#_vscode_debugger">VSCode Debugger</a></h4>
<div class="paragraph">
<p>Debuggear tests directamente en VSCode.</p>
</div>
<div class="listingblock">
<div class="title">Crear .vscode/launch.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "version": "0.2.0",
  "configurations": [
    {
      "type": "node",
      "request": "launch",
      "name": "Mocha Tests",
      "program": "${workspaceFolder}/node_modules/.bin/mocha",
      "args": [
        "tests/**/*.test.ts",
        "--require",
        "ts-node/register"
      ],
      "console": "integratedTerminal",
      "internalConsoleOptions": "neverOpen"
    }
  ]
}</code></pre>
</div>
</div>
<div class="olist arabic">
<div class="title">Uso:</div>
<ol class="arabic">
<li>
<p>Abrir test file</p>
</li>
<li>
<p>Click en números de línea para agregar breakpoints</p>
</li>
<li>
<p>Presionar F5 para iniciar debug</p>
</li>
<li>
<p>Pausa en breakpoints, inspecciona variables</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_mocha_grep_para_tests_específicos"><a class="link" href="#_mocha_grep_para_tests_específicos">Mocha --grep para Tests Específicos</a></h4>
<div class="paragraph">
<p>Ejecutar solo ciertos tests para debuggear.</p>
</div>
<div class="listingblock">
<div class="title">Sintaxis:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Ejecutar tests que coinciden con patrón
mocha --grep "sumar"
mocha --grep "debe.*positivo"
mocha --grep "^Calculadora"

# Usar regex
mocha --grep "debe (sumar|restar)"

# Case insensitive
mocha --grep "SUMA" -i</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">describe('Calculadora', () =&gt; {
  describe('sumar', () =&gt; {
    it('debe sumar números positivos', () =&gt; {});
    it('debe sumar números negativos', () =&gt; {});
  });

  describe('restar', () =&gt; {
    it('debe restar correctamente', () =&gt; {});
  });
});

# Ejecutar solo tests de sumar:
$ mocha --grep "sumar"
# Output:
# Calculadora
#   sumar
#     ✓ debe sumar números positivos
#     ✓ debe sumar números negativos
#   2 passing</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_it_only_para_aislamiento"><a class="link" href="#_it_only_para_aislamiento">it.only() para Aislamiento</a></h4>
<div class="paragraph">
<p>Ejecutar solo un test para debuggear.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe('Carrito', () =&gt; {
  it('debe agregar item', () =&gt; {
    // ...
  });

  it.only('debe calcular total (DEBUGGEANDO)', () =&gt; {
    const carrito = new Carrito();
    carrito.agregar({ precio: 100 });
    console.log('Total:', carrito.total);
    expect(carrito.total).to.equal(100);
  });

  it('debe aplicar descuento', () =&gt; {
    // No se ejecuta mientras hay .only
  });
});

// Ejecutar: mocha
// Solo ejecuta el test con .only</code></pre>
</div>
</div>
<div class="paragraph">
<p>⚠️ <strong>Importante</strong>: Siempre remover <code>.only()</code> antes de commit!</p>
</div>
</div>
<div class="sect3">
<h4 id="_mocha_bail_para_parar_en_primer_error"><a class="link" href="#_mocha_bail_para_parar_en_primer_error">Mocha --bail para Parar en Primer Error</a></h4>
<div class="paragraph">
<p>Útil cuando múltiples tests fallan.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mocha --bail          # Detener en primer fallo
mocha --bail tests/unit/calculadora.test.ts  # En archivo específico</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_13_2_análisis_de_errores_comunes"><a class="link" href="#_13_2_análisis_de_errores_comunes">13.2 Análisis de Errores Comunes</a></h3>
<div class="sect3">
<h4 id="_error_expected_x_to_equal_y"><a class="link" href="#_error_expected_x_to_equal_y">Error: "expected X to equal Y"</a></h4>
<div class="paragraph">
<p>Test de igualdad fallido.</p>
</div>
<div class="listingblock">
<div class="title">Diagnostic:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">it('debe retornar suma correcta', () =&gt; {
  const resultado = sumar(2, 3);
  expect(resultado).to.equal(5);

  // Error: expected 4 to equal 5
  // Posibles causas:
  // 1. Lógica en la función es incorrecta
  // 2. Argumentos pasados al test son diferentes
  // 3. Tipo de dato es incorrecto (4 vs '4')
});

// Solution: Verificar
console.log('Resultado:', resultado, typeof resultado);  // Debug
expect(resultado).to.equal(5);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_error_cannot_read_property_x_of_undefined"><a class="link" href="#_error_cannot_read_property_x_of_undefined">Error: "Cannot read property X of undefined"</a></h4>
<div class="paragraph">
<p>Accediendo a propiedad de null/undefined.</p>
</div>
<div class="listingblock">
<div class="title">Diagnostic:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">it('debe obtener usuario', () =&gt; {
  const usuario = obtenerUsuario(1);
  expect(usuario.nombre).to.equal('Juan');

  // Error: Cannot read property 'nombre' of undefined
  // usuario es undefined!
});

// Solution:
console.log('Usuario:', usuario);  // ¿Es undefined?
expect(usuario).to.exist;           // Verificar primero
if (usuario) {
  expect(usuario.nombre).to.equal('Juan');
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_error_timeout_of_2000ms_exceeded"><a class="link" href="#_error_timeout_of_2000ms_exceeded">Error: "Timeout of 2000ms exceeded"</a></h4>
<div class="paragraph">
<p>Test tarda más que timeout.</p>
</div>
<div class="listingblock">
<div class="title">Diagnostic:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">it('debe completar operación', () =&gt; {
  // Operación lenta sin await
  operacionAsincronica();  // ¡Falta await!
  expect(resultado).to.equal(true);

  // Error: Timeout of 2000ms exceeded
});

// Solution:
it('debe completar operación', async () =&gt; {
  await operacionAsincronica();  // Agregar await
  expect(resultado).to.equal(true);
});

// O aumentar timeout:
it('debe completar operación', function() {
  this.timeout(5000);
  return operacionAsincronica();
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_error_assertionerror_expected_false_to_be_true"><a class="link" href="#_error_assertionerror_expected_false_to_be_true">Error: "AssertionError: expected false to be true"</a></h4>
<div class="paragraph">
<p>Assertion boolean fallida.</p>
</div>
<div class="listingblock">
<div class="title">Diagnostic:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">it('debe validar email', () =&gt; {
  const valido = validarEmail('invalid@');
  expect(valido).to.be.true;

  // Error: expected false to be true
  // La función retorna false pero esperamos true
});

// Solution: Verificar lógica de validación
console.log('ValidarEmail retorna:', validarEmail('invalid@'));
// O verificar que el email es válido en realidad</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_13_3_estrategias_de_troubleshooting"><a class="link" href="#_13_3_estrategias_de_troubleshooting">13.3 Estrategias de Troubleshooting</a></h3>
<div class="sect3">
<h4 id="_test_red_green_refactor"><a class="link" href="#_test_red_green_refactor">Test Red-Green-Refactor</a></h4>
<div class="paragraph">
<p>Si un test falla inesperadamente, usar TDD al revés:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>RED</strong>: Entender por qué falla</p>
</li>
<li>
<p><strong>GREEN</strong>: Fix minimal para pasar</p>
</li>
<li>
<p><strong>REFACTOR</strong>: Limpiar</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Ejemplo:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">// Test RED: Falla
it('debe calcular IVA correctamente', () =&gt; {
  const resultado = calcularIVA(100);  // 100 * 0.21 = 21
  expect(resultado).to.equal(21);
  // Error: expected undefined to equal 21
});

// Función incompleta
function calcularIVA(monto: number) {
  // No hace nada!
}

// GREEN: Fix simple
function calcularIVA(monto: number) {
  return monto * 0.21;  // Solo lo necesario
}

// REFACTOR: Mejorar
function calcularIVA(monto: number, tasa: number = 0.21): number {
  if (monto &lt; 0) throw new Error('Monto debe ser positivo');
  return Math.round(monto * tasa * 100) / 100;  // Redondeo correcto
}

// Test ahora pasa con más robustez</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_crear_test_mínimo_reproducible"><a class="link" href="#_crear_test_mínimo_reproducible">Crear Test Mínimo Reproducible</a></h4>
<div class="paragraph">
<p>Si un test falla, crear versión mínima que reproduzca error.</p>
</div>
<div class="listingblock">
<div class="title">Ejemplo: Test complejo que falla</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">it('debe procesar pedido con múltiples items y validaciones', () =&gt; {
  const pedido = new Pedido();
  pedido.agregar(producto1);
  pedido.agregar(producto2);
  const desc = pedido.aplicarDescuento(0.1);
  const impuesto = pedido.calcularImpuesto();
  const total = pedido.obtenerTotal();

  expect(total).to.equal(expectedValue);
  // ¿Cuál parte falla exactamente?
});

// Versión mínima reproducible:
it('debe obtener total correcto (MÍNIMO)', () =&gt; {
  const pedido = new Pedido();
  pedido.agregar({ precio: 100 });

  const total = pedido.obtenerTotal();
  expect(total).to.equal(100);
  // Mucho más fácil de debuggear
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_usar_describe_only_y_it_only_estratégicamente"><a class="link" href="#_usar_describe_only_y_it_only_estratégicamente">Usar describe.only() y it.only() Estratégicamente</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">describe.only('Carrito', () =&gt; {
  // Solo ejecutar tests de Carrito, no otros describes

  describe('agregar', () =&gt; {
    it.only('debe agregar un item', () =&gt; {
      // Ejecutar solo este test
    });

    it('debe agregar múltiples items', () =&gt; {
      // No se ejecuta
    });
  });
});</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_módulo_14_integración_con_herramientas"><a class="link" href="#_módulo_14_integración_con_herramientas">Módulo 14: Integración con Herramientas</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Integración de tests con CI/CD y herramientas de desarrollo.</p>
</div>
<div class="sect2">
<h3 id="_14_1_cicd_pipelines"><a class="link" href="#_14_1_cicd_pipelines">14.1 CI/CD Pipelines</a></h3>
<div class="sect3">
<h4 id="_github_actions"><a class="link" href="#_github_actions">GitHub Actions</a></h4>
<div class="paragraph">
<p>Ejecutar tests automáticamente en cada push.</p>
</div>
<div class="listingblock">
<div class="title">Crear .github/workflows/tests.yml:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">name: Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [14.x, 16.x, 18.x]

    steps:
    - uses: actions/checkout@v2

    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v2
      with:
        node-version: ${{ matrix.node-version }}

    - name: Install dependencies
      run: npm ci

    - name: Run tests
      run: npm test

    - name: Generate coverage report
      run: npm run test:coverage

    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v2
      with:
        files: ./coverage/lcov.info</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gitlab_ci"><a class="link" href="#_gitlab_ci">GitLab CI</a></h4>
<div class="paragraph">
<p>Alternativa a GitHub Actions.</p>
</div>
<div class="listingblock">
<div class="title">.gitlab-ci.yml:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">stages:
  - test
  - coverage

test:
  stage: test
  image: node:16
  script:
    - npm ci
    - npm test
  artifacts:
    reports:
      junit: test-results.xml
    paths:
      - coverage/

coverage:
  stage: coverage
  image: node:16
  script:
    - npm ci
    - npm run test:coverage
  coverage: '/Lines\s:.*?(\d+\%)/'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_validación_de_coverage"><a class="link" href="#_validación_de_coverage">Validación de Coverage</a></h4>
<div class="paragraph">
<p>Fallar build si coverage es bajo.</p>
</div>
<div class="listingblock">
<div class="title">En GitHub Actions:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">- name: Check coverage threshold
  run: npm run test:coverage -- --check-coverage --lines 80
  # Falla si lines coverage &lt; 80%</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">En package.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "scripts": {
    "test:ci": "nyc --check-coverage --lines 80 mocha"
  }
}</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_14_2_pre_commit_hooks"><a class="link" href="#_14_2_pre_commit_hooks">14.2 Pre-commit Hooks</a></h3>
<div class="sect3">
<h4 id="_husky_lint_staged"><a class="link" href="#_husky_lint_staged">Husky + Lint-Staged</a></h4>
<div class="paragraph">
<p>Ejecutar tests antes de commit.</p>
</div>
<div class="listingblock">
<div class="title">Instalación:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install husky lint-staged --save-dev
npx husky install
npx husky add .husky/pre-commit "npx lint-staged"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Configurar package.json:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "lint-staged": {
    "src/**/*.ts": [
      "eslint --fix",
      "npm test -- --testPathPattern=$(git diff --cached --name-only | grep -E '\.ts$' | head -1)"
    ],
    "tests/**/*.ts": [
      "mocha --grep $(basename $(git diff --cached --name-only | grep -E '\.test.ts$'))"
    ]
  }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<div class="title">Flujo:</div>
<ol class="arabic">
<li>
<p>Hacer cambios en código</p>
</li>
<li>
<p><code>git add .</code></p>
</li>
<li>
<p><code>git commit -m "fix: bug en calculadora"</code></p>
</li>
<li>
<p>Husky ejecuta pre-commit hook</p>
</li>
<li>
<p>Lint-staged corre linters y tests</p>
</li>
<li>
<p>Si pasa, commit se ejecuta</p>
</li>
<li>
<p>Si falla, commit se cancela</p>
</li>
</ol>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_14_3_npm_scripts_útiles"><a class="link" href="#_14_3_npm_scripts_útiles">14.3 NPM Scripts Útiles</a></h3>
<div class="sect3">
<h4 id="_development_scripts"><a class="link" href="#_development_scripts">Development Scripts</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "scripts": {
    "test": "mocha",
    "test:watch": "mocha --watch --watch-extensions ts",
    "test:debug": "mocha --inspect-brk",
    "test:grep": "mocha --grep",
    "test:unit": "mocha tests/unit/**/*.test.ts",
    "test:integration": "mocha tests/integration/**/*.test.ts",
    "test:coverage": "nyc mocha",
    "test:coverage:report": "nyc report --reporter=html &amp;&amp; open coverage/index.html"
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Uso:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm test                    # Ejecutar todos
npm run test:watch        # Modo watch
npm run test:debug        # Debugger
npm run test:coverage     # Con coverage
npm run test:unit         # Solo unit tests
npm run test:grep "sumar" # Filter por patrón</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_performance_scripts"><a class="link" href="#_performance_scripts">Performance Scripts</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "scripts": {
    "test:slow": "mocha --reporter json | jq '.tests[] | select(.duration &gt; 500) | {title: .title, duration: .duration}'",
    "test:slowest": "mocha --reporter json | jq '.tests | sort_by(.duration) | reverse | .[0:10]'",
    "test:quick": "mocha --reporter min"
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Uso:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm run test:slow    # Tests &gt; 500ms
npm run test:slowest # Top 10 más lentos
npm run test:quick   # Output mínimo</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cicd_scripts"><a class="link" href="#_cicd_scripts">CI/CD Scripts</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "scripts": {
    "test:ci": "nyc --check-coverage --lines 80 mocha --reporter json --reporter-options outputFile=test-results.json",
    "test:ci:coverage": "nyc report --reporter=lcov --reporter=text-summary",
    "test:report": "mocha --reporter html --reporter-options reportDir=./reports"
  }
}</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recursos_adicionales"><a class="link" href="#_recursos_adicionales">Recursos Adicionales</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Documentación oficial: <a href="https://mochajs.org/" class="bare">https://mochajs.org/</a></p>
</li>
<li>
<p>Chai assertions: <a href="https://www.chaijs.com/" class="bare">https://www.chaijs.com/</a></p>
</li>
<li>
<p>Sinon mocking: <a href="https://sinonjs.org/" class="bare">https://sinonjs.org/</a></p>
</li>
<li>
<p>Nyc coverage: <a href="https://github.com/istanbuljs/nyc" class="bare">https://github.com/istanbuljs/nyc</a></p>
</li>
<li>
<p>Supertest: <a href="https://github.com/visionmedia/supertest" class="bare">https://github.com/visionmedia/supertest</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2026-02-25 08:53:33 +0100
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
</body>
</html>